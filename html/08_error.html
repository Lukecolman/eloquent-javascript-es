<!doctype html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bugs y Errores :: Eloquent JavaScript</title>
  <link rel=stylesheet href="css/ejs.css"><script>
      var page = {"type":"chapter","number":8,"load_files":["code/chapter/08_error.js"]}</script></head>

<article>
<nav><a href="07_robot.html" title="previous chapter" aria-label="previous chapter">‚óÇ</a>¬†<a href="index.html" title="cover" aria-label="cover">‚óè</a>¬†<a href="09_regexp.html" title="next chapter" aria-label="next chapter">‚ñ∏</a>&nbsp;<button class=help title="help" aria-label="help"><strong>?</strong></button>&nbsp;<button class="dark-mode-toggle">üåô</button>
</nav>

<h1>Bugs y Errores</h1>

<blockquote>

<p><a class="p_ident" id="p-d+xhst8cOA" href="#p-d+xhst8cOA" tabindex="-1" role="presentation"></a>Depurar es el doble de dif√≠cil que escribir el c√≥digo en primer lugar. Por lo tanto, si escribes el c√≥digo lo m√°s ingeniosamente posible, por definici√≥n, no eres lo suficientemente inteligente como para depurarlo.</p>

<footer>Brian Kernighan and P.J. Plauger, <cite>The Elements of Programming Style</cite></footer>

</blockquote><figure class="chapter framed"><img src="img/chapter_picture_8.jpg" alt="Ilustraci√≥n mostrando varios insectos y un ciempi√©s"></figure>

<p><a class="p_ident" id="p-A/LLrFO0lg" href="#p-A/LLrFO0lg" tabindex="-1" role="presentation"></a>Las fallas en los programas de computadora generalmente se llaman <em>bugs</em>. Hace que los programadores se sientan bien imaginarlos como peque√±as cosas que simplemente se meten en nuestro trabajo. En realidad, por supuesto, nosotros mismos los colocamos all√≠.</p>

<p><a class="p_ident" id="p-DretlFLrRR" href="#p-DretlFLrRR" tabindex="-1" role="presentation"></a>Si un programa es pensamiento cristalizado, puedes clasificar aproximadamente los errores en aquellos causados por pensamientos confusos y aquellos causados por errores introducidos al convertir un pensamiento en c√≥digo. El primer tipo generalmente es m√°s dif√≠cil de diagnosticar y arreglar que el √∫ltimo.</p>

<h2><a class="h_ident" id="h-EWyEuXUxbG" href="#h-EWyEuXUxbG" tabindex="-1" role="presentation"></a>Lenguaje</h2>

<p><a class="p_ident" id="p-76p39k7Awv" href="#p-76p39k7Awv" tabindex="-1" role="presentation"></a>Muchos errores podr√≠an ser se√±alados autom√°ticamente por la computadora, si supiera lo suficiente sobre lo que estamos intentando hacer. Pero la laxitud de JavaScript es un obst√°culo aqu√≠. Su concepto de enlaces y propiedades es lo suficientemente vago como para rara vez atrapar typos antes de ejecutar realmente el programa. E incluso entonces, te permite hacer algunas cosas claramente absurdas sin quejarse, como calcular <code>true * &quot;monkey&quot;</code>.</p>

<p><a class="p_ident" id="p-9FkgM0j2UZ" href="#p-9FkgM0j2UZ" tabindex="-1" role="presentation"></a>Hay algunas cosas sobre las que JavaScript s√≠ se queja. Escribir un programa que no siga la gram√°tica del lenguaje har√° que la computadora se queje de inmediato. Otras cosas, como llamar a algo que no es una funci√≥n o buscar una propiedad en un valor undefined har√°n que se reporte un error cuando el programa intente realizar la acci√≥n.</p>

<p><a class="p_ident" id="p-jRmfwLXxFS" href="#p-jRmfwLXxFS" tabindex="-1" role="presentation"></a>Pero a menudo, tu c√°lculo absurdo simplemente producir√° <code>NaN</code> (no es un n√∫mero) o un valor indefinido, mientras que el programa contin√∫a felizmente, convencido de que est√° haciendo algo significativo. El error se manifestar√° solo m√°s tarde, despu√©s de que el valor falso haya pasado por varias funciones. Es posible que no desencadene un error en absoluto, pero silenciosamente cause que la salida del programa sea incorrecta. Encontrar la fuente de tales problemas puede ser dif√≠cil.</p>

<p><a class="p_ident" id="p-/tIrAOs/Jj" href="#p-/tIrAOs/Jj" tabindex="-1" role="presentation"></a>El proceso de encontrar errores‚Äîbugs‚Äîen los programas se llama <em>depuraci√≥n</em>.</p>

<h2><a class="h_ident" id="h-VqnTmwySiJ" href="#h-VqnTmwySiJ" tabindex="-1" role="presentation"></a>Modo estricto</h2>

<p><a class="p_ident" id="p-iJcOGE1sqz" href="#p-iJcOGE1sqz" tabindex="-1" role="presentation"></a>JavaScript puede ser un <em>poco</em> m√°s estricto al habilitar el <em>modo estricto</em>. Esto se hace colocando la cadena <code>&quot;use strict&quot;</code> en la parte superior de un archivo o en el cuerpo de una funci√≥n. Aqu√≠ tienes un ejemplo:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-tKCBneE0vw" href="#c-tKCBneE0vw" tabindex="-1" role="presentation"></a><span class="tok-keyword">function</span> <span class="tok-definition">canYouSpotTheProblem</span>() {
  <span class="tok-string">&quot;use strict&quot;</span>;
  <span class="tok-keyword">for</span> (counter = <span class="tok-number">0</span>; counter &lt; <span class="tok-number">10</span>; counter++) {
    console.log(<span class="tok-string">&quot;Happy happy&quot;</span>);
  }
}

canYouSpotTheProblem();
<span class="tok-comment">// ‚Üí ReferenceError: counter is not defined</span></pre>

<p><a class="p_ident" id="p-GbnCF9fb71" href="#p-GbnCF9fb71" tabindex="-1" role="presentation"></a>Normalmente, cuando olvidas poner <code>let</code> frente a tu enlace, como en el caso de <code>counter</code> en el ejemplo, JavaScript silenciosamente crea un enlace global y lo utiliza. En modo estricto, se reporta un error en su lugar. Esto es muy √∫til. Sin embargo, cabe mencionar que esto no funciona cuando el enlace en cuesti√≥n ya existe en alg√∫n lugar del √°mbito. En ese caso, el bucle seguir√° sobrescribiendo silenciosamente el valor del enlace.</p>

<p><a class="p_ident" id="p-CH5/UhR2LK" href="#p-CH5/UhR2LK" tabindex="-1" role="presentation"></a>Otro cambio en el modo estricto es que el enlace <code>this</code> mantiene el valor <code>undefined</code> en funciones que no son llamadas como m√©todos. Al hacer una llamada de este tipo fuera del modo estricto, <code>this</code> se refiere al objeto de √°mbito global, que es un objeto cuyas propiedades son los enlaces globales. Entonces, si accidentalmente llamas incorrectamente a un m√©todo o constructor en modo estricto, JavaScript producir√° un error tan pronto como intente leer algo de <code>this</code>, en lugar de escribir felizmente en el √°mbito global.</p>

<p><a class="p_ident" id="p-lSOsyuYctI" href="#p-lSOsyuYctI" tabindex="-1" role="presentation"></a>Por ejemplo, considera el siguiente c√≥digo, que llama a una funci√≥n constructor sin la palabra clave <code>new</code> para que su <code>this</code> <em>no</em> se refiera a un objeto reci√©n construido:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-FPKrb2F1C3" href="#c-FPKrb2F1C3" tabindex="-1" role="presentation"></a><span class="tok-keyword">function</span> <span class="tok-definition">Person</span>(<span class="tok-definition">name</span>) { <span class="tok-keyword">this</span>.name = name; }
<span class="tok-keyword">let</span> <span class="tok-definition">ferdinand</span> = Person(<span class="tok-string">&quot;Ferdinand&quot;</span>); <span class="tok-comment">// oops</span>
console.log(name);
<span class="tok-comment">// ‚Üí Ferdinand</span></pre>

<p><a class="p_ident" id="p-Kvv0M23vAl" href="#p-Kvv0M23vAl" tabindex="-1" role="presentation"></a>Entonces, la llamada falsa a <code>Person</code> tuvo √©xito pero devolvi√≥ un valor no definido y cre√≥ el enlace global <code>name</code>. En modo estricto, el resultado es diferente.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-d2bO4uR9UP" href="#c-d2bO4uR9UP" tabindex="-1" role="presentation"></a><span class="tok-string">&quot;use strict&quot;</span>;
<span class="tok-keyword">function</span> <span class="tok-definition">Person</span>(<span class="tok-definition">name</span>) { <span class="tok-keyword">this</span>.name = name; }
<span class="tok-keyword">let</span> <span class="tok-definition">ferdinand</span> = Person(<span class="tok-string">&quot;Ferdinand&quot;</span>); <span class="tok-comment">// olvid√≥ el new</span>
<span class="tok-comment">// ‚Üí TypeError: Cannot set property 'name' of undefined</span></pre>

<p><a class="p_ident" id="p-j2ef/d1TDi" href="#p-j2ef/d1TDi" tabindex="-1" role="presentation"></a>Inmediatamente se nos informa que algo est√° mal. Esto es √∫til.</p>

<p><a class="p_ident" id="p-QrETth0MQK" href="#p-QrETth0MQK" tabindex="-1" role="presentation"></a>Afortunadamente, los constructores creados con la notaci√≥n <code>class</code> siempre mostrar√°n una queja si se llaman sin <code>new</code>, lo que hace que esto sea menos problem√°tico incluso en modo no estricto.</p>

<p><a class="p_ident" id="p-R6rUgXg6qF" href="#p-R6rUgXg6qF" tabindex="-1" role="presentation"></a>El modo estricto hace algunas cosas m√°s. Proh√≠be darle a una funci√≥n m√∫ltiples par√°metros con el mismo nombre y elimina ciertas caracter√≠sticas problem√°ticas del lenguaje por completo (como la declaraci√≥n <code>with</code>, que es tan incorrecta que no se discute m√°s en este libro).</p>

<p><a class="p_ident" id="p-b84P9pZUCj" href="#p-b84P9pZUCj" tabindex="-1" role="presentation"></a>En resumen, colocar <code>&quot;use strict&quot;</code> al principio de tu programa rara vez duele y podr√≠a ayudarte a identificar un problema.</p>

<h2><a class="h_ident" id="h-Oj3wsjsPjg" href="#h-Oj3wsjsPjg" tabindex="-1" role="presentation"></a>Tipos</h2>

<p><a class="p_ident" id="p-ZdIS/hFvOa" href="#p-ZdIS/hFvOa" tabindex="-1" role="presentation"></a>Algunos lenguajes quieren saber los tipos de todos tus enlaces y expresiones antes de ejecutar un programa. Te indicar√°n de inmediato cuando un tipo se utiliza de manera inconsistente. JavaScript considera los tipos solo cuando realmente se ejecuta el programa, e incluso all√≠ a menudo intenta convertir valores impl√≠citamente al tipo que espera, por lo que no es de mucha ayuda.</p>

<p><a class="p_ident" id="p-AId/2vaEOU" href="#p-AId/2vaEOU" tabindex="-1" role="presentation"></a>No obstante, los tipos proporcionan un marco √∫til para hablar sobre programas. Muchos errores provienen de estar confundido acerca del tipo de valor que entra o sale de una funci√≥n. Si tienes esa informaci√≥n escrita, es menos probable que te confundas.Podr√≠as agregar un comentario como el siguiente antes de la funci√≥n <code>findRoute</code> del cap√≠tulo anterior para describir su tipo:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-VApmuU1GdX" href="#c-VApmuU1GdX" tabindex="-1" role="presentation"></a><span class="tok-comment">// (graph: Object, from: string, to: string) =&gt; string[]</span>
<span class="tok-keyword">function</span> <span class="tok-definition">findRoute</span>(<span class="tok-definition">graph</span>, <span class="tok-definition">from</span>, <span class="tok-definition">to</span>) {
  <span class="tok-comment">// ...</span>
}</pre>

<p><a class="p_ident" id="p-NHKkQjh4qk" href="#p-NHKkQjh4qk" tabindex="-1" role="presentation"></a>Existen varias convenciones diferentes para anotar programas de JavaScript con tipos.</p>

<p><a class="p_ident" id="p-1St0Nf/rv4" href="#p-1St0Nf/rv4" tabindex="-1" role="presentation"></a>Una cosa sobre los tipos es que necesitan introducir su propia complejidad para poder describir suficiente c√≥digo para ser √∫tiles. ¬øQu√© tipo crees que tendr√≠a la funci√≥n <code>randomPick</code> que devuelve un elemento aleatorio de un array? Necesitar√≠as introducir una <em>variable de tipo</em>, <em>T</em>, que pueda representar cualquier tipo, para que puedas darle a <code>randomPick</code> un tipo como <code>(T[]) ‚Üí T</code> (funci√≥n de un array de <em>T</em> a un <em>T</em>).</p>

<p id="typing"><a class="p_ident" id="p-mWQocfyIkx" href="#p-mWQocfyIkx" tabindex="-1" role="presentation"></a>Cuando los tipos de un programa son conocidos, es posible que la computadora los <em>verifique</em> por ti, se√±alando errores antes de que se ejecute el programa. Hay varios dialectos de JavaScript que a√±aden tipos al lenguaje y los verifican. El m√°s popular se llama <a href="https://www.typescriptlang.org/">TypeScript</a>. Si est√°s interesado en agregar m√°s rigor a tus programas, te recomiendo que lo pruebes.</p>

<p><a class="p_ident" id="p-dDhyAGmawD" href="#p-dDhyAGmawD" tabindex="-1" role="presentation"></a>En este libro, continuaremos utilizando c√≥digo JavaScript crudo, peligroso y sin tipos.</p>

<h2><a class="h_ident" id="h-q7sv+LnNdr" href="#h-q7sv+LnNdr" tabindex="-1" role="presentation"></a>Pruebas</h2>

<p><a class="p_ident" id="p-Mh0wNpH7/y" href="#p-Mh0wNpH7/y" tabindex="-1" role="presentation"></a>Si el lenguaje no nos va a ayudar mucho a encontrar errores, tendremos que encontrarlos a la antigua: ejecutando el programa y viendo si hace lo correcto.</p>

<p><a class="p_ident" id="p-oYkmD38AMe" href="#p-oYkmD38AMe" tabindex="-1" role="presentation"></a>Hacer esto manualmente, una y otra vez, es una idea muy mala. No solo es molesto, tambi√©n tiende a ser ineficaz, ya que lleva demasiado tiempo probar exhaustivamente todo cada vez que haces un cambio.</p>

<p><a class="p_ident" id="p-9SYP3YuKrm" href="#p-9SYP3YuKrm" tabindex="-1" role="presentation"></a>Las computadoras son buenas en tareas repetitivas, y las pruebas son la tarea repetitiva ideal. Las pruebas automatizadas son el proceso de escribir un programa que prueba otro programa. Es un poco m√°s trabajo escribir pruebas que probar manualmente, pero una vez que lo has hecho, adquieres una especie de superpoder: solo te llevar√° unos segundos verificar que tu programa siga comport√°ndose correctamente en todas las situaciones para las que escribiste pruebas. Cuando rompes algo, lo notar√°s de inmediato en lugar de encontr√°rtelo al azar en alg√∫n momento posterior.</p>

<p><a class="p_ident" id="p-4I7oSeVVi0" href="#p-4I7oSeVVi0" tabindex="-1" role="presentation"></a>Las pruebas suelen tomar la forma de peque√±os programas etiquetados que verifican alg√∫n aspecto de tu c√≥digo. Por ejemplo, un conjunto de pruebas para el (probablemente ya probado por alguien m√°s) m√©todo <code>toUpperCase</code> est√°ndar podr√≠a lucir as√≠:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-i6XPIwq65l" href="#c-i6XPIwq65l" tabindex="-1" role="presentation"></a><span class="tok-keyword">function</span> <span class="tok-definition">test</span>(<span class="tok-definition">label</span>, <span class="tok-definition">body</span>) {
  <span class="tok-keyword">if</span> (!body()) console.log(<span class="tok-string2">`Fallo: </span>${label}<span class="tok-string2">`</span>);
}

test(<span class="tok-string">&quot;convertir texto latino a may√∫sculas&quot;</span>, () =&gt; {
  <span class="tok-keyword">return</span> <span class="tok-string">&quot;hello&quot;</span>.toUpperCase() == <span class="tok-string">&quot;HELLO&quot;</span>;
});
test(<span class="tok-string">&quot;convertir texto griego a may√∫sculas&quot;</span>, () =&gt; {
  <span class="tok-keyword">return</span> <span class="tok-string">&quot;ŒßŒ±ŒØœÅŒµœÑŒµ&quot;</span>.toUpperCase() == <span class="tok-string">&quot;ŒßŒëŒäŒ°ŒïŒ§Œï&quot;</span>;
});
test(<span class="tok-string">&quot;no convertir caracteres sin caso&quot;</span>, () =&gt; {
  <span class="tok-keyword">return</span> <span class="tok-string">&quot;ŸÖÿ±ÿ≠ÿ®ÿß&quot;</span>.toUpperCase() == <span class="tok-string">&quot;ŸÖÿ±ÿ≠ÿ®ÿß&quot;</span>;
});</pre>

<p><a class="p_ident" id="p-WBLtdfJ+Ms" href="#p-WBLtdfJ+Ms" tabindex="-1" role="presentation"></a>Escribir pruebas de esta forma tiende a producir c√≥digo bastante repetitivo y torpe. Afortunadamente, existen software que te ayudan a construir y ejecutar colecciones de pruebas (<em>suites de pruebas</em>) al proporcionar un lenguaje (en forma de funciones y m√©todos) adecuado para expresar pruebas y al producir informaci√≥n informativa cuando una prueba falla. Estos suelen llamarse <em>corredores de pruebas</em>.</p>

<p><a class="p_ident" id="p-2HxEM1LrbU" href="#p-2HxEM1LrbU" tabindex="-1" role="presentation"></a>Alguno c√≥digo es m√°s f√°cil de probar que otro c√≥digo. Generalmente, cuantos m√°s objetos externos interact√∫an con el c√≥digo, m√°s dif√≠cil es configurar el contexto para probarlo. El estilo de programaci√≥n mostrado en el <a href="07_robot.html">cap√≠tulo anterior</a>, que utiliza valores persistentes autocontenidos en lugar de objetos cambiantes, tiende a ser f√°cil de probar.</p>

<h2><a class="h_ident" id="h-nCqjdGY4Fq" href="#h-nCqjdGY4Fq" tabindex="-1" role="presentation"></a>Depuraci√≥n</h2>

<p><a class="p_ident" id="p-Wg8h9d/mPj" href="#p-Wg8h9d/mPj" tabindex="-1" role="presentation"></a>Una vez que notas que hay algo mal en tu programa porque se comporta de manera incorrecta o produce errores, el siguiente paso es descubrir <em>cu√°l</em> es el problema.</p>

<p><a class="p_ident" id="p-AuzxnqBdGR" href="#p-AuzxnqBdGR" tabindex="-1" role="presentation"></a>A veces es obvio. El mensaje de error se√±alar√° una l√≠nea espec√≠fica de tu programa, y si miras la descripci√≥n del error y esa l√≠nea de c√≥digo, a menudo puedes ver el problema.</p>

<p><a class="p_ident" id="p-FQOl3siskW" href="#p-FQOl3siskW" tabindex="-1" role="presentation"></a>Pero no siempre. A veces la l√≠nea que desencaden√≥ el problema es simplemente el primer lugar donde se utiliza de manera incorrecta un valor defectuoso producido en otro lugar. Si has estado resolviendo los ejercicios en cap√≠tulos anteriores, probablemente ya hayas experimentado estas situaciones.</p>

<p><a class="p_ident" id="p-YhdyY6oKg7" href="#p-YhdyY6oKg7" tabindex="-1" role="presentation"></a>El siguiente programa de ejemplo intenta convertir un n√∫mero entero en una cadena en una base dada (decimal, binaria, y as√≠ sucesivamente) al seleccionar repetidamente el √∫ltimo d√≠gito y luego dividir el n√∫mero para deshacerse de este d√≠gito. Pero la extra√±a salida que produce actualmente sugiere que tiene un error.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-8tOR9x4PzT" href="#c-8tOR9x4PzT" tabindex="-1" role="presentation"></a><span class="tok-keyword">function</span> <span class="tok-definition">numberToString</span>(<span class="tok-definition">n</span>, <span class="tok-definition">base</span> = <span class="tok-number">10</span>) {
  <span class="tok-keyword">let</span> <span class="tok-definition">result</span> = <span class="tok-string">&quot;&quot;</span>, <span class="tok-definition">sign</span> = <span class="tok-string">&quot;&quot;</span>;
  <span class="tok-keyword">if</span> (n &lt; <span class="tok-number">0</span>) {
    sign = <span class="tok-string">&quot;-&quot;</span>;
    n = -n;
  }
  <span class="tok-keyword">do</span> {
    result = String(n % base) + result;
    n /= base;
  } <span class="tok-keyword">while</span> (n &gt; <span class="tok-number">0</span>);
  <span class="tok-keyword">return</span> sign + result;
}
console.log(numberToString(<span class="tok-number">13</span>, <span class="tok-number">10</span>));
<span class="tok-comment">// ‚Üí 1.5e-3231.3e-3221.3e-3211.3e-3201.3e-3191.3e-3181.3‚Ä¶</span></pre>

<p><a class="p_ident" id="p-sU8Vx9sd2m" href="#p-sU8Vx9sd2m" tabindex="-1" role="presentation"></a>Incluso si ya ves el problema, finge por un momento que no lo haces. Sabemos que nuestro programa no funciona correctamente, y queremos descubrir por qu√©.</p>

<p><a class="p_ident" id="p-coTKqI9MYU" href="#p-coTKqI9MYU" tabindex="-1" role="presentation"></a>Aqu√≠ es donde debes resistir la tentaci√≥n de empezar a hacer cambios aleatorios en el c√≥digo para ver si eso lo mejora. En cambio, <em>piensa</em>. Analiza lo que est√° sucediendo y elabora una teor√≠a sobre por qu√© podr√≠a estar ocurriendo. Luego, realiza observaciones adicionales para probar esta teor√≠a, o si a√∫n no tienes una teor√≠a, realiza observaciones adicionales para ayudarte a crear una.</p>

<p><a class="p_ident" id="p-CJZqnlaGs3" href="#p-CJZqnlaGs3" tabindex="-1" role="presentation"></a>Colocar algunas llamadas <code>console.log</code> estrat√©gicas en el programa es una buena manera de obtener informaci√≥n adicional sobre lo que est√° haciendo el programa. En este caso, queremos que <code>n</code> tome los valores <code>13</code>, <code>1</code> y luego <code>0</code>. Vamos a escribir su valor al inicio del ciclo.</p>

<pre class="snippet" data-language="null" ><a class="c_ident" id="c-nB/OeL8UNa" href="#c-nB/OeL8UNa" tabindex="-1" role="presentation"></a>13
1.3
0.13
0.013
‚Ä¶
1.5e-323</pre>

<p><a class="p_ident" id="p-CGETZI9u8W" href="#p-CGETZI9u8W" tabindex="-1" role="presentation"></a><em>Correcto</em>. Al dividir 13 por 10 no se produce un n√∫mero entero. En lugar de <code>n /= base</code>, lo que realmente queremos es <code>n = Math.<wbr>floor(n /<wbr> base)</code> para que el n√∫mero se ‚Äúdesplace‚Äù correctamente hacia la derecha.</p>

<p><a class="p_ident" id="p-iCF+nPuolv" href="#p-iCF+nPuolv" tabindex="-1" role="presentation"></a>Una alternativa a usar <code>console.log</code> para observar el comportamiento del programa es utilizar las capacidades del <em>depurador</em> de tu navegador. Los navegadores vienen con la capacidad de establecer un <em>punto de interrupci√≥n</em> en una l√≠nea espec√≠fica de tu c√≥digo. Cuando la ejecuci√≥n del programa llega a una l√≠nea con un punto de interrupci√≥n, se pausa y puedes inspeccionar los valores de las asignaciones en ese punto. No entrar√© en detalles, ya que los depuradores difieren de un navegador a otro, pero busca en las herramientas de desarrollo de tu navegador o busca instrucciones en la Web.Otra forma de establecer un punto de interrupci√≥n es incluir una instrucci√≥n <code>debugger</code> (consistente √∫nicamente en esa palabra clave) en tu programa. Si las herramientas de desarrollo de tu navegador est√°n activas, el programa se pausar√° cada vez que alcance dicha instrucci√≥n.</p>

<h2><a class="h_ident" id="h-a0SXG/vlkA" href="#h-a0SXG/vlkA" tabindex="-1" role="presentation"></a>Propagaci√≥n de errores</h2>

<p><a class="p_ident" id="p-hHvvnQa31B" href="#p-hHvvnQa31B" tabindex="-1" role="presentation"></a>Lamentablemente, no todos los problemas pueden ser prevenidos por el programador. Si tu programa se comunica de alguna manera con el mundo exterior, es posible recibir entradas malformadas, sobrecargarse de trabajo o que falle la red.</p>

<p><a class="p_ident" id="p-rFotl1BZs4" href="#p-rFotl1BZs4" tabindex="-1" role="presentation"></a>Si est√°s programando solo para ti, puedes permitirte simplemente ignorar esos problemas hasta que ocurran. Pero si est√°s construyendo algo que ser√° utilizado por alguien m√°s, generalmente quieres que el programa haga algo m√°s que simplemente colapsar. A veces lo correcto es aceptar la entrada incorrecta y continuar ejecut√°ndose. En otros casos, es mejor informar al usuario sobre lo que sali√≥ mal y luego rendirse. Pero en cualquier situaci√≥n, el programa debe hacer algo activamente en respuesta al problema.</p>

<p><a class="p_ident" id="p-lJIpzewONf" href="#p-lJIpzewONf" tabindex="-1" role="presentation"></a>Imaginemos que tienes una funci√≥n <code>promptNumber</code> que solicita al usuario un n√∫mero y lo retorna. ¬øQu√© deber√≠a retornar si el usuario ingresa ‚Äúnaranja‚Äù?</p>

<p><a class="p_ident" id="p-SQNPd296Uq" href="#p-SQNPd296Uq" tabindex="-1" role="presentation"></a>Una opci√≥n es hacer que retorne un valor especial. Las opciones comunes para tales valores son <code>null</code>, <code>undefined</code> o -1.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-A6EqMxOZ3z" href="#c-A6EqMxOZ3z" tabindex="-1" role="presentation"></a><span class="tok-keyword">function</span> <span class="tok-definition">promptNumber</span>(<span class="tok-definition">pregunta</span>) {
  <span class="tok-keyword">let</span> <span class="tok-definition">resultado</span> = Number(prompt(pregunta));
  <span class="tok-keyword">if</span> (Number.isNaN(resultado)) <span class="tok-keyword">return</span> <span class="tok-keyword">null</span>;
  <span class="tok-keyword">else</span> <span class="tok-keyword">return</span> resultado;
}

console.log(promptNumber(<span class="tok-string">&quot;¬øCu√°ntos √°rboles ves?&quot;</span>));</pre>

<p><a class="p_ident" id="p-iEwNnwQra+" href="#p-iEwNnwQra+" tabindex="-1" role="presentation"></a>Ahora, cualquier c√≥digo que llame a <code>promptNumber</code> debe verificar si se ley√≥ un n√∫mero real y, de no ser as√≠, debe recuperarse de alguna manera, quiz√°s volviendo a preguntar o completando con un valor predeterminado. O podr√≠a retornar nuevamente un valor especial a su llamante para indicar que no pudo hacer lo que se le pidi√≥.</p>

<p><a class="p_ident" id="p-ETfHsxU1W4" href="#p-ETfHsxU1W4" tabindex="-1" role="presentation"></a>En muchas situaciones, sobre todo cuando los errores son comunes y el llamante deber√≠a tomarlos expl√≠citamente en cuenta, retornar un valor especial es una buena manera de indicar un error. Sin embargo, tiene sus inconvenientes. Primero, ¬øqu√© pasa si la funci√≥n ya puede devolver todos los tipos posibles de valores? En tal funci√≥n, tendr√°s que hacer algo como envolver el resultado en un objeto para poder distinguir el √©xito del fracaso, de la misma manera que lo hace el m√©todo <code>next</code> en la interfaz del iterador.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-6yglyj6Pat" href="#c-6yglyj6Pat" tabindex="-1" role="presentation"></a><span class="tok-keyword">function</span> <span class="tok-definition">lastElement</span>(<span class="tok-definition">arreglo</span>) {
  <span class="tok-keyword">if</span> (arreglo.length == <span class="tok-number">0</span>) {
    <span class="tok-keyword">return</span> {<span class="tok-definition">fall√≥</span>: true};
  } <span class="tok-keyword">else</span> {
    <span class="tok-keyword">return</span> {<span class="tok-definition">valor</span>: arreglo[arreglo.length - <span class="tok-number">1</span>]};
  }
}</pre>

<p><a class="p_ident" id="p-dIo5IzVcnp" href="#p-dIo5IzVcnp" tabindex="-1" role="presentation"></a>El segundo problema con retornar valores especiales es que puede llevar a un c√≥digo inc√≥modo. Si un fragmento de c√≥digo llama a <code>promptNumber</code> 10 veces, tendr√° que verificar 10 veces si se devolvi√≥ <code>null</code>. Y si su respuesta al encontrar <code>null</code> es simplemente devolver <code>null</code> en s√≠ mismo, los llamantes de la funci√≥n a su vez tendr√°n que comprobarlo, y as√≠ sucesivamente.</p>

<h2><a class="h_ident" id="h-6MskLb8+Lo" href="#h-6MskLb8+Lo" tabindex="-1" role="presentation"></a>Excepciones</h2>

<p><a class="p_ident" id="p-8kL59rmzNL" href="#p-8kL59rmzNL" tabindex="-1" role="presentation"></a>Cuando una funci√≥n no puede proceder normalmente, lo que a menudo <em>queremos</em> hacer es simplemente detener lo que estamos haciendo e ir directamente a un lugar que sepa c√≥mo manejar el problema. Esto es lo que hace el <em>manejo de excepciones</em>.</p>

<p><a class="p_ident" id="p-8kP1DbEOE1" href="#p-8kP1DbEOE1" tabindex="-1" role="presentation"></a>Las excepciones son un mecanismo que hace posible que el c√≥digo que se encuentra con un problema <em>lanze</em> (o <em>emita</em>) una excepci√≥n. Una excepci√≥n puede ser cualquier valor. Lanzar una se asemeja de alguna manera a un retorno super potenciado de una funci√≥n: sale no solo de la funci√≥n actual sino tambi√©n de sus llamadores, hasta llegar a la primera llamada que inici√≥ la ejecuci√≥n actual. Esto se llama <em>desenrollar la pila</em>. Puede recordar la pila de llamadas a funciones que se mencion√≥ en el <a href="03_functions.html#stack">Cap√≠tulo 3</a>. Una excepci√≥n recorre esta pila, descartando todos los contextos de llamada que encuentra.</p>

<p><a class="p_ident" id="p-YezykK0rip" href="#p-YezykK0rip" tabindex="-1" role="presentation"></a>Si las excepciones siempre fueran directamente hasta el final de la pila, no ser√≠an de mucha utilidad. Simplemente proporcionar√≠an una forma novedosa de hacer que su programa falle. Su poder radica en el hecho de que puede colocar ‚Äúobst√°culos‚Äù a lo largo de la pila para <em>capturar</em> la excepci√≥n mientras viaja hacia abajo. Una vez que ha capturado una excepci√≥n, puede hacer algo con ella para resolver el problema y luego continuar ejecutando el programa.</p>

<p><a class="p_ident" id="p-Od/5LHikVf" href="#p-Od/5LHikVf" tabindex="-1" role="presentation"></a>Aqu√≠ tienes un ejemplo:</p>

<pre id="look" tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-swByM+OBOa" href="#c-swByM+OBOa" tabindex="-1" role="presentation"></a><span class="tok-keyword">function</span> <span class="tok-definition">promptDirection</span>(<span class="tok-definition">question</span>) {
  <span class="tok-keyword">let</span> <span class="tok-definition">result</span> = prompt(question);
  <span class="tok-keyword">if</span> (result.toLowerCase() == <span class="tok-string">&quot;left&quot;</span>) <span class="tok-keyword">return</span> <span class="tok-string">&quot;L&quot;</span>;
  <span class="tok-keyword">if</span> (result.toLowerCase() == <span class="tok-string">&quot;right&quot;</span>) <span class="tok-keyword">return</span> <span class="tok-string">&quot;R&quot;</span>;
  <span class="tok-keyword">throw</span> <span class="tok-keyword">new</span> Error(<span class="tok-string">&quot;Direcci√≥n inv√°lida: &quot;</span> + result);
}

<span class="tok-keyword">function</span> <span class="tok-definition">look</span>() {
  <span class="tok-keyword">if</span> (promptDirection(<span class="tok-string">&quot;¬øHacia d√≥nde?&quot;</span>) == <span class="tok-string">&quot;L&quot;</span>) {
    <span class="tok-keyword">return</span> <span class="tok-string">&quot;una casa&quot;</span>;
  } <span class="tok-keyword">else</span> {
    <span class="tok-keyword">return</span> <span class="tok-string">&quot;dos osos enojados&quot;</span>;
  }
}

<span class="tok-keyword">try</span> {
  console.log(<span class="tok-string">&quot;Ves&quot;</span>, look());
} <span class="tok-keyword">catch</span> (<span class="tok-definition">error</span>) {
  console.log(<span class="tok-string">&quot;Algo sali√≥ mal: &quot;</span> + error);
}</pre>

<p><a class="p_ident" id="p-9Kt5Hil9tT" href="#p-9Kt5Hil9tT" tabindex="-1" role="presentation"></a>La palabra clave <code>throw</code> se utiliza para lanzar una excepci√≥n. La captura de una excepci√≥n se realiza envolviendo un trozo de c√≥digo en un bloque <code>try</code>, seguido de la palabra clave <code>catch</code>. Cuando el c√≥digo en el bloque <code>try</code> provoca que se lance una excepci√≥n, se eval√∫a el bloque <code>catch</code>, con el nombre entre par√©ntesis vinculado al valor de la excepci√≥n. Despu√©s de que el bloque <code>catch</code> finalice, o si el bloque <code>try</code> finaliza sin problemas, el programa contin√∫a debajo de toda la instrucci√≥n <code>try/catch</code>.</p>

<p><a class="p_ident" id="p-q0ChDezAsm" href="#p-q0ChDezAsm" tabindex="-1" role="presentation"></a>En este caso, utilizamos el constructor <code>Error</code> para crear nuestro valor de excepci√≥n. Este es un constructor de JavaScript est√°ndar que crea un objeto con una propiedad <code>message</code>. Las instancias de <code>Error</code> tambi√©n recopilan informaci√≥n sobre la pila de llamadas que exist√≠a cuando se cre√≥ la excepci√≥n, una llamada <em>traza de pila</em>. Esta informaci√≥n se almacena en la propiedad <code>stack</code> y puede ser √∫til al intentar depurar un problema: nos indica la funci√≥n donde ocurri√≥ el problema y qu√© funciones realizaron la llamada fallida.</p>

<p><a class="p_ident" id="p-T1aoVSKCOg" href="#p-T1aoVSKCOg" tabindex="-1" role="presentation"></a>Ten en cuenta que la funci√≥n <code>look</code> ignora por completo la posibilidad de que <code>promptDirection</code> pueda fallar. Esta es la gran ventaja de las excepciones: el c√≥digo de manejo de errores solo es necesario en el punto donde ocurre el error y en el punto donde se maneja. Las funciones intermedias pueden olvidarse por completo de ello.</p>

<p><a class="p_ident" id="p-+6sQLyxE9M" href="#p-+6sQLyxE9M" tabindex="-1" role="presentation"></a>Bueno, casi...</p>

<h2><a class="h_ident" id="h-hqzvMe3/h2" href="#h-hqzvMe3/h2" tabindex="-1" role="presentation"></a>Limpiando despu√©s de excepciones</h2>

<p><a class="p_ident" id="p-7uCWVclhtM" href="#p-7uCWVclhtM" tabindex="-1" role="presentation"></a>El efecto de una excepci√≥n es otro tipo de flujo de control. Cada acci√≥n que pueda causar una excepci√≥n, que es pr√°cticamente cada llamada a funci√≥n y acceso a propiedad, puede hacer que el control salga repentinamente de tu c√≥digo.</p>

<p><a class="p_ident" id="p-JHIccV3ujU" href="#p-JHIccV3ujU" tabindex="-1" role="presentation"></a>Esto significa que cuando el c√≥digo tiene varios efectos secundarios, incluso si su flujo de control ‚Äúregular‚Äù parece que siempre ocurrir√°n todos, una excepci√≥n podr√≠a evitar que algunos de ellos sucedan.</p>

<p><a class="p_ident" id="p-5LKB1foGUZ" href="#p-5LKB1foGUZ" tabindex="-1" role="presentation"></a>Aqu√≠ tienes un c√≥digo bancario realmente malo.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-F6LcCu8akJ" href="#c-F6LcCu8akJ" tabindex="-1" role="presentation"></a><span class="tok-keyword">const</span> <span class="tok-definition">accounts</span> = {
  <span class="tok-definition">a</span>: <span class="tok-number">100</span>,
  <span class="tok-definition">b</span>: <span class="tok-number">0</span>,
  <span class="tok-definition">c</span>: <span class="tok-number">20</span>
};

<span class="tok-keyword">function</span> <span class="tok-definition">getAccount</span>() {
  <span class="tok-keyword">let</span> <span class="tok-definition">accountName</span> = prompt(<span class="tok-string">&quot;Ingresa el nombre de una cuenta&quot;</span>);
  <span class="tok-keyword">if</span> (!Object.hasOwn(accounts, accountName)) {
    <span class="tok-keyword">throw</span> <span class="tok-keyword">new</span> Error(<span class="tok-string2">`No existe esa cuenta: </span>${accountName}<span class="tok-string2">`</span>);
  }
  <span class="tok-keyword">return</span> accountName;
}

<span class="tok-keyword">function</span> <span class="tok-definition">transfer</span>(<span class="tok-definition">from</span>, <span class="tok-definition">amount</span>) {
  <span class="tok-keyword">if</span> (accounts[from] &lt; amount) <span class="tok-keyword">return</span>;
  accounts[from] -= amount;
  accounts[getAccount()] += amount;
}</pre>

<p><a class="p_ident" id="p-Ue7mDsJTml" href="#p-Ue7mDsJTml" tabindex="-1" role="presentation"></a>La funci√≥n <code>transfer</code> transfiere una suma de dinero desde una cuenta dada a otra, pidiendo el nombre de la otra cuenta en el proceso. Si se proporciona un nombre de cuenta inv√°lido, <code>getAccount</code> lanza una excepci√≥n.</p>

<p><a class="p_ident" id="p-tKLQSzwcma" href="#p-tKLQSzwcma" tabindex="-1" role="presentation"></a>Pero <code>transfer</code> <em>primero</em> retira el dinero de la cuenta y <em>luego</em> llama a <code>getAccount</code> antes de agregarlo a otra cuenta. Si se interrumpe por una excepci√≥n en ese momento, simplemente har√° desaparecer el dinero.</p>

<p><a class="p_ident" id="p-5TO5JGAD50" href="#p-5TO5JGAD50" tabindex="-1" role="presentation"></a>Ese c√≥digo podr√≠a haber sido escrito de manera un poco m√°s inteligente, por ejemplo, llamando a <code>getAccount</code> antes de comenzar a mover el dinero. Pero a menudo los problemas como este ocurren de formas m√°s sutiles. Incluso las funciones que no parecen que lanzar√°n una excepci√≥n podr√≠an hacerlo en circunstancias excepcionales o cuando contienen un error del programador.</p>

<p><a class="p_ident" id="p-FW9w5Bk33N" href="#p-FW9w5Bk33N" tabindex="-1" role="presentation"></a>Una manera de abordar esto es utilizar menos efectos secundarios. Nuevamente, un estilo de programaci√≥n que calcule nuevos valores en lugar de cambiar datos existentes ayuda. Si un fragmento de c√≥digo deja de ejecutarse en medio de la creaci√≥n de un nuevo valor, no se da√±aron estructuras de datos existentes, lo que facilita la recuperaci√≥n.</p>

<p><a class="p_ident" id="p-7MIgFxyQWl" href="#p-7MIgFxyQWl" tabindex="-1" role="presentation"></a>Pero eso no siempre es pr√°ctico. Por eso existe otra caracter√≠stica que tienen las instrucciones <code>try</code>. Pueden estar seguidas de un bloque <code>finally</code> en lugar o adem√°s de un bloque <code>catch</code>. Un bloque <code>finally</code> dice ‚Äúsin importar <em>qu√©</em> suceda, ejecuta este c√≥digo despu√©s de intentar ejecutar el c√≥digo en el bloque <code>try</code>.‚Äù</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-brWpzDAy4+" href="#c-brWpzDAy4+" tabindex="-1" role="presentation"></a><span class="tok-keyword">function</span> <span class="tok-definition">transfer</span>(<span class="tok-definition">from</span>, <span class="tok-definition">amount</span>) {
  <span class="tok-keyword">if</span> (accounts[from] &lt; amount) <span class="tok-keyword">return</span>;
  <span class="tok-keyword">let</span> <span class="tok-definition">progress</span> = <span class="tok-number">0</span>;
  <span class="tok-keyword">try</span> {
    accounts[from] -= amount;
    progress = <span class="tok-number">1</span>;
    accounts[getAccount()] += amount;
    progress = <span class="tok-number">2</span>;
  } <span class="tok-keyword">finally</span> {
    <span class="tok-keyword">if</span> (progress == <span class="tok-number">1</span>) {
      accounts[from] += amount;
    }
  }
}</pre>

<p><a class="p_ident" id="p-BUFc2zwQBC" href="#p-BUFc2zwQBC" tabindex="-1" role="presentation"></a>Esta versi√≥n de la funci√≥n rastrea su progreso y, si al salir nota que fue abortada en un punto donde hab√≠a creado un estado del programa inconsistente, repara el da√±o causado.</p>

<p><a class="p_ident" id="p-J7xmEOV61W" href="#p-J7xmEOV61W" tabindex="-1" role="presentation"></a>Cabe destacar que aunque el c√≥digo <code>finally</code> se ejecuta cuando se lanza una excepci√≥n en el bloque <code>try</code>, no interfiere con la excepci√≥n. Despu√©s de que se ejecuta el bloque <code>finally</code>, la pila contin√∫a desenroll√°ndose.</p>

<p><a class="p_ident" id="p-mNFQ5eg1AO" href="#p-mNFQ5eg1AO" tabindex="-1" role="presentation"></a>Escribir programas que funcionen de manera confiable incluso cuando surgen excepciones en lugares inesperados es dif√≠cil. Muchas personas simplemente no se preocupan, y debido a que las excepciones suelen reservarse para circunstancias excepcionales, el problema puede ocurrir tan raramente que ni siquiera se note. Si eso es algo bueno o realmente malo depende de cu√°nto da√±o causar√° el software cuando falle.</p>

<h2><a class="h_ident" id="h-PIKTwL5/C0" href="#h-PIKTwL5/C0" tabindex="-1" role="presentation"></a>Captura selectiva</h2>

<p><a class="p_ident" id="p-7iG4YNRvEv" href="#p-7iG4YNRvEv" tabindex="-1" role="presentation"></a>Cuando una excepci√≥n llega hasta el final de la pila sin ser capturada, es manejada por el entorno. Lo que esto significa difiere seg√∫n los entornos. En los navegadores, generalmente se escribe una descripci√≥n del error en la consola de JavaScript (accesible a trav√©s del men√∫ Herramientas o Desarrollador del navegador). Node.js, el entorno de JavaScript sin navegador del que hablaremos en el <a href="20_node.html">Cap√≠tulo 20</a>, es m√°s cuidadoso con la corrupci√≥n de datos. Abortar√° todo el proceso cuando ocurra una excepci√≥n no manejada.</p>

<p><a class="p_ident" id="p-UCYUVC0KwK" href="#p-UCYUVC0KwK" tabindex="-1" role="presentation"></a>Para errores de programaci√≥n, a menudo dejar que el error siga su curso es lo mejor que se puede hacer. Una excepci√≥n no manejada es una forma razonable de se√±alar un programa defectuoso, y la consola de JavaScript proporcionar√°, en navegadores modernos, informaci√≥n sobre qu√© llamadas a funciones estaban en la pila cuando ocurri√≥ el problema.</p>

<p><a class="p_ident" id="p-igAOH/6YWz" href="#p-igAOH/6YWz" tabindex="-1" role="presentation"></a>Para problemas que se <em>espera</em> que ocurran durante el uso rutinario, fallar con una excepci√≥n no manejada es una estrategia terrible.</p>

<p><a class="p_ident" id="p-WgcUeDPSV4" href="#p-WgcUeDPSV4" tabindex="-1" role="presentation"></a>Usos incorrectos del lenguaje, como hacer referencia a un enlace inexistente, buscar una propiedad en <code>null</code> o llamar a algo que no es una funci√≥n, tambi√©n provocar√°n que se lancen excepciones. Estas excepciones tambi√©n pueden ser capturadas.</p>

<p><a class="p_ident" id="p-OgoTGGt/RP" href="#p-OgoTGGt/RP" tabindex="-1" role="presentation"></a>Cuando se entra en un cuerpo <code>catch</code>, todo lo que sabemos es que <em>algo</em> en nuestro cuerpo <code>try</code> caus√≥ una excepci√≥n. Pero no sabemos <em>qu√©</em> lo hizo ni <em>qu√©</em> excepci√≥n caus√≥.</p>

<p><a class="p_ident" id="p-Y7D20P1igb" href="#p-Y7D20P1igb" tabindex="-1" role="presentation"></a>JavaScript (en una omisi√≥n bastante llamativa) no proporciona un soporte directo para capturar excepciones selectivamente: o las capturas todas o no capturas ninguna. Esto hace que sea tentador <em>asumir</em> que la excepci√≥n que obtienes es la que ten√≠as en mente cuando escribiste el bloque <code>catch</code>.</p>

<p><a class="p_ident" id="p-UqZdrEXvRM" href="#p-UqZdrEXvRM" tabindex="-1" role="presentation"></a>Pero podr√≠a no serlo. Alguno otra asunci√≥n podr√≠a estar violada, o podr√≠as haber introducido un error que est√° causando una excepci√≥n. Aqu√≠ tienes un ejemplo que <em>intenta</em> seguir llamando a <code>promptDirection</code> hasta obtener una respuesta v√°lida:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-NOeU9RGWf4" href="#c-NOeU9RGWf4" tabindex="-1" role="presentation"></a><span class="tok-keyword">for</span> (;;) {
  <span class="tok-keyword">try</span> {
    <span class="tok-keyword">let</span> <span class="tok-definition">dir</span> = promptDirection(<span class="tok-string">&quot;¬øD√≥nde?&quot;</span>); <span class="tok-comment">// ‚Üê ¬°Error de tipeo!</span>
    console.log(<span class="tok-string">&quot;Elegiste &quot;</span>, dir);
    <span class="tok-keyword">break</span>;
  } <span class="tok-keyword">catch</span> (<span class="tok-definition">e</span>) {
    console.log(<span class="tok-string">&quot;Direcci√≥n no v√°lida. Int√©ntalo de nuevo.&quot;</span>);
  }
}</pre>

<p><a class="p_ident" id="p-UAeKsDMazt" href="#p-UAeKsDMazt" tabindex="-1" role="presentation"></a>La construcci√≥n <code>for (;;)</code> es una forma de crear intencionalmente un bucle que no se termina por s√≠ mismo. Salimos del bucle solo cuando se proporciona una direcci√≥n v√°lida. <em>Pero</em> escribimos mal <code>promptDirection</code>, lo que resultar√° en un error de ‚Äúvariable no definida‚Äù. Debido a que el bloque <code>catch</code> ignora por completo el valor de la excepci√≥n (<code>e</code>), asumiendo que sabe cu√°l es el problema, trata err√≥neamente el error de enlace mal escrito como indicativo de una entrada incorrecta. Esto no solo causa un bucle infinito, sino que tambi√©n ‚Äúentorpece‚Äù el √∫til mensaje de error sobre el enlace mal escrito.</p>

<p><a class="p_ident" id="p-1NuYJNWPUR" href="#p-1NuYJNWPUR" tabindex="-1" role="presentation"></a>Como regla general, no captures excepciones de manera general a menos que sea con el prop√≥sito de ‚Äúenviarlas‚Äù a alg√∫n lugar, por ejemplo, a trav√©s de la red para informar a otro sistema que nuestro programa se bloque√≥. E incluso en ese caso, piensa cuidadosamente c√≥mo podr√≠as estar ocultando informaci√≥n.</p>

<p><a class="p_ident" id="p-0cwV1xSMNN" href="#p-0cwV1xSMNN" tabindex="-1" role="presentation"></a>Por lo tanto, queremos capturar un tipo <em>espec√≠fico</em> de excepci√≥n. Podemos hacer esto verificando en el bloque <code>catch</code> si la excepci√≥n que recibimos es la que nos interesa y relanz√°ndola en caso contrario. Pero, ¬øc√≥mo reconocemos una excepci√≥n?</p>

<p><a class="p_ident" id="p-MZCZA8Qif4" href="#p-MZCZA8Qif4" tabindex="-1" role="presentation"></a>Podr√≠amos comparar su propiedad <code>message</code> con el mensaje que esperamos error. Pero esta es una forma poco confiable de escribir c√≥digo, estar√≠amos utilizando informaci√≥n dise√±ada para consumo humano (el mensaje) para tomar una decisi√≥n program√°tica. Tan pronto como alguien cambie (o traduzca) el mensaje, el c√≥digo dejar√° de funcionar.</p>

<p><a class="p_ident" id="p-wQ55TKoktB" href="#p-wQ55TKoktB" tabindex="-1" role="presentation"></a>En lugar de eso, definamos un nuevo tipo de error y usemos <code>instanceof</code> para identificarlo.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-r494S84CGw" href="#c-r494S84CGw" tabindex="-1" role="presentation"></a><span class="tok-keyword">class</span> InputError <span class="tok-keyword">extends</span> Error {}

<span class="tok-keyword">function</span> <span class="tok-definition">promptDirection</span>(<span class="tok-definition">question</span>) {
  <span class="tok-keyword">let</span> <span class="tok-definition">result</span> = prompt(question);
  <span class="tok-keyword">if</span> (result.toLowerCase() == <span class="tok-string">&quot;izquierda&quot;</span>) <span class="tok-keyword">return</span> <span class="tok-string">&quot;I&quot;</span>;
  <span class="tok-keyword">if</span> (result.toLowerCase() == <span class="tok-string">&quot;derecha&quot;</span>) <span class="tok-keyword">return</span> <span class="tok-string">&quot;D&quot;</span>;
  <span class="tok-keyword">throw</span> <span class="tok-keyword">new</span> InputError(<span class="tok-string">&quot;Direcci√≥n no v√°lida: &quot;</span> + result);
}</pre>

<p><a class="p_ident" id="p-LXSi1q/9tP" href="#p-LXSi1q/9tP" tabindex="-1" role="presentation"></a>La nueva clase de error extiende <code>Error</code>. No define su propio constructor, lo que significa que hereda el constructor de <code>Error</code>, que espera un mensaje de cadena como argumento. De hecho, no define nada en absoluto, la clase est√° vac√≠a. Los objetos <code>InputError</code> se comportan como objetos <code>Error</code>, excepto que tienen una clase diferente mediante la cual podemos reconocerlos.</p>

<p><a class="p_ident" id="p-Jf9157PX0y" href="#p-Jf9157PX0y" tabindex="-1" role="presentation"></a>Ahora el bucle puede capturar esto con m√°s cuidado.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-8cxyw/dOkq" href="#c-8cxyw/dOkq" tabindex="-1" role="presentation"></a><span class="tok-keyword">for</span> (;;) {
  <span class="tok-keyword">try</span> {
    <span class="tok-keyword">let</span> <span class="tok-definition">dir</span> = promptDirection(<span class="tok-string">&quot;¬øD√≥nde?&quot;</span>);
    console.log(<span class="tok-string">&quot;Elegiste &quot;</span>, dir);
    <span class="tok-keyword">break</span>;
  } <span class="tok-keyword">catch</span> (<span class="tok-definition">e</span>) {
    <span class="tok-keyword">if</span> (e <span class="tok-keyword">instanceof</span> InputError) {
      console.log(<span class="tok-string">&quot;Direcci√≥n no v√°lida. Int√©ntalo de nuevo.&quot;</span>);
    } <span class="tok-keyword">else</span> {
      <span class="tok-keyword">throw</span> e;
    }
  }
}</pre>

<p><a class="p_ident" id="p-1HdJVWn4X+" href="#p-1HdJVWn4X+" tabindex="-1" role="presentation"></a>Esto capturar√° solo instancias de <code>InputError</code> y permitir√° que pasen excepciones no relacionadas. Si vuelves a introducir el error de tipeo, el error de enlace no definido se informar√° correctamente.</p>

<h2><a class="h_ident" id="h-cLlvsxFcXB" href="#h-cLlvsxFcXB" tabindex="-1" role="presentation"></a>Afirmaciones</h2>

<p><a class="p_ident" id="p-ETMuysY1G8" href="#p-ETMuysY1G8" tabindex="-1" role="presentation"></a>Las <em>afirmaciones</em> son verificaciones dentro de un programa que aseguran que algo es como se supone que debe ser. Se utilizan no para manejar situaciones que pueden surgir en la operaci√≥n normal, sino para encontrar errores de programaci√≥n.</p>

<p><a class="p_ident" id="p-QSJMiocH0E" href="#p-QSJMiocH0E" tabindex="-1" role="presentation"></a>Si, por ejemplo, se describe <code>primerElemento</code> como una funci√≥n que nunca deber√≠a ser llamada en arrays vac√≠os, podr√≠amos escribirla de la siguiente manera:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-Fj8yzS3VSx" href="#c-Fj8yzS3VSx" tabindex="-1" role="presentation"></a><span class="tok-keyword">function</span> <span class="tok-definition">primerElemento</span>(<span class="tok-definition">array</span>) {
  <span class="tok-keyword">if</span> (array.length == <span class="tok-number">0</span>) {
    <span class="tok-keyword">throw</span> <span class="tok-keyword">new</span> Error(<span class="tok-string">&quot;primerElemento llamado con []&quot;</span>);
  }
  <span class="tok-keyword">return</span> array[<span class="tok-number">0</span>];
}</pre>

<p><a class="p_ident" id="p-d/otm+M+EY" href="#p-d/otm+M+EY" tabindex="-1" role="presentation"></a>Ahora, en lugar de devolver silenciosamente <code>undefined</code> (que es lo que obtienes al leer una propiedad de un array que no existe), esto har√° que tu programa falle ruidosamente tan pronto como lo uses incorrectamente. Esto hace que sea menos probable que tales errores pasen desapercibidos y m√°s f√°cil encontrar su causa cuando ocurran.</p>

<p><a class="p_ident" id="p-qa66fHY3o/" href="#p-qa66fHY3o/" tabindex="-1" role="presentation"></a>No recomiendo intentar escribir afirmaciones para cada tipo de entrada incorrecta posible. Eso ser√≠a mucho trabajo y llevar√≠a a un c√≥digo muy ruidoso. Querr√°s reservarlas para errores que son f√°ciles de cometer (o que te encuentres cometiendo).</p>

<h2><a class="h_ident" id="h-NUFOUyK+lw" href="#h-NUFOUyK+lw" tabindex="-1" role="presentation"></a>Resumen</h2>

<p><a class="p_ident" id="p-X9IA4vkVjU" href="#p-X9IA4vkVjU" tabindex="-1" role="presentation"></a>Una parte importante de programar es encontrar, diagnosticar y corregir errores. Los problemas pueden ser m√°s f√°ciles de notar si tienes un conjunto de pruebas automatizadas o agregas afirmaciones a tus programas.</p>

<p><a class="p_ident" id="p-baGWPNVr6u" href="#p-baGWPNVr6u" tabindex="-1" role="presentation"></a>Los problemas causados por factores fuera del control del programa generalmente deber√≠an ser planificados activamente. A veces, cuando el problema puede ser manejado localmente, los valores de retorno especiales son una buena forma de rastrearlos. De lo contrario, las excepciones pueden ser preferibles.</p>

<p><a class="p_ident" id="p-nuQxuTcODL" href="#p-nuQxuTcODL" tabindex="-1" role="presentation"></a>Lanzar una excepci√≥n provoca que la pila de llamadas se desenrolle hasta el pr√≥ximo bloque <code>try/catch</code> envolvente o hasta la base de la pila. El valor de la excepci√≥n ser√° entregado al bloque <code>catch</code> que la captura, el cual debe verificar que sea realmente el tipo de excepci√≥n esperado y luego hacer algo con √©l. Para ayudar a abordar el flujo de control impredecible causado por las excepciones, se pueden utilizar bloques <code>finally</code> para asegurar que un trozo de c√≥digo se ejecute <em>siempre</em> cuando un bloque termina.</p>

<h2><a class="h_ident" id="h-tkm7ntLto1" href="#h-tkm7ntLto1" tabindex="-1" role="presentation"></a>Ejercicios</h2>

<h3><a class="i_ident" id="i-rex7TyNReT" href="#i-rex7TyNReT" tabindex="-1" role="presentation"></a>Reintentar</h3>

<p><a class="p_ident" id="p-wbFpwZj+q/" href="#p-wbFpwZj+q/" tabindex="-1" role="presentation"></a>Imagina que tienes una funci√≥n <code>primitiveMultiply</code> que en el 20 por ciento de los casos multiplica dos n√∫meros y en el otro 80 por ciento arroja una excepci√≥n del tipo <code>MultiplicatorUnitFailure</code>. Escribe una funci√≥n que envuelva esta funci√≥n problem√°tica y siga intentando hasta que una llamada tenga √©xito, momento en el que devuelva el resultado.</p>

<p><a class="p_ident" id="p-KVU2qhwpTQ" href="#p-KVU2qhwpTQ" tabindex="-1" role="presentation"></a>Aseg√∫rate de manejar solo las excepciones que est√°s intentando manejar.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-RE+mrsBCA3" href="#c-RE+mrsBCA3" tabindex="-1" role="presentation"></a><span class="tok-keyword">class</span> MultiplicatorUnitFailure <span class="tok-keyword">extends</span> Error {}

<span class="tok-keyword">function</span> <span class="tok-definition">primitiveMultiply</span>(<span class="tok-definition">a</span>, <span class="tok-definition">b</span>) {
  <span class="tok-keyword">if</span> (Math.random() &lt; <span class="tok-number">0.2</span>) {
    <span class="tok-keyword">return</span> a * b;
  } <span class="tok-keyword">else</span> {
    <span class="tok-keyword">throw</span> <span class="tok-keyword">new</span> MultiplicatorUnitFailure(<span class="tok-string">&quot;Klunk&quot;</span>);
  }
}

<span class="tok-keyword">function</span> <span class="tok-definition">reliableMultiply</span>(<span class="tok-definition">a</span>, <span class="tok-definition">b</span>) {
  <span class="tok-comment">// Tu c√≥digo aqu√≠.</span>
}

console.log(reliableMultiply(<span class="tok-number">8</span>, <span class="tok-number">8</span>));
<span class="tok-comment">// ‚Üí 64</span></pre>

<details class="solution"><summary>Mostrar pistas...</summary><div class="solution-text">

<p><a class="p_ident" id="p-mI8+1MDBby" href="#p-mI8+1MDBby" tabindex="-1" role="presentation"></a>La llamada a <code>primitiveMultiply</code> definitivamente deber√≠a ocurrir en un bloque <code>try</code>. El bloque <code>catch</code> correspondiente deber√≠a relanzar la excepci√≥n cuando no sea una instancia de <code>MultiplicatorUnitFailure</code> y asegurarse de que la llamada se reintente cuando lo sea.</p>

<p><a class="p_ident" id="p-SZQFD46n4X" href="#p-SZQFD46n4X" tabindex="-1" role="presentation"></a>Para hacer el reintentamiento, puedes usar un bucle que se detenga solo cuando una llamada tiene √©xito, como en el ejemplo de <a href="08_error.html#look"><code>look</code></a> anterior en este cap√≠tulo, o usar la recursi√≥n y esperar que no tengas una cadena tan larga de fallos que colapse la pila (lo cual es bastante improbable).</p>

</div></details>

<h3><a class="i_ident" id="i-nTTe2xnK1+" href="#i-nTTe2xnK1+" tabindex="-1" role="presentation"></a>La caja cerrada con llave</h3>

<p><a class="p_ident" id="p-Zg+ex4nK+r" href="#p-Zg+ex4nK+r" tabindex="-1" role="presentation"></a>Considera el siguiente objeto (bastante artificial):</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-lhrhg7TQQ2" href="#c-lhrhg7TQQ2" tabindex="-1" role="presentation"></a><span class="tok-keyword">const</span> <span class="tok-definition">box</span> = <span class="tok-keyword">new</span> <span class="tok-keyword">class</span> {
  <span class="tok-definition">locked</span> = true;
  <span class="tok-definition">#content</span> = [];

  <span class="tok-definition">unlock</span>() { <span class="tok-keyword">this</span>.locked = false; }
  <span class="tok-definition">lock</span>() { <span class="tok-keyword">this</span>.locked = true;  }
  <span class="tok-keyword">get</span> <span class="tok-definition">content</span>() {
    <span class="tok-keyword">if</span> (<span class="tok-keyword">this</span>.locked) <span class="tok-keyword">throw</span> <span class="tok-keyword">new</span> Error(<span class="tok-string">&quot;¬°Cerrado con llave!&quot;</span>);
    <span class="tok-keyword">return</span> <span class="tok-keyword">this</span>.#content;
  }
};</pre>

<p><a class="p_ident" id="p-a5WTrn1t1W" href="#p-a5WTrn1t1W" tabindex="-1" role="presentation"></a>Es una caja con una cerradura. Hay un array en la caja, pero solo puedes acceder a √©l cuando la caja est√° desbloqueada.</p>

<p><a class="p_ident" id="p-AU2xyE4g0d" href="#p-AU2xyE4g0d" tabindex="-1" role="presentation"></a>Escribe una funci√≥n llamada <code>withBoxUnlocked</code> que reciba como argumento un valor de funci√≥n, desbloquee la caja, ejecute la funci√≥n y luego asegure que la caja est√© cerrada de nuevo antes de devolverla, independientemente de si la funci√≥n de argumento devolvi√≥ normalmente o lanz√≥ una excepci√≥n.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-w1vGwb4pIE" href="#c-w1vGwb4pIE" tabindex="-1" role="presentation"></a><span class="tok-keyword">const</span> <span class="tok-definition">box</span> = <span class="tok-keyword">new</span> <span class="tok-keyword">class</span> {
  <span class="tok-definition">locked</span> = true;
  <span class="tok-definition">#content</span> = [];

  <span class="tok-definition">unlock</span>() { <span class="tok-keyword">this</span>.locked = false; }
  <span class="tok-definition">lock</span>() { <span class="tok-keyword">this</span>.locked = true;  }
  <span class="tok-keyword">get</span> <span class="tok-definition">content</span>() {
    <span class="tok-keyword">if</span> (<span class="tok-keyword">this</span>.locked) <span class="tok-keyword">throw</span> <span class="tok-keyword">new</span> Error(<span class="tok-string">&quot;Locked!&quot;</span>);
    <span class="tok-keyword">return</span> <span class="tok-keyword">this</span>.#content;
  }
};

<span class="tok-keyword">function</span> <span class="tok-definition">withBoxUnlocked</span>(<span class="tok-definition">body</span>) {
  <span class="tok-comment">// Your code here.</span>
}

withBoxUnlocked(() =&gt; {
  box.content.push(<span class="tok-string">&quot;gold piece&quot;</span>);
});

<span class="tok-keyword">try</span> {
  withBoxUnlocked(() =&gt; {
    <span class="tok-keyword">throw</span> <span class="tok-keyword">new</span> Error(<span class="tok-string">&quot;Pirates on the horizon! Abort!&quot;</span>);
  });
} <span class="tok-keyword">catch</span> (<span class="tok-definition">e</span>) {
  console.log(<span class="tok-string">&quot;Error raised: &quot;</span> + e);
}
console.log(box.locked);
<span class="tok-comment">// ‚Üí true</span></pre>

<p><a class="p_ident" id="p-UCwwvERdRK" href="#p-UCwwvERdRK" tabindex="-1" role="presentation"></a>Para puntos adicionales, aseg√∫rate de que si llamas a <code>withBoxUnlocked</code> cuando la caja ya est√° desbloqueada, la caja permanezca desbloqueada.</p>

<details class="solution"><summary>Mostrar pistas...</summary><div class="solution-text">

<p><a class="p_ident" id="p-4//OlMF9n9" href="#p-4//OlMF9n9" tabindex="-1" role="presentation"></a>En este ejercicio, es posible que desees usar <code>try</code> y <code>finally</code> juntos. Tu funci√≥n deber√≠a desbloquear la caja y luego llamar a la funci√≥n de argumento desde dentro de un bloque <code>try</code>. El bloque <code>finally</code> despu√©s de √©l deber√≠a volver a bloquear la caja.</p>

<p><a class="p_ident" id="p-wmfeG1fAAE" href="#p-wmfeG1fAAE" tabindex="-1" role="presentation"></a>Para asegurarte de que no bloquees la caja cuando no estaba bloqueada, verifica su bloqueo al comienzo de la funci√≥n y desbloqu√©ala y bloqu√©ala solo cuando comenz√≥ bloqueada.</p>

</div></details><nav><a href="07_robot.html" title="previous chapter" aria-label="previous chapter">‚óÇ</a>¬†<a href="index.html" title="cover" aria-label="cover">‚óè</a>¬†<a href="09_regexp.html" title="next chapter" aria-label="next chapter">‚ñ∏</a>&nbsp;<button class=help title="help" aria-label="help"><strong>?</strong></button>&nbsp;<button class="dark-mode-toggle">üåô</button>
</nav>
</article>

<script src="ejs.js"></script>
