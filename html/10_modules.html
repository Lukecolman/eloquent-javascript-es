<!doctype html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>M√≥dulos :: Eloquent JavaScript</title>
  <link rel=stylesheet href="css/ejs.css"><script>
      var page = {"type":"chapter","number":10,"load_files":["code/packages_chapter_10.js","code/chapter/07_robot.js"]}</script></head>

<article>
<nav><a href="09_regexp.html" title="previous chapter" aria-label="previous chapter">‚óÇ</a>¬†<a href="index.html" title="cover" aria-label="cover">‚óè</a>¬†<a href="11_async.html" title="next chapter" aria-label="next chapter">‚ñ∏</a>&nbsp;<button class=help title="help" aria-label="help"><strong>?</strong></button>&nbsp;<button class="dark-mode-toggle">üåô</button>
</nav>

<h1>M√≥dulos</h1>

<blockquote>

<p><a class="p_ident" id="p-WivTB15C7Z" href="#p-WivTB15C7Z" tabindex="-1" role="presentation"></a>Escribe c√≥digo que sea f√°cil de borrar, no f√°cil de extender</p>

<footer>Tef, <cite>La programaci√≥n es terrible</cite></footer>

</blockquote><figure class="chapter framed"><img src="img/chapter_picture_10.jpg" alt="Ilustraci√≥n de un edificio complicado construido a partir de piezas modulares"></figure>

<p><a class="p_ident" id="p-EX80tfve2c" href="#p-EX80tfve2c" tabindex="-1" role="presentation"></a>Idealmente, un programa tiene una estructura clara y directa. La forma en que funciona es f√°cil de explicar, y cada parte desempe√±a un papel bien definido.</p>

<p><a class="p_ident" id="p-yilY+En/5q" href="#p-yilY+En/5q" tabindex="-1" role="presentation"></a>En la pr√°ctica, los programas crecen de forma org√°nica. Se a√±aden piezas de funcionalidad a medida que el programador identifica nuevas necesidades. Mantener un programa de esta manera bien estructurado requiere atenci√≥n y trabajo constantes. Este es un trabajo que solo dar√° sus frutos en el futuro, la pr√≥xima vez que alguien trabaje en el programa. Por lo tanto, es tentador descuidarlo y permitir que las diversas partes del programa se enreden profundamente.</p>

<p><a class="p_ident" id="p-NIf+VlR8cH" href="#p-NIf+VlR8cH" tabindex="-1" role="presentation"></a>Esto causa dos problemas pr√°cticos. Primero, entender un sistema enredado es dif√≠cil. Si todo puede afectar a todo lo dem√°s, es dif√≠cil ver cualquier pieza en aislamiento. Te ves obligado a construir una comprensi√≥n hol√≠stica de todo el conjunto. Segundo, si deseas utilizar alguna funcionalidad de dicho programa en otra situaci√≥n, puede ser m√°s f√°cil reescribirla que intentar desenredarla de su contexto.</p>

<p><a class="p_ident" id="p-dm9xK/uXlF" href="#p-dm9xK/uXlF" tabindex="-1" role="presentation"></a>La frase ‚Äúgran bola de barro‚Äù se usa a menudo para tales programas grandes y sin estructura. Todo se une, y al intentar sacar una pieza, todo el conjunto se desintegra y solo logras hacer un desastre.</p>

<h2><a class="h_ident" id="h-U7RnowObxe" href="#h-U7RnowObxe" tabindex="-1" role="presentation"></a>Programas modulares</h2>

<p><a class="p_ident" id="p-yGNt7m0TYo" href="#p-yGNt7m0TYo" tabindex="-1" role="presentation"></a>Los <em>m√≥dulos</em> son un intento de evitar estos problemas. Un m√≥dulo es una parte de un programa que especifica en qu√© otras piezas se basa y qu√© funcionalidad proporciona para que otros m√≥dulos la utilicen (su <em>interfaz</em>).</p>

<p><a class="p_ident" id="p-625KdRW5dL" href="#p-625KdRW5dL" tabindex="-1" role="presentation"></a>Las interfaces de los m√≥dulos tienen mucho en com√∫n con las interfaces de objetos, como las vimos en el <a href="06_object.html#interface">Cap√≠tulo 6</a>. Permiten que una parte del m√≥dulo est√© disponible para el mundo exterior y mantienen el resto privado.</p>

<p><a class="p_ident" id="p-gChcqY1zpK" href="#p-gChcqY1zpK" tabindex="-1" role="presentation"></a>Pero la interfaz que un m√≥dulo proporciona para que otros la utilicen es solo la mitad de la historia. Un buen sistema de m√≥dulos tambi√©n requiere que los m√≥dulos especifiquen qu√© c√≥digo <em>ellos</em> utilizan de otros m√≥dulos. Estas relaciones se llaman <em>dependencias</em>. Si el m√≥dulo A utiliza funcionalidad del m√≥dulo B, se dice que <em>depende</em> de √©l. Cuando estas dependencias se especifican claramente en el propio m√≥dulo, se pueden utilizar para averiguar qu√© otros m√≥dulos deben estar presentes para poder utilizar un m√≥dulo dado y cargar las dependencias autom√°ticamente.</p>

<p><a class="p_ident" id="p-JTdQELjKXQ" href="#p-JTdQELjKXQ" tabindex="-1" role="presentation"></a>Cuando las formas en que los m√≥dulos interact√∫an entre s√≠ son expl√≠citas, un sistema se vuelve m√°s como LEGO, donde las piezas interact√∫an a trav√©s de conectores bien definidos, y menos como barro, donde todo se mezcla con todo.</p>

<h2><a class="h_ident" id="h-YC3EaTrkii" href="#h-YC3EaTrkii" tabindex="-1" role="presentation"></a>M√≥dulos ES</h2>

<p><a class="p_ident" id="p-cFWVY8dCZa" href="#p-cFWVY8dCZa" tabindex="-1" role="presentation"></a>El lenguaje original JavaScript no ten√≠a ning√∫n concepto de un m√≥dulo. Todos los scripts se ejecutaban en el mismo √°mbito, y acceder a una funci√≥n definida en otro script se hac√≠a mediante la referencia a las vinculaciones globales creadas por ese script. Esto fomentaba activamente el enredo accidental y dif√≠cil de detectar del c√≥digo e invitaba a problemas como scripts no relacionados que intentaban usar el mismo nombre de vinculaci√≥n.</p>

<p><a class="p_ident" id="p-/LwUigk9I1" href="#p-/LwUigk9I1" tabindex="-1" role="presentation"></a>Desde ECMAScript 2015, JavaScript admite dos tipos diferentes de programas. Los <em>scripts</em> se comportan de la manera antigua: sus vinculaciones se definen en el √°mbito global y no tienen forma de referenciar directamente otros scripts. Los <em>m√≥dulos</em> obtienen su propio √°mbito separado y admiten las palabras clave <code>import</code> y <code>export</code>, que no est√°n disponibles en los scripts, para declarar sus dependencias e interfaz. Este sistema de m√≥dulos se suele llamar <em>m√≥dulos de ES</em> (donde ‚ÄúES‚Äù significa ‚ÄúECMAScript‚Äù).</p>

<p><a class="p_ident" id="p-oP+GsCLjlM" href="#p-oP+GsCLjlM" tabindex="-1" role="presentation"></a>Un programa modular est√° compuesto por varios de estos m√≥dulos, conectados a trav√©s de sus importaciones y exportaciones.</p>

<p><a class="p_ident" id="p-TTzOObeni+" href="#p-TTzOObeni+" tabindex="-1" role="presentation"></a>Este ejemplo de m√≥dulo convierte entre nombres de d√≠as y n√∫meros (como los devueltos por el m√©todo <code>getDay</code> de <code>Date</code>). Define una constante que no forma parte de su interfaz y dos funciones que s√≠ lo son. No tiene dependencias.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-8bQqoNLteX" href="#c-8bQqoNLteX" tabindex="-1" role="presentation"></a><span class="tok-keyword">const</span> <span class="tok-definition">names</span> = [<span class="tok-string">&quot;Domingo&quot;</span>, <span class="tok-string">&quot;Lunes&quot;</span>, <span class="tok-string">&quot;Martes&quot;</span>, <span class="tok-string">&quot;Mi√©rcoles&quot;</span>,
               <span class="tok-string">&quot;Jueves&quot;</span>, <span class="tok-string">&quot;Viernes&quot;</span>, <span class="tok-string">&quot;S√°bado&quot;</span>];

<span class="tok-keyword">export</span> <span class="tok-keyword">function</span> <span class="tok-definition">dayName</span>(<span class="tok-definition">number</span>) {
  <span class="tok-keyword">return</span> names[number];
}
<span class="tok-keyword">export</span> <span class="tok-keyword">function</span> <span class="tok-definition">dayNumber</span>(<span class="tok-definition">name</span>) {
  <span class="tok-keyword">return</span> names.indexOf(name);
}</pre>

<p><a class="p_ident" id="p-HBLfYi8Cx0" href="#p-HBLfYi8Cx0" tabindex="-1" role="presentation"></a>La palabra clave <code>export</code> se puede colocar delante de una funci√≥n, clase o definici√≥n de vinculaci√≥n para indicar que esa vinculaci√≥n es parte de la interfaz del m√≥dulo. Esto permite que otros m√≥dulos utilicen esa vinculaci√≥n import√°ndola.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-Sub1Ei6VzK" href="#c-Sub1Ei6VzK" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">dayName</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;./dayname.js&quot;</span>;
<span class="tok-keyword">let</span> <span class="tok-definition">ahora</span> = <span class="tok-keyword">new</span> Date();
console.log(<span class="tok-string2">`Hoy es </span>${dayName(ahora.getDay())}<span class="tok-string2">`</span>);
<span class="tok-comment">// ‚Üí Hoy es Lunes</span></pre>

<p><a class="p_ident" id="p-/pMtoDSh3q" href="#p-/pMtoDSh3q" tabindex="-1" role="presentation"></a>La palabra clave <code>import</code>, seguida de una lista de nombres de vinculaci√≥n entre llaves, hace que las vinculaciones de otro m√≥dulo est√©n disponibles en el m√≥dulo actual. Los m√≥dulos se identifican por cadenas entre comillas.</p>

<p><a class="p_ident" id="p-bC1R/meysi" href="#p-bC1R/meysi" tabindex="-1" role="presentation"></a>C√≥mo se resuelve un nombre de m√≥dulo a un programa real difiere seg√∫n la plataforma. El navegador los trata como direcciones web, mientras que Node.js los resuelve a archivos. Para ejecutar un m√≥dulo, se cargan todos los dem√°s m√≥dulos en los que depende, y las vinculaciones exportadas se ponen a disposici√≥n de los m√≥dulos que las importan.</p>

<p><a class="p_ident" id="p-Ie1lG7aO5o" href="#p-Ie1lG7aO5o" tabindex="-1" role="presentation"></a>Las declaraciones de importaci√≥n y exportaci√≥n no pueden aparecer dentro de funciones, bucles u otros bloques. Se resuelven de inmediato cuando se carga el m√≥dulo, independientemente de c√≥mo se ejecute el c√≥digo en el m√≥dulo, y para reflejar esto, deben aparecer solo en el cuerpo del m√≥dulo externo.</p>

<p><a class="p_ident" id="p-dP1OiguXg/" href="#p-dP1OiguXg/" tabindex="-1" role="presentation"></a>As√≠ que la interfaz de un m√≥dulo consiste en una colecci√≥n de vinculaciones con nombres, a las cuales tienen acceso otros m√≥dulos que dependen de ellas. Las vinculaciones importadas se pueden renombrar para darles un nuevo nombre local utilizando <code>as</code> despu√©s de su nombre.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-BDdYywvaeN" href="#c-BDdYywvaeN" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {dayName <span class="tok-keyword">as</span> <span class="tok-definition">nomDeJour</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;./dayname.js&quot;</span>;
console.log(nomDeJour(<span class="tok-number">3</span>));
<span class="tok-comment">// ‚Üí Mi√©rcoles</span></pre>

<p><a class="p_ident" id="p-S+JFe+/ZwS" href="#p-S+JFe+/ZwS" tabindex="-1" role="presentation"></a>Tambi√©n es posible que un m√≥dulo tenga una exportaci√≥n especial llamada <code>default</code>, que a menudo se usa para m√≥dulos que solo exportan un √∫nico enlace. Para definir una exportaci√≥n predeterminada, se escribe <code>export default</code> antes de una expresi√≥n, una declaraci√≥n de funci√≥n o una declaraci√≥n de clase.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-X+WnaBkeaP" href="#c-X+WnaBkeaP" tabindex="-1" role="presentation"></a><span class="tok-keyword">export</span> <span class="tok-keyword">default</span> [<span class="tok-string">&quot;Invierno&quot;</span>, <span class="tok-string">&quot;Primavera&quot;</span>, <span class="tok-string">&quot;Verano&quot;</span>, <span class="tok-string">&quot;Oto√±o&quot;</span>];</pre>

<p><a class="p_ident" id="p-9S8FRU/waO" href="#p-9S8FRU/waO" tabindex="-1" role="presentation"></a>Este enlace se importa omitiendo las llaves alrededor del nombre de la importaci√≥n.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-+zRyOTSTAA" href="#c-+zRyOTSTAA" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> <span class="tok-definition">nombresEstaciones</span> <span class="tok-keyword">from</span> <span class="tok-string">&quot;./nombrsestaciones.js&quot;</span>;</pre>

<h2><a class="h_ident" id="h-/mspf0oEoK" href="#h-/mspf0oEoK" tabindex="-1" role="presentation"></a>Paquetes</h2>

<p><a class="p_ident" id="p-5s4XEpecqW" href="#p-5s4XEpecqW" tabindex="-1" role="presentation"></a>Una de las ventajas de construir un programa a partir de piezas separadas y poder ejecutar algunas de esas piezas por separado, es que puedes aplicar la misma pieza en diferentes programas.</p>

<p><a class="p_ident" id="p-1YfLMLVIb+" href="#p-1YfLMLVIb+" tabindex="-1" role="presentation"></a>Pero, ¬øc√≥mo se configura esto? Digamos que quiero usar la funci√≥n <code>parseINI</code> de <a href="09_regexp.html#ini">Cap√≠tulo 9</a> en otro programa. Si est√° claro de qu√© depende la funci√≥n (en este caso, nada), puedo simplemente copiar ese m√≥dulo en mi nuevo proyecto y usarlo. Pero luego, si encuentro un error en el c√≥digo, probablemente lo corrija en el programa con el que estoy trabajando en ese momento y olvide corregirlo tambi√©n en el otro programa.</p>

<p><a class="p_ident" id="p-vGdlRRXoCw" href="#p-vGdlRRXoCw" tabindex="-1" role="presentation"></a>Una vez que empieces a duplicar c√≥digo, r√°pidamente te dar√°s cuenta de que est√°s perdiendo tiempo y energ√≠a moviendo copias y manteni√©ndolas actualizadas.</p>

<p><a class="p_ident" id="p-fQS8IzdsnB" href="#p-fQS8IzdsnB" tabindex="-1" role="presentation"></a>Ah√≠ es donde entran los <em>paquetes</em>. Un paquete es un fragmento de c√≥digo que se puede distribuir (copiar e instalar). Puede contener uno o m√°s m√≥dulos y tiene informaci√≥n sobre en qu√© otros paquetes depende. Un paquete tambi√©n suele venir con documentaci√≥n que explica qu√© hace para que las personas que no lo escribieron a√∫n puedan usarlo.</p>

<p><a class="p_ident" id="p-xBz/AUEgrE" href="#p-xBz/AUEgrE" tabindex="-1" role="presentation"></a>Cuando se encuentra un problema en un paquete o se a√±ade una nueva caracter√≠stica, se actualiza el paquete. Ahora los programas que dependen de √©l (que tambi√©n pueden ser paquetes) pueden copiar la nueva versi√≥n para obtener las mejoras que se hicieron en el c√≥digo.</p>

<p id="modules_npm"><a class="p_ident" id="p-gLwdFzz5mL" href="#p-gLwdFzz5mL" tabindex="-1" role="presentation"></a>Trabajar de esta manera requiere infraestructura. Necesitamos un lugar para almacenar y encontrar paquetes y una forma conveniente de instalar y actualizarlos. En el mundo de JavaScript, esta infraestructura es provista por NPM (<a href="https://npmjs.org"><em>https://npmjs.org</em></a>).</p>

<p><a class="p_ident" id="p-kkiTHcsTLq" href="#p-kkiTHcsTLq" tabindex="-1" role="presentation"></a>NPM es dos cosas: un servicio en l√≠nea donde puedes descargar (y subir) paquetes y un programa (incluido con Node.js) que te ayuda a instalar y gestionarlos.</p>

<p><a class="p_ident" id="p-tOycnX3WYO" href="#p-tOycnX3WYO" tabindex="-1" role="presentation"></a>En el momento de la escritura, hay m√°s de tres millones de paquetes diferentes disponibles en NPM. Una gran parte de ellos son basura, para ser honesto. Pero casi cada paquete de JavaScript √∫til y disponible p√∫blicamente se puede encontrar en NPM. Por ejemplo, un analizador de archivos INI, similar al que construimos en el <a href="09_regexp.html">Cap√≠tulo 9</a>, est√° disponible bajo el nombre del paquete <code>ini</code>.</p>

<p><a class="p_ident" id="p-yqgOfKlOJr" href="#p-yqgOfKlOJr" tabindex="-1" role="presentation"></a><a href="20_node.html">Cap√≠tulo 20</a> mostrar√° c√≥mo instalar tales paquetes localmente usando el programa de l√≠nea de comandos <code>npm</code>.</p>

<p><a class="p_ident" id="p-APTB7TqcHI" href="#p-APTB7TqcHI" tabindex="-1" role="presentation"></a>Tener paquetes de calidad disponibles para descargar es extremadamente valioso. Significa que a menudo podemos evitar reinventar un programa que 100 personas han escrito antes y obtener una implementaci√≥n s√≥lida y bien probada con solo presionar algunas teclas.</p>

<p><a class="p_ident" id="p-WISEoIhSHx" href="#p-WISEoIhSHx" tabindex="-1" role="presentation"></a>El software es barato de copiar, por lo que una vez que alguien lo ha escrito, distribuirlo a otras personas es un proceso eficiente. Pero escribirlo en primer lugar <em>es</em> trabajo, y responder a las personas que han encontrado problemas en el c√≥digo, o que desean proponer nuevas caracter√≠sticas, es incluso m√°s trabajo.</p>

<p><a class="p_ident" id="p-KBJ7XL1akK" href="#p-KBJ7XL1akK" tabindex="-1" role="presentation"></a>Por defecto, eres el propietario de los derechos de autor del c√≥digo que escribes, y otras personas solo pueden usarlo con tu permiso. Pero porque algunas personas son amables y porque publicar buen software puede ayudarte a volverte un poco famoso entre los programadores, muchos paquetes se publican bajo una licencia que permite expl√≠citamente a otras personas usarlo.</p>

<p><a class="p_ident" id="p-qxh3ylw/2A" href="#p-qxh3ylw/2A" tabindex="-1" role="presentation"></a>La mayor√≠a del c√≥digo en NPM tiene esta licencia. Algunas licencias requieren que tambi√©n publiques el c√≥digo que construyes sobre el paquete bajo la misma licencia. Otros son menos exigentes, simplemente requiriendo que mantengas la licencia con el c√≥digo al distribuirlo. La comunidad de JavaScript mayormente utiliza este √∫ltimo tipo de licencia. Al usar paquetes de otras personas, aseg√∫rate de estar al tanto de su licencia.</p>

<p id="modulos_ini"><a class="p_ident" id="p-jSx9hd0EOB" href="#p-jSx9hd0EOB" tabindex="-1" role="presentation"></a>Ahora, en lugar de escribir nuestro propio analizador de archivos INI, podemos usar uno de NPM.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-zTHcTC2U1Z" href="#c-zTHcTC2U1Z" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">parse</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;ini&quot;</span>;

console.log(parse(<span class="tok-string">&quot;x = 10</span><span class="tok-string2">\n</span><span class="tok-string">y = 20&quot;</span>));
<span class="tok-comment">// ‚Üí {x: &quot;10&quot;, y: &quot;20&quot;}</span></pre>

<h2 id="commonjs"><a class="h_ident" id="h-aoKuTQ1GvS" href="#h-aoKuTQ1GvS" tabindex="-1" role="presentation"></a>M√≥dulos CommonJS</h2>

<p><a class="p_ident" id="p-gL2Y0VXAPv" href="#p-gL2Y0VXAPv" tabindex="-1" role="presentation"></a>Antes de 2015, cuando el lenguaje de JavaScript no ten√≠a un sistema de m√≥dulos integrado real, las personas ya estaban construyendo sistemas grandes en JavaScript. Para que funcionara, ellos <em>necesitaban</em> m√≥dulos.</p>

<p><a class="p_ident" id="p-wJ8IhSNMb2" href="#p-wJ8IhSNMb2" tabindex="-1" role="presentation"></a>La comunidad dise√±√≥ sus propios sistemas de m√≥dulos improvisados sobre el lenguaje. Estos utilizan funciones para crear un alcance local para los m√≥dulos y objetos regulares para representar interfaces de m√≥dulos.</p>

<p><a class="p_ident" id="p-38+Catnyuk" href="#p-38+Catnyuk" tabindex="-1" role="presentation"></a>Inicialmente, las personas simplemente envolv√≠an manualmente todo su m√≥dulo en una ‚Äúexpresi√≥n de funci√≥n invocada inmediatamente‚Äù para crear el alcance del m√≥dulo, y asignaban sus objetos de interfaz a una √∫nica variable global.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-tcyWCNmnRJ" href="#c-tcyWCNmnRJ" tabindex="-1" role="presentation"></a><span class="tok-keyword">const</span> <span class="tok-definition">semana</span> = <span class="tok-keyword">function</span>() {
  <span class="tok-keyword">const</span> <span class="tok-definition">nombres</span> = [<span class="tok-string">&quot;Domingo&quot;</span>, <span class="tok-string">&quot;Lunes&quot;</span>, <span class="tok-string">&quot;Martes&quot;</span>, <span class="tok-string">&quot;Mi√©rcoles&quot;</span>,
                 <span class="tok-string">&quot;Jueves&quot;</span>, <span class="tok-string">&quot;Viernes&quot;</span>, <span class="tok-string">&quot;S√°bado&quot;</span>];
  <span class="tok-keyword">return</span> {
    <span class="tok-definition">nombre</span>(<span class="tok-definition">numero</span>) { <span class="tok-keyword">return</span> nombres[numero]; },
    <span class="tok-definition">numero</span>(<span class="tok-definition">nombre</span>) { <span class="tok-keyword">return</span> nombres.indexOf(nombre); }
  };
}();

console.log(semana.nombre(semana.numero(<span class="tok-string">&quot;Domingo&quot;</span>)));
<span class="tok-comment">// ‚Üí Domingo</span></pre>

<p><a class="p_ident" id="p-1Nis/4GWsb" href="#p-1Nis/4GWsb" tabindex="-1" role="presentation"></a>Este estilo de m√≥dulos proporciona aislamiento, hasta cierto punto, pero no declara dependencias. En cambio, simplemente coloca su interfaz en el √°mbito global y espera que sus dependencias, si las tiene, hagan lo mismo. Esto no es ideal.</p>

<p><a class="p_ident" id="p-6mhHLUjbEJ" href="#p-6mhHLUjbEJ" tabindex="-1" role="presentation"></a>Si implementamos nuestro propio cargador de m√≥dulos, podemos hacerlo mejor. El enfoque m√°s ampliamente utilizado para los m√≥dulos de JavaScript agregados se llama <em>M√≥dulos CommonJS</em>. Node.js lo utilizaba desde el principio (aunque ahora tambi√©n sabe c√≥mo cargar m√≥dulos ES) y es el sistema de m√≥dulos utilizado por muchos paquetes en NPM.</p>

<p><a class="p_ident" id="p-4CiiEAoKta" href="#p-4CiiEAoKta" tabindex="-1" role="presentation"></a>Un m√≥dulo CommonJS se ve como un script regular, pero tiene acceso a dos enlaces que utiliza para interactuar con otros m√≥dulos. El primero es una funci√≥n llamada <code>require</code>. Cuando llamas a esto con el nombre del m√≥dulo de tu dependencia, se asegura de que el m√≥dulo est√© cargado y devuelve su interfaz. El segundo es un objeto llamado <code>exports</code>, que es el objeto de interfaz para el m√≥dulo. Comienza vac√≠o y agregas propiedades para definir los valores exportados.</p>

<p><a class="p_ident" id="p-T5/54GHTSi" href="#p-T5/54GHTSi" tabindex="-1" role="presentation"></a>Este m√≥dulo de ejemplo CommonJS proporciona una funci√≥n de formateo de fechas. Utiliza dos packages de NPM: <code>ordinal</code> para convertir n√∫meros en strings como <code>&quot;1st&quot;</code> y <code>&quot;2nd&quot;</code>, y <code>date-names</code> para obtener los nombres en ingl√©s de los d√≠as de la semana y los meses. Exporta una √∫nica funci√≥n, <code>formatDate</code>, que recibe un objeto <code>Date</code> y una cadena template.</p>

<p><a class="p_ident" id="p-xUg6iYrQ1R" href="#p-xUg6iYrQ1R" tabindex="-1" role="presentation"></a>La cadena de template puede contener c√≥digos que indican el formato, como <code>YYYY</code> para el a√±o completo y <code>Do</code> para el d√≠a ordinal del mes. Puede pas√°rsele una cadena como <code>&quot;MMMM Do YYYY&quot;</code> para obtener una salida como ‚Äú22 de noviembre de 2017‚Äù.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-hEFnba6fud" href="#c-hEFnba6fud" tabindex="-1" role="presentation"></a><span class="tok-keyword">const</span> <span class="tok-definition">ordinal</span> = require(<span class="tok-string">&quot;ordinal&quot;</span>);
<span class="tok-keyword">const</span> {days, months} = require(<span class="tok-string">&quot;date-names&quot;</span>);

exports.formatDate = <span class="tok-keyword">function</span>(<span class="tok-definition">date</span>, <span class="tok-definition">format</span>) {
  <span class="tok-keyword">return</span> format.replace(<span class="tok-string2">/YYYY|M(MMM)?|Do?|dddd/g</span>, <span class="tok-definition">tag</span> =&gt; {
    <span class="tok-keyword">if</span> (tag == <span class="tok-string">&quot;YYYY&quot;</span>) <span class="tok-keyword">return</span> date.getFullYear();
    <span class="tok-keyword">if</span> (tag == <span class="tok-string">&quot;M&quot;</span>) <span class="tok-keyword">return</span> date.getMonth();
    <span class="tok-keyword">if</span> (tag == <span class="tok-string">&quot;MMMM&quot;</span>) <span class="tok-keyword">return</span> months[date.getMonth()];
    <span class="tok-keyword">if</span> (tag == <span class="tok-string">&quot;D&quot;</span>) <span class="tok-keyword">return</span> date.getDate();
    <span class="tok-keyword">if</span> (tag == <span class="tok-string">&quot;Do&quot;</span>) <span class="tok-keyword">return</span> ordinal(date.getDate());
    <span class="tok-keyword">if</span> (tag == <span class="tok-string">&quot;dddd&quot;</span>) <span class="tok-keyword">return</span> days[date.getDay()];
  });
};</pre>

<p><a class="p_ident" id="p-rSv7twJ8lD" href="#p-rSv7twJ8lD" tabindex="-1" role="presentation"></a>La interfaz de <code>ordinal</code> es una √∫nica funci√≥n, mientras que <code>date-names</code> exporta un objeto que contiene m√∫ltiples cosas: <code>days</code> y <code>months</code> son arrays de nombres. La t√©cnica de desestructuraci√≥n es muy conveniente al crear enlaces para las interfaces importadas.</p>

<p><a class="p_ident" id="p-GEs894RmkW" href="#p-GEs894RmkW" tabindex="-1" role="presentation"></a>El m√≥dulo a√±ade su funci√≥n de interfaz a <code>exports</code> para que los m√≥dulos que dependen de √©l tengan acceso a ella. Podemos usar el m√≥dulo de la siguiente manera:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-UjqCqg9xZu" href="#c-UjqCqg9xZu" tabindex="-1" role="presentation"></a><span class="tok-keyword">const</span> {formatDate} = require(<span class="tok-string">&quot;./format-date.js&quot;</span>);

console.log(formatDate(<span class="tok-keyword">new</span> Date(<span class="tok-number">2017</span>, <span class="tok-number">9</span>, <span class="tok-number">13</span>),
                       <span class="tok-string">&quot;dddd the Do&quot;</span>));
<span class="tok-comment">// ‚Üí Viernes 13¬∫</span></pre>

<p><a class="p_ident" id="p-w8OOiotBia" href="#p-w8OOiotBia" tabindex="-1" role="presentation"></a>CommonJS se implementa con un cargador de m√≥dulos que, al cargar un m√≥dulo, envuelve su c√≥digo en una funci√≥n (d√°ndole su propio √°mbito local) y pasa los enlaces <code>require</code> y <code>exports</code> a esa funci√≥n como argumentos.</p>

<p id="require"><a class="p_ident" id="p-AI+ai+x54D" href="#p-AI+ai+x54D" tabindex="-1" role="presentation"></a>Si asumimos que tenemos acceso a una funci√≥n <code>readFile</code> que lee un archivo por su nombre y nos da su contenido, podemos definir una forma simplificada de <code>require</code> de la siguiente manera:</p>

<pre tabindex="0" class="snippet" data-language="javascript"  data-sandbox="require"><a class="c_ident" id="c-t+bc73kgqw" href="#c-t+bc73kgqw" tabindex="-1" role="presentation"></a><span class="tok-keyword">function</span> <span class="tok-definition">require</span>(<span class="tok-definition">name</span>) {
  <span class="tok-keyword">if</span> (!(name <span class="tok-keyword">in</span> require.cache)) {
    <span class="tok-keyword">let</span> <span class="tok-definition">code</span> = readFile(name);
    <span class="tok-keyword">let</span> <span class="tok-definition">exports</span> = require.cache[name] = {};
    <span class="tok-keyword">let</span> <span class="tok-definition">wrapper</span> = Function(<span class="tok-string">&quot;require, exports&quot;</span>, code);
    wrapper(require, exports);
  }
  <span class="tok-keyword">return</span> require.cache[name];
}
require.cache = Object.create(<span class="tok-keyword">null</span>);</pre>

<p id="eval"><a class="p_ident" id="p-Uqkk1Gr/cR" href="#p-Uqkk1Gr/cR" tabindex="-1" role="presentation"></a><code>Function</code> es una funci√≥n interna de JavaScript que recibe una lista de argumentos (como una cadena separada por comas) y una cadena que contiene el cuerpo de la funci√≥n, devolviendo un valor de funci√≥n con esos argumentos y ese cuerpo. Este es un concepto interesante, ya que permite que un programa cree nuevas partes del programa a partir de datos de cadena, pero tambi√©n es peligroso, ya que si alguien logra enga√±ar a tu programa para que introduzca una cadena que ellos proporcionan en <code>Function</code>, pueden hacer que el programa haga cualquier cosa que quieran.</p>

<p><a class="p_ident" id="p-hzt+dyc2ak" href="#p-hzt+dyc2ak" tabindex="-1" role="presentation"></a>JavaScript est√°ndar no proporciona una funci√≥n como <code>readFile</code>, pero diferentes entornos de JavaScript, como el navegador y Node.js, proporcionan sus propias formas de acceder a los archivos. El ejemplo simplemente simula que <code>readFile</code> existe.</p>

<p><a class="p_ident" id="p-DdUC56tlYx" href="#p-DdUC56tlYx" tabindex="-1" role="presentation"></a>Para evitar cargar el mismo m√≥dulo m√∫ltiples veces, <code>require</code> mantiene una tienda (cach√©) de m√≥dulos ya cargados. Cuando se llama, primero comprueba si el m√≥dulo solicitado ha sido cargado y, si no, lo carga. Esto implica leer el c√≥digo del m√≥dulo, envolverlo en una funci√≥n y llamarlo.</p>

<p><a class="p_ident" id="p-SN2EFHIPHc" href="#p-SN2EFHIPHc" tabindex="-1" role="presentation"></a>Al definir <code>require</code>, <code>exports</code> como par√°metros para la funci√≥n de envoltura generada (y pasar los valores apropiados al llamarla), el cargador se asegura de que estos enlaces est√©n disponibles en el √°mbito del m√≥dulo.</p>

<p><a class="p_ident" id="p-2Efp/NfTnP" href="#p-2Efp/NfTnP" tabindex="-1" role="presentation"></a>Una diferencia importante entre este sistema y los m√≥dulos ES es que las importaciones de m√≥dulos ES suceden antes de que comience a ejecutarse el script de un m√≥dulo, mientras que <code>require</code> es una funci√≥n normal, invocada cuando el m√≥dulo ya est√° en ejecuci√≥n. A diferencia de las declaraciones <code>import</code>, las llamadas a <code>require</code> <em>pueden</em> aparecer dentro de funciones, y el nombre de la dependencia puede ser cualquier expresi√≥n que se eval√∫e a una cadena, mientras que <code>import</code> solo permite cadenas simples entre comillas.</p>

<p><a class="p_ident" id="p-e5KpMKLZw3" href="#p-e5KpMKLZw3" tabindex="-1" role="presentation"></a>La transici√≥n de la comunidad de JavaScript desde el estilo CommonJS a los m√≥dulos ES ha sido lenta y algo complicada. Pero afortunadamente, ahora estamos en un punto en el que la mayor√≠a de los paquetes populares en NPM proporcionan su c√≥digo como m√≥dulos ES, y Node.js permite que los m√≥dulos ES importen desde m√≥dulos CommonJS. Por lo tanto, si bien el c√≥digo CommonJS es algo con lo que te encontrar√°s, ya no hay una raz√≥n real para escribir nuevos programas en este estilo.</p>

<h2><a class="h_ident" id="h-MTtaNNMhF9" href="#h-MTtaNNMhF9" tabindex="-1" role="presentation"></a>Compilaci√≥n y empaquetado</h2>

<p><a class="p_ident" id="p-yzlMlomsVd" href="#p-yzlMlomsVd" tabindex="-1" role="presentation"></a>Muchos paquetes de JavaScript no est√°n, t√©cnicamente, escritos en JavaScript. Hay extensiones, como TypeScript, el dialecto de verificaci√≥n de tipos mencionado en el <a href="08_error.html#typing">Cap√≠tulo 8</a>, que se utilizan ampliamente. A menudo, las personas tambi√©n comienzan a usar extensiones planeadas para el lenguaje mucho antes de que se agreguen a las plataformas que realmente ejecutan JavaScript.</p>

<p><a class="p_ident" id="p-WF1sdYjiV8" href="#p-WF1sdYjiV8" tabindex="-1" role="presentation"></a>Para hacer esto posible, <em>compilan</em> su c√≥digo, traduci√©ndolo desde su dialecto de JavaScript elegido a JavaScript antiguo, e incluso a una versi√≥n anterior de JavaScript, para que los navegadores puedan ejecutarlo.</p>

<p><a class="p_ident" id="p-qcgO5h1rKl" href="#p-qcgO5h1rKl" tabindex="-1" role="presentation"></a>Incluir un programa modular que consta de 200 archivos diferentes en una p√°gina web produce sus propios problemas. Si recuperar un solo archivo a trav√©s de la red lleva 50 milisegundos, cargar todo el programa lleva 10 segundos, o quiz√°s la mitad de eso si puedes cargar varios archivos simult√°neamente. Eso es mucho tiempo desperdiciado. Como recuperar un solo archivo grande tiende a ser m√°s r√°pido que recuperar muchos archivos peque√±os, los programadores web han comenzado a usar herramientas que combinan sus programas (que dividieron minuciosamente en m√≥dulos) en un solo archivo grande antes de publicarlo en la Web. Estas herramientas se llaman <em>bundlers</em>.</p>

<p><a class="p_ident" id="p-QbvQ4uTYWV" href="#p-QbvQ4uTYWV" tabindex="-1" role="presentation"></a>Y podemos ir m√°s all√°. Aparte del n√∫mero de archivos, el <em>tama√±o</em> de los archivos tambi√©n determina qu√© tan r√°pido pueden ser transferidos a trav√©s de la red. Por lo tanto, la comunidad de JavaScript ha inventado <em>minificadores</em>. Estas son herramientas que toman un programa de JavaScript y lo hacen m√°s peque√±o al eliminar autom√°ticamente comentarios y espacios en blanco, renombrar enlaces y reemplazar fragmentos de c√≥digo con c√≥digo equivalente que ocupa menos espacio.</p>

<p><a class="p_ident" id="p-vTIW0dWF7B" href="#p-vTIW0dWF7B" tabindex="-1" role="presentation"></a>Por lo tanto, no es raro que el c√≥digo que encuentres en un paquete de NPM o que se ejecute en una p√°gina web haya pasado por <em>m√∫ltiples</em> etapas de transformaci√≥n, convirti√©ndose desde JavaScript moderno a JavaScript hist√≥rico, luego combinando los m√≥dulos en un solo archivo, y minimizando el c√≥digo. No entraremos en detalles sobre estas herramientas en este libro ya que hay muchas de ellas, y cu√°l es popular cambia regularmente. Simplemente ten en cuenta que tales cosas existen, y b√∫scalas cuando las necesites.</p>

<h2><a class="h_ident" id="h-1WDZH0cb8f" href="#h-1WDZH0cb8f" tabindex="-1" role="presentation"></a>Dise√±o de m√≥dulos</h2>

<p><a class="p_ident" id="p-R7pz6CLzKn" href="#p-R7pz6CLzKn" tabindex="-1" role="presentation"></a>Estructurar programas es uno de los aspectos m√°s sutiles de la programaci√≥n. Cualquier funcionalidad no trivial puede ser organizada de diversas formas.</p>

<p><a class="p_ident" id="p-gQbZwhLBAU" href="#p-gQbZwhLBAU" tabindex="-1" role="presentation"></a>Un buen dise√±o de programa es subjetivo‚Äîhay compensaciones implicadas y cuestiones de gusto. La mejor manera de aprender el valor de un dise√±o bien estructurado es leer o trabajar en muchos programas y notar qu√© funciona y qu√© no. No asumas que un desorden doloroso es ‚Äúsimplemente as√≠‚Äù. Puedes mejorar la estructura de casi todo pensando m√°s detenidamente en ello.</p>

<p><a class="p_ident" id="p-42LbB+uOK4" href="#p-42LbB+uOK4" tabindex="-1" role="presentation"></a>Un aspecto del dise√±o de m√≥dulos es la facilidad de uso. Si est√°s dise√±ando algo que se supone ser√° utilizado por varias personas‚Äîo incluso por ti mismo, dentro de tres meses cuando ya no recuerdes los detalles de lo que hiciste‚Äîes √∫til que tu interfaz sea simple y predecible.</p>

<p><a class="p_ident" id="p-KeQc3IaY1/" href="#p-KeQc3IaY1/" tabindex="-1" role="presentation"></a>Eso puede significar seguir convenciones existentes. Un buen ejemplo es el paquete <code>ini</code>. Este m√≥dulo imita el objeto est√°ndar <code>JSON</code> al proporcionar funciones <code>parse</code> y <code>stringify</code> (para escribir un archivo INI), y, como <code>JSON</code>, convierte entre cadenas y objetos simples. Por lo tanto, la interfaz es peque√±a y familiar, y despu√©s de haber trabajado con ella una vez, es probable que recuerdes c√≥mo usarla.</p>

<p><a class="p_ident" id="p-T3tXk/ILoH" href="#p-T3tXk/ILoH" tabindex="-1" role="presentation"></a>Incluso si no hay una funci√≥n est√°ndar o paquete ampliamente utilizado para imitar, puedes mantener tus m√≥dulos predecibles utilizando estructuras de datos simples y haciendo una sola cosa enfocada. Muchos de los m√≥dulos de an√°lisis de archivos INI en NPM proporcionan una funci√≥n que lee directamente dicho archivo desde el disco duro y lo analiza, por ejemplo. Esto hace imposible usar dichos m√≥dulos en el navegador, donde no tenemos acceso directo al sistema de archivos, y a√±ade complejidad que hubiera sido mejor abordada <em>componiendo</em> el m√≥dulo con alguna funci√≥n de lectura de archivos.</p>

<p><a class="p_ident" id="p-PdHEezCz8n" href="#p-PdHEezCz8n" tabindex="-1" role="presentation"></a>Esto se√±ala otro aspecto √∫til del dise√±o de m√≥dulos‚Äîla facilidad con la que algo puede ser compuesto con otro c√≥digo. Los m√≥dulos enfocados en calcular valores son aplicables en una gama m√°s amplia de programas que los m√≥dulos m√°s grandes que realizan acciones complicadas con efectos secundarios. Un lector de archivos INI que insiste en leer el archivo desde el disco es in√∫til en un escenario donde el contenido del archivo proviene de otra fuente.</p>

<p><a class="p_ident" id="p-f+ylIT0L4/" href="#p-f+ylIT0L4/" tabindex="-1" role="presentation"></a>Relacionado con esto, a veces los objetos con estado son √∫tiles o incluso necesarios, pero si algo se puede hacer con una funci√≥n, utiliza una funci√≥n. Varios de los lectores de archivos INI en NPM proporcionan un estilo de interfaz que requiere que primero crees un objeto, luego cargues el archivo en tu objeto, y finalmente uses m√©todos especializados para acceder a los resultados. Este tipo de enfoque es com√∫n en la tradici√≥n orientada a objetos, y es terrible. En lugar de hacer una sola llamada a funci√≥n y continuar, debes realizar el ritual de mover tu objeto a trav√©s de sus diversos estados. Y debido a que los datos est√°n envueltos en un tipo de objeto especializado, todo el c√≥digo que interact√∫a con √©l debe conocer ese tipo, creando interdependencias innecesarias.</p>

<p><a class="p_ident" id="p-JsFAJjYsmz" href="#p-JsFAJjYsmz" tabindex="-1" role="presentation"></a>A menudo, no se puede evitar definir nuevas estructuras de datos, ya que el est√°ndar del lenguaje proporciona solo algunas b√°sicas, y muchos tipos de datos deben ser m√°s complejos que un array o un mapa. Pero cuando un array es suficiente, utiliza un array.</p>

<p><a class="p_ident" id="p-lgijdltjB6" href="#p-lgijdltjB6" tabindex="-1" role="presentation"></a>Un ejemplo de una estructura de datos ligeramente m√°s compleja es el grafo de <a href="07_robot.html">Cap√≠tulo 7</a>. No hay una forma √∫nica obvia de representar un grafo en JavaScript. En ese cap√≠tulo, utilizamos un objeto cuyas propiedades contienen arrays de strings: los otros nodos alcanzables desde ese nodo.</p>

<p><a class="p_ident" id="p-ENslNQQZif" href="#p-ENslNQQZif" tabindex="-1" role="presentation"></a>Existen varios paquetes de b√∫squeda de rutas en NPM, pero ninguno de ellos utiliza este formato de grafo. Por lo general, permiten que las aristas del grafo tengan un peso, que es el costo o la distancia asociada a ellas. Eso no es posible en nuestra representaci√≥n.</p>

<p><a class="p_ident" id="p-Nyp7yR1Ls4" href="#p-Nyp7yR1Ls4" tabindex="-1" role="presentation"></a>Por ejemplo, est√° el paquete <code>dijkstrajs</code>. Un enfoque conocido para la b√∫squeda de rutas, bastante similar a nuestra funci√≥n <code>findRoute</code>, se llama <em>algoritmo de Dijkstra</em>, en honor a Edsger Dijkstra, quien lo escribi√≥ por primera vez. A menudo se agrega el sufijo <code>js</code> a los nombres de los paquetes para indicar que est√°n escritos en JavaScript. Este paquete <code>dijkstrajs</code> utiliza un formato de grafo similar al nuestro, pero en lugar de arrays, utiliza objetos cuyos valores de propiedad son n√∫meros, los pesos de las aristas.</p>

<p><a class="p_ident" id="p-yhx4gxUsUs" href="#p-yhx4gxUsUs" tabindex="-1" role="presentation"></a>Por lo tanto, si quisi√©ramos usar ese paquete, deber√≠amos asegurarnos de que nuestro grafo est√© almacenado en el formato que espera. Todas las aristas tienen el mismo peso, ya que nuestro modelo simplificado trata cada camino como teniendo el mismo coste (una vuelta).</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-qllW3k2edE" href="#c-qllW3k2edE" tabindex="-1" role="presentation"></a><span class="tok-keyword">const</span> {find_path} = require(<span class="tok-string">&quot;dijkstrajs&quot;</span>);

<span class="tok-keyword">let</span> <span class="tok-definition">graph</span> = {};
<span class="tok-keyword">for</span> (<span class="tok-keyword">let</span> <span class="tok-definition">node</span> <span class="tok-keyword">of</span> Object.keys(roadGraph)) {
  <span class="tok-keyword">let</span> <span class="tok-definition">edges</span> = graph[node] = {};
  <span class="tok-keyword">for</span> (<span class="tok-keyword">let</span> <span class="tok-definition">dest</span> <span class="tok-keyword">of</span> roadGraph[node]) {
    edges[dest] = <span class="tok-number">1</span>;
  }
}

console.log(find_path(graph, <span class="tok-string">&quot;Oficina de Correos&quot;</span>, <span class="tok-string">&quot;Caba√±a&quot;</span>));
<span class="tok-comment">// ‚Üí [&quot;Oficina de Correos&quot;, &quot;Casa de Alicia&quot;, &quot;Caba√±a&quot;]</span></pre>

<p><a class="p_ident" id="p-mvorll6y2z" href="#p-mvorll6y2z" tabindex="-1" role="presentation"></a>Esto puede ser una barrera para la composici√≥n: cuando varios paquetes est√°n utilizando diferentes estructuras de datos para describir cosas similares, combinarlos es dif√≠cil. Por lo tanto, si deseas dise√±ar para la composabilidad, averigua qu√© estructuras de datos est√°n utilizando otras personas y, cuando sea posible, sigue su ejemplo.</p>

<p><a class="p_ident" id="p-eCjSAo88Cd" href="#p-eCjSAo88Cd" tabindex="-1" role="presentation"></a>Dise√±ar una estructura de m√≥dulo adecuada para un programa puede ser dif√≠cil. En la fase en la que a√∫n est√°s explorando el problema, probando diferentes cosas para ver qu√© funciona, es posible que no quieras preocuparte demasiado por esto, ya que mantener todo organizado puede ser una gran distracci√≥n. Una vez que tengas algo que se sienta s√≥lido, es un buen momento para dar un paso atr√°s y organizarlo.</p>

<h2><a class="h_ident" id="h-NUFOUyK+lw" href="#h-NUFOUyK+lw" tabindex="-1" role="presentation"></a>Resumen</h2>

<p><a class="p_ident" id="p-XvXDONU/Vc" href="#p-XvXDONU/Vc" tabindex="-1" role="presentation"></a>Los m√≥dulos proporcionan estructura a programas m√°s grandes al separar el c√≥digo en piezas con interfaces claras y dependencias. La interfaz es la parte del m√≥dulo que es visible para otros m√≥dulos, y las dependencias son los otros m√≥dulos que se utilizan.</p>

<p><a class="p_ident" id="p-6+U0N4+Lmm" href="#p-6+U0N4+Lmm" tabindex="-1" role="presentation"></a>Dado que JavaScript hist√≥ricamente no proporcionaba un sistema de m√≥dulos, se construy√≥ el sistema CommonJS sobre √©l. Luego, en alg√∫n momento <em>obtuvo</em> un sistema incorporado, que ahora coexiste inc√≥modamente con el sistema CommonJS.</p>

<p><a class="p_ident" id="p-V//HjvGu1k" href="#p-V//HjvGu1k" tabindex="-1" role="presentation"></a>Un paquete es un fragmento de c√≥digo que se puede distribuir por s√≠ solo. NPM es un repositorio de paquetes de JavaScript. Puedes descargar todo tipo de paquetes √∫tiles (y in√∫tiles) desde aqu√≠.</p>

<h2><a class="h_ident" id="h-tkm7ntLto1" href="#h-tkm7ntLto1" tabindex="-1" role="presentation"></a>Ejercicios</h2>

<h3><a class="i_ident" id="i-C94iKMHHsz" href="#i-C94iKMHHsz" tabindex="-1" role="presentation"></a>Un robot modular</h3>

<p id="modular_robot"><a class="p_ident" id="p-KYRgkkdGWG" href="#p-KYRgkkdGWG" tabindex="-1" role="presentation"></a>Estos son los enlaces que crea el proyecto del <a href="07_robot.html">Cap√≠tulo 7</a>:</p>

<pre class="snippet" data-language="null" ><a class="c_ident" id="c-/nxTd1W0Sy" href="#c-/nxTd1W0Sy" tabindex="-1" role="presentation"></a>roads
buildGraph
roadGraph
VillageState
runRobot
randomPick
randomRobot
mailRoute
routeRobot
findRoute
goalOrientedRobot</pre>

<p><a class="p_ident" id="p-u0kzDYTb3k" href="#p-u0kzDYTb3k" tabindex="-1" role="presentation"></a>Si tuvieras que escribir ese proyecto como un programa modular, ¬øqu√© m√≥dulos crear√≠as? ¬øQu√© m√≥dulo depender√≠a de qu√© otro m√≥dulo y c√≥mo ser√≠an sus interfaces?</p>

<p><a class="p_ident" id="p-uQ57ddB3lJ" href="#p-uQ57ddB3lJ" tabindex="-1" role="presentation"></a>¬øQu√© piezas es probable que est√©n disponibles preescritas en NPM? ¬øPreferir√≠as usar un paquete de NPM o escribirlos t√∫ mismo?</p>

<details class="solution"><summary>Mostrar pistas...</summary><div class="solution-text">

<p><a class="p_ident" id="p-2jVU/smvtt" href="#p-2jVU/smvtt" tabindex="-1" role="presentation"></a>Esto es lo que habr√≠a hecho (pero de nuevo, no hay una √∫nica forma <em>correcta</em> de dise√±ar un m√≥dulo dado):</p>

<p><a class="p_ident" id="p-UjzpfJAtXv" href="#p-UjzpfJAtXv" tabindex="-1" role="presentation"></a>El c√≥digo utilizado para construir el gr√°fico de carreteras se encuentra en el m√≥dulo <code>graph</code>. Como preferir√≠a usar <code>dijkstrajs</code> de NPM en lugar de nuestro propio c√≥digo de b√∫squeda de caminos, haremos que este construya el tipo de datos de gr√°fico que espera <code>dijkstrajs</code>. Este m√≥dulo exporta una √∫nica funci√≥n, <code>buildGraph</code>. Har√≠a que <code>buildGraph</code> aceptara un arreglo de arreglos de dos elementos, en lugar de cuerdas que contienen guiones, para hacer que el m√≥dulo dependa menos del formato de entrada.</p>

<p><a class="p_ident" id="p-zidvnGHVmE" href="#p-zidvnGHVmE" tabindex="-1" role="presentation"></a>El m√≥dulo <code>roads</code> contiene los datos crudos de las carreteras (el arreglo <code>roads</code>) y el enlace <code>roadGraph</code>. Este m√≥dulo depende de <code>./graph.js</code> y exporta el grafo de carreteras.</p>

<p><a class="p_ident" id="p-T1TF77/3do" href="#p-T1TF77/3do" tabindex="-1" role="presentation"></a>La clase <code>VillageState</code> se encuentra en el m√≥dulo <code>state</code>. Depende del m√≥dulo <code>./roads</code> porque necesita poder verificar que una carretera dada exista. Tambi√©n necesita <code>randomPick</code>. Dado que es una funci√≥n de tres l√≠neas, podr√≠amos simplemente ponerla en el m√≥dulo <code>state</code> como una funci√≥n auxiliar interna. Pero <code>randomRobot</code> tambi√©n la necesita. Entonces tendr√≠amos que duplicarla o ponerla en su propio m√≥dulo. Dado que esta funci√≥n existe en NPM en el paquete <code>random-item</code>, una soluci√≥n razonable es hacer que ambos m√≥dulos dependan de eso. Tambi√©n podemos agregar la funci√≥n <code>runRobot</code> a este m√≥dulo, ya que es peque√±a y est√° relacionada con la gesti√≥n del estado. El m√≥dulo exporta tanto la clase <code>VillageState</code> como la funci√≥n <code>runRobot</code>.</p>

<p><a class="p_ident" id="p-iXSO7deUX8" href="#p-iXSO7deUX8" tabindex="-1" role="presentation"></a>Finalmente, los robots, junto con los valores en los que dependen, como <code>mailRoute</code>, podr√≠an ir en un m√≥dulo <code>example-robots</code>, que depende de <code>./roads</code> y exporta las funciones del robot. Para que <code>goalOrientedRobot</code> pueda realizar la b√∫squeda de rutas, este m√≥dulo tambi√©n depende de <code>dijkstrajs</code>.Al externalizar cierto trabajo a m√≥dulos NPM, el c√≥digo se volvi√≥ un poco m√°s peque√±o. Cada m√≥dulo individual hace algo bastante simple y se puede leer por s√≠ solo. Dividir el c√≥digo en m√≥dulos a menudo sugiere mejoras adicionales en el dise√±o del programa. En este caso, parece un poco extra√±o que el <code>VillageState</code> y los robots dependan de un gr√°fico de caminos espec√≠fico. Podr√≠a ser una mejor idea hacer que el gr√°fico sea un argumento del constructor de estado y hacer que los robots lo lean desde el objeto de estado, esto reduce las dependencias (lo cual siempre es bueno) y hace posible ejecutar simulaciones en mapas diferentes (lo cual es aun mejor).</p>

<p><a class="p_ident" id="p-5qAcyeu8nT" href="#p-5qAcyeu8nT" tabindex="-1" role="presentation"></a>¬øEs una buena idea utilizar m√≥dulos de NPM para cosas que podr√≠amos haber escrito nosotros mismos? En principio, s√≠, para cosas no triviales como la funci√≥n de b√∫squeda de caminos es probable que cometas errores y pierdas tiempo escribi√©ndolas t√∫ mismo. Para funciones peque√±as como <code>random-item</code>, escribirlas por ti mismo es bastante f√°cil. Pero a√±adirlas donde las necesitas tiende a saturar tus m√≥dulos.</p>

<p><a class="p_ident" id="p-hBKwtogikk" href="#p-hBKwtogikk" tabindex="-1" role="presentation"></a>Sin embargo, tampoco debes subestimar el trabajo involucrado en <em>encontrar</em> un paquete de NPM apropiado. Y aunque encuentres uno, podr√≠a no funcionar bien o le podr√≠an faltar alguna caracter√≠stica que necesitas. Adem√°s, depender de paquetes de NPM significa que debes asegurarte de que est√©n instalados, debes distribuirlos con tu programa y es posible que debas actualizarlos peri√≥dicamente.</p>

<p><a class="p_ident" id="p-BSb1XGC70+" href="#p-BSb1XGC70+" tabindex="-1" role="presentation"></a>As√≠ que de nuevo, esto es un compromiso, y puedes decidir de cualquier manera dependiendo de cu√°nto te ayude realmente un paquete dado.</p>

</div></details>

<h3><a class="i_ident" id="i-OksNSVKWEy" href="#i-OksNSVKWEy" tabindex="-1" role="presentation"></a>M√≥dulo de caminos</h3>

<p><a class="p_ident" id="p-To5WmsUN/B" href="#p-To5WmsUN/B" tabindex="-1" role="presentation"></a>Escribe un m√≥dulo ES, basado en el ejemplo del <a href="07_robot.html">Cap√≠tulo 7</a>, que contenga el array de caminos y exporte la estructura de datos de gr√°fico que los representa como <code>roadGraph</code>. Deber√≠a depender de un m√≥dulo <code>./graph.js</code>, que exporta una funci√≥n <code>buildGraph</code> que se utiliza para construir el gr√°fico. Esta funci√≥n espera un array de arrays de dos elementos (los puntos de inicio y fin de los caminos).</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-aUNoo52xRY" href="#c-aUNoo52xRY" tabindex="-1" role="presentation"></a><span class="tok-comment">// A√±ade dependencias y exportaciones</span>

<span class="tok-keyword">const</span> <span class="tok-definition">roads</span> = [
  <span class="tok-string">&quot;Casa de Alicia-Casa de Bob&quot;</span>,
  <span class="tok-string">&quot;Casa de Alicia-Caba√±a&quot;</span>,
  <span class="tok-string">&quot;Casa de Alicia-Oficina de Correos&quot;</span>,
  <span class="tok-string">&quot;Casa de Bob-Ayuntamiento&quot;</span>,
  <span class="tok-string">&quot;Casa de Dar√≠a-Casa de Ernie&quot;</span>,
  <span class="tok-string">&quot;Casa de Dar√≠a-Ayuntamiento&quot;</span>,
  <span class="tok-string">&quot;Casa de Ernie-Casa de Grete&quot;</span>,
  <span class="tok-string">&quot;Casa de Grete-Granja&quot;</span>,
  <span class="tok-string">&quot;Casa de Grete-Tienda&quot;</span>,
  <span class="tok-string">&quot;Plaza de Mercado-Granja&quot;</span>,
  <span class="tok-string">&quot;Plaza de Mercado-Oficina de Correos&quot;</span>,
  <span class="tok-string">&quot;Plaza de Mercado-Tienda&quot;</span>,
  <span class="tok-string">&quot;Plaza de Mercado-Ayuntamiento&quot;</span>,
  <span class="tok-string">&quot;Tienda-Ayuntamiento&quot;</span>
];</pre>

<details class="solution"><summary>Mostrar pistas...</summary><div class="solution-text">

<p><a class="p_ident" id="p-L9cRUPvKkw" href="#p-L9cRUPvKkw" tabindex="-1" role="presentation"></a>Dado que este es un m√≥dulo ES, debes usar <code>import</code> para acceder al m√≥dulo de gr√°fico. Esto se describi√≥ como exportando una funci√≥n de <code>buildGraph</code>, la cual puedes seleccionar de su objeto de interfaz con una declaraci√≥n de desestructuraci√≥n <code>const</code>.</p>

<p><a class="p_ident" id="p-XPWdEl/Mff" href="#p-XPWdEl/Mff" tabindex="-1" role="presentation"></a>Para exportar <code>roadGraph</code>, colocas la palabra clave <code>export</code> antes de su definici√≥n. Debido a que <code>buildGraph</code> toma una estructura de datos que no coincide exactamente con <code>roads</code>, la divisi√≥n de las cadenas de carretera debe ocurrir en tu m√≥dulo.</p>

</div></details>

<h3><a class="i_ident" id="i-bsfTSuURFj" href="#i-bsfTSuURFj" tabindex="-1" role="presentation"></a>Dependencias circulares</h3>

<p><a class="p_ident" id="p-Sg51oJaKc/" href="#p-Sg51oJaKc/" tabindex="-1" role="presentation"></a>Una dependencia circular es una situaci√≥n en la que el m√≥dulo A depende de B, y B tambi√©n, directa o indirectamente, depende de A. Muchos sistemas de m√≥dulos simplemente proh√≠ben esto porque, sin importar el orden que elijas para cargar dichos m√≥dulos, no puedes asegurarte de que las dependencias de cada m√≥dulo se hayan cargado antes de que se ejecute.</p>

<p><a class="p_ident" id="p-oNX5VkmBpW" href="#p-oNX5VkmBpW" tabindex="-1" role="presentation"></a>Los m√≥dulos CommonJS permiten una forma limitada de dependencias c√≠clicas. Siempre y cuando los m√≥dulos no accedan a la interfaz de cada uno hasta despu√©s de que terminen de cargarse, las dependencias c√≠clicas est√°n bien.</p>

<p><a class="p_ident" id="p-pEgnu0OIuf" href="#p-pEgnu0OIuf" tabindex="-1" role="presentation"></a>La funci√≥n <code>require</code> proporcionada <a href="10_modules.html#require">anteriormente en este cap√≠tulo</a> admite este tipo de ciclo de dependencia. ¬øPuedes ver c√≥mo maneja los ciclos?</p>

<details class="solution"><summary>Mostrar pistas...</summary><div class="solution-text">

<p><a class="p_ident" id="p-oUZrcVxvQi" href="#p-oUZrcVxvQi" tabindex="-1" role="presentation"></a>El truco es que <code>require</code> a√±ade el objeto de interfaz de un m√≥dulo a su cach√© <em>antes</em> de comenzar a cargar el m√≥dulo. De esta manera, si se hace alguna llamada a <code>require</code> mientras se est√° ejecutando tratando de cargarlo, ya se conoce, y se devolver√° la interfaz actual, en lugar de comenzar a cargar el m√≥dulo nuevamente (lo que eventualmente desbordar√≠a la pila).</p>

</div></details><nav><a href="09_regexp.html" title="previous chapter" aria-label="previous chapter">‚óÇ</a>¬†<a href="index.html" title="cover" aria-label="cover">‚óè</a>¬†<a href="11_async.html" title="next chapter" aria-label="next chapter">‚ñ∏</a>&nbsp;<button class=help title="help" aria-label="help"><strong>?</strong></button>&nbsp;<button class="dark-mode-toggle">üåô</button>
</nav>
</article>

<script src="ejs.js"></script>
