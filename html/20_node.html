<!doctype html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Node.js :: Eloquent JavaScript</title>
  <link rel=stylesheet href="css/ejs.css"><script>
      var page = {"type":"chapter","number":20}</script></head>

<article>
<nav><a href="19_paint.html" title="previous chapter" aria-label="previous chapter">‚óÇ</a>¬†<a href="index.html" title="cover" aria-label="cover">‚óè</a>¬†<a href="21_skillsharing.html" title="next chapter" aria-label="next chapter">‚ñ∏</a>&nbsp;<button class=help title="help" aria-label="help"><strong>?</strong></button>&nbsp;<button class="dark-mode-toggle">üåô</button>
</nav>

<h1>Node.js</h1>

<blockquote>

<p><a class="p_ident" id="p-i9iqRkQ4RC" href="#p-i9iqRkQ4RC" tabindex="-1" role="presentation"></a>Un estudiante pregunt√≥: ‚ÄúLos programadores de anta√±o solo usaban m√°quinas simples y ning√∫n lenguaje de programaci√≥n, sin embargo, creaban programas hermosos. ¬øPor qu√© nosotros usamos m√°quinas complicadas y lenguajes de programaci√≥n?‚Äù. Fu-Tzu respondi√≥: ‚ÄúLos constructores de anta√±o solo usaban palos y arcilla, sin embargo, creaban hermosas chozas.‚Äù</p>

<footer>Maestro Yuan-Ma, <cite>El Libro de la Programaci√≥n</cite></footer>

</blockquote><figure class="chapter framed"><img src="img/chapter_picture_20.jpg" alt="Ilustraci√≥n que muestra un poste telef√≥nico con un enredo de cables en todas direcciones"></figure>

<p><a class="p_ident" id="p-ZVNZPnz/ZC" href="#p-ZVNZPnz/ZC" tabindex="-1" role="presentation"></a>Hasta ahora, hemos utilizado el lenguaje JavaScript en un solo entorno: el navegador. Este cap√≠tulo y el <a href="21_skillsharing.html">siguiente</a> introducir√°n brevemente Node.js, un programa que te permite aplicar tus habilidades con JavaScript fuera del navegador. Con √©l, puedes construir desde peque√±as herramientas de l√≠nea de comandos hasta servidores HTTP server que alimentan sitios web din√°micos.</p>

<p><a class="p_ident" id="p-tavS0sF06x" href="#p-tavS0sF06x" tabindex="-1" role="presentation"></a>Estos cap√≠tulos tienen como objetivo ense√±arte los conceptos principales que Node.js utiliza y darte informaci√≥n suficiente para escribir programas √∫tiles para √©l. No intentan ser un tratamiento completo, ni siquiera exhaustivo, de la plataforma.</p>

<p><a class="p_ident" id="p-1Lcjrmg2uD" href="#p-1Lcjrmg2uD" tabindex="-1" role="presentation"></a>Mientras que podr√≠as ejecutar el c√≥digo en los cap√≠tulos anteriores directamente en estas p√°ginas, ya sea JavaScript puro o escrito para el navegador, los ejemplos de c√≥digo en este cap√≠tulo est√°n escritos para Node y a menudo no se ejecutar√°n en el navegador.</p>

<p><a class="p_ident" id="p-u232WdUbYW" href="#p-u232WdUbYW" tabindex="-1" role="presentation"></a>Si deseas seguir y ejecutar el c√≥digo en este cap√≠tulo, necesitar√°s instalar Node.js versi√≥n 18 o superior. Para hacerlo, ve a <a href="https://nodejs.org"><em>https://nodejs.org</em></a> y sigue las instrucciones de instalaci√≥n para tu sistema operativo. Tambi√©n puedes encontrar m√°s documentaci√≥n para Node.js all√≠.</p>

<h2><a class="h_ident" id="h-bv9WrnaS3g" href="#h-bv9WrnaS3g" tabindex="-1" role="presentation"></a>Antecedentes</h2>

<p><a class="p_ident" id="p-b5C83jVV2T" href="#p-b5C83jVV2T" tabindex="-1" role="presentation"></a>Cuando se construyen sistemas que se comunican a trav√©s de la red, la forma en que gestionas la entrada y el output‚Äîes decir, la lectura y escritura de datos desde y hacia la red y el disco duro‚Äîpuede marcar una gran diferencia en cu√°n r√°pido responde un sistema al usuario o a las solicitudes de red.</p>

<p><a class="p_ident" id="p-EQnhnuy5FO" href="#p-EQnhnuy5FO" tabindex="-1" role="presentation"></a>En tales programas, la programaci√≥n asincr√≥nica a menudo es √∫til. Permite que el programa env√≠e y reciba datos desde y hacia m√∫ltiples dispositivos al mismo tiempo sin una complicada gesti√≥n de hilos y sincronizaci√≥n.</p>

<p><a class="p_ident" id="p-n1y5oRkilU" href="#p-n1y5oRkilU" tabindex="-1" role="presentation"></a>Node fue concebido inicialmente con el prop√≥sito de hacer que la programaci√≥n asincr√≥nica sea f√°cil y conveniente. JavaScript se presta bien a un sistema como Node. Es uno de los pocos lenguajes de programaci√≥n que no tiene una forma incorporada de manejar la entrada y salida. Por lo tanto, JavaScript podr√≠a adaptarse al enfoque algo exc√©ntrico de Node para la programaci√≥n de red y sistemas de archivos sin terminar con dos interfaces inconsistentes. En 2009, cuando se dise√±aba Node, la gente ya estaba realizando programaci√≥n basada en callbacks en el navegador, por lo que la comunidad alrededor del lenguaje estaba acostumbrada a un estilo de programaci√≥n asincr√≥nica.</p>

<h2><a class="h_ident" id="h-qzhakKB9xU" href="#h-qzhakKB9xU" tabindex="-1" role="presentation"></a>El comando node</h2>

<p><a class="p_ident" id="p-qa9aNXTUus" href="#p-qa9aNXTUus" tabindex="-1" role="presentation"></a>Cuando Node.js est√° instalado en un sistema, proporciona un programa llamado <code>node</code>, que se utiliza para ejecutar archivos de JavaScript. Supongamos que tienes un archivo <code>hello.js</code>, que contiene este c√≥digo:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-mGmtX8ZFbB" href="#c-mGmtX8ZFbB" tabindex="-1" role="presentation"></a><span class="tok-keyword">let</span> <span class="tok-definition">message</span> = <span class="tok-string">&quot;Hola mundo&quot;</span>;
console.log(message);</pre>

<p><a class="p_ident" id="p-/uXlGGpFk+" href="#p-/uXlGGpFk+" tabindex="-1" role="presentation"></a>Luego puedes ejecutar <code>node</code> desde la l√≠nea de comandos de la siguiente manera para ejecutar el programa:</p>

<pre class="snippet" data-language="null" ><a class="c_ident" id="c-KwqkOzuFaq" href="#c-KwqkOzuFaq" tabindex="-1" role="presentation"></a>$ node hello.js
Hola mundo</pre>

<p><a class="p_ident" id="p-9eFTrEoqAN" href="#p-9eFTrEoqAN" tabindex="-1" role="presentation"></a>El m√©todo <code>console.log</code> en Node hace algo similar a lo que hace en el navegador. Imprime un texto. Pero en Node, el texto ir√° al flujo de salida est√°ndar del proceso, en lugar de ir a la consola de JavaScript de un navegador. Al ejecutar <code>node</code> desde la l√≠nea de comandos, significa que ver√°s los valores registrados en tu terminal.</p>

<p><a class="p_ident" id="p-s+WcE2oW8u" href="#p-s+WcE2oW8u" tabindex="-1" role="presentation"></a>Si ejecutas <code>node</code> sin proporcionarle un archivo, te proporcionar√° un indicador en el que puedes escribir c√≥digo JavaScript y ver inmediatamente el resultado.</p>

<pre class="snippet" data-language="null" ><a class="c_ident" id="c-d/9k6S5oD+" href="#c-d/9k6S5oD+" tabindex="-1" role="presentation"></a>$ node
&gt; 1 + 1
2
&gt; [-1, -2, -3].map(Math.abs)
[1, 2, 3]
&gt; process.exit(0)
$</pre>

<p><a class="p_ident" id="p-sUYZK1EnQP" href="#p-sUYZK1EnQP" tabindex="-1" role="presentation"></a>El enlace <code>process</code>, al igual que el enlace <code>console</code>, est√° disponible globalmente en Node. Proporciona varias formas de inspeccionar y manipular el programa actual. El m√©todo <code>exit</code> finaliza el proceso y puede recibir un c√≥digo de estado de salida, que le indica al programa que inici√≥ <code>node</code> (en este caso, la shell de l√≠nea de comandos) si el programa se complet√≥ correctamente (c√≥digo cero) o si se encontr√≥ un error (cualquier otro c√≥digo).</p>

<p><a class="p_ident" id="p-W7/OzhvC4c" href="#p-W7/OzhvC4c" tabindex="-1" role="presentation"></a>Para encontrar los argumentos de l√≠nea de comandos dados a tu script, puedes leer <code>process.argv</code>, que es un array de cadenas. Ten en cuenta que tambi√©n incluye el nombre del comando <code>node</code> y el nombre de tu script, por lo que los argumentos reales comienzan en el √≠ndice 2. Si <code>showargv.js</code> contiene la instrucci√≥n <code>console.<wbr>log(process.<wbr>argv)</code>, podr√≠as ejecutarlo de la siguiente manera:</p>

<pre class="snippet" data-language="null" ><a class="c_ident" id="c-WCisDZr57g" href="#c-WCisDZr57g" tabindex="-1" role="presentation"></a>$ node showargv.js one --and two
[&quot;node&quot;, &quot;/tmp/showargv.js&quot;, &quot;one&quot;, &quot;--and&quot;, &quot;two&quot;]</pre>

<p><a class="p_ident" id="p-9BkJzZ0n1q" href="#p-9BkJzZ0n1q" tabindex="-1" role="presentation"></a>Todos los enlaces globales de JavaScript est√°ndar, como <code>Array</code>, <code>Math</code> y <code>JSON</code>, tambi√©n est√°n presentes en el entorno de Node. La funcionalidad relacionada con el navegador, como <code>document</code> o <code>prompt</code>, no lo est√°.</p>

<h2><a class="h_ident" id="h-45kWH4U4Bd" href="#h-45kWH4U4Bd" tabindex="-1" role="presentation"></a>M√≥dulos</h2>

<p><a class="p_ident" id="p-EJ7yQIM8FP" href="#p-EJ7yQIM8FP" tabindex="-1" role="presentation"></a>Adem√°s de los enlaces que mencion√©, como <code>console</code> y <code>process</code>, Node agrega pocos enlaces adicionales en el √°mbito global. Si deseas acceder a funcionalidades integradas, debes solicitarlas al sistema de m√≥dulos.</p>

<p><a class="p_ident" id="p-f49RycnPOb" href="#p-f49RycnPOb" tabindex="-1" role="presentation"></a>Node comenz√≥ utilizando el sistema de m√≥dulos CommonJS, basado en la funci√≥n <code>require</code>, que vimos en el <a href="10_modules.html#commonjs">Cap√≠tulo 10</a>. A√∫n utilizar√° este sistema de forma predeterminada cuando cargues un archivo <code>.js</code>.</p>

<p><a class="p_ident" id="p-JOqjzoG84a" href="#p-JOqjzoG84a" tabindex="-1" role="presentation"></a>Pero tambi√©n soporta el sistema de m√≥dulos ES m√°s moderno. Cuando el nombre de un script termina en <code>.mjs</code>, se considera que es un m√≥dulo de este tipo, y puedes usar <code>import</code> y <code>export</code> en √©l (pero no <code>require</code>). Utilizaremos m√≥dulos ES en este cap√≠tulo.</p>

<p><a class="p_ident" id="p-cp71LSk3dO" href="#p-cp71LSk3dO" tabindex="-1" role="presentation"></a>Cuando se importa un m√≥dulo, ya sea con <code>require</code> o <code>import</code>, Node debe resolver la cadena proporcionada a un archivo real que pueda cargar. Los nombres que comienzan con <code>/</code>, <code>./</code> o <code>../</code> se resuelven como archivos, relativos a la ruta del m√≥dulo actual. Aqu√≠, <code>.</code> representa el directorio actual, <code>../</code> para un directorio arriba, y <code>/</code> para la ra√≠z del sistema de archivos. Por lo tanto, si solicitas <code>&quot;./<wbr>graph.<wbr>mjs&quot;</code> desde el archivo <code>/<wbr>tmp/<wbr>robot/<wbr>robot.<wbr>mjs</code>, Node intentar√° cargar el archivo <code>/<wbr>tmp/<wbr>robot/<wbr>graph.<wbr>mjs</code>.</p>

<p><a class="p_ident" id="p-+iwf8vlfx1" href="#p-+iwf8vlfx1" tabindex="-1" role="presentation"></a>Cuando se importa una cadena que no parece una ruta relativa o absoluta, se asume que se refiere a un m√≥dulo integrado o un m√≥dulo instalado en un directorio <code>node_modules</code>. Por ejemplo, importar desde <code>&quot;node:fs&quot;</code> te dar√° el m√≥dulo integrado del sistema de archivos de Node. E importar <code>&quot;robot&quot;</code> podr√≠a intentar cargar la biblioteca encontrada en <code>node_modules/<wbr>robot/<wbr></code>. Una forma com√∫n de instalar estas bibliotecas es usando NPM, a lo cual volveremos en un momento.</p>

<p><a class="p_ident" id="p-xlrDnOEgFK" href="#p-xlrDnOEgFK" tabindex="-1" role="presentation"></a>Configuremos un proyecto peque√±o que consta de dos archivos. El primero, llamado <code>main.mjs</code>, define un script que puede ser llamado desde la l√≠nea de comandos para revertir una cadena.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-bbmWGTtySs" href="#c-bbmWGTtySs" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">reverse</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;./reverse.mjs&quot;</span>;

<span class="tok-comment">// El √≠ndice 2 contiene el primer argumento real de la l√≠nea de comandos</span>
<span class="tok-keyword">let</span> <span class="tok-definition">argument</span> = process.argv[<span class="tok-number">2</span>];

console.log(reverse(argument));</pre>

<p><a class="p_ident" id="p-XA7d0ksImw" href="#p-XA7d0ksImw" tabindex="-1" role="presentation"></a>El archivo <code>reverse.mjs</code> define una biblioteca para revertir cadenas, que puede ser utilizada tanto por esta herramienta de l√≠nea de comandos como por otros scripts que necesiten acceso directo a una funci√≥n para revertir cadenas.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-p8FJa0H1D4" href="#c-p8FJa0H1D4" tabindex="-1" role="presentation"></a><span class="tok-keyword">export</span> <span class="tok-keyword">function</span> <span class="tok-definition">reverse</span>(<span class="tok-definition">string</span>) {
  <span class="tok-keyword">return</span> Array.from(string).reverse().join(<span class="tok-string">&quot;&quot;</span>);
}</pre>

<p><a class="p_ident" id="p-HHZf0gHVDZ" href="#p-HHZf0gHVDZ" tabindex="-1" role="presentation"></a>Recuerda que <code>export</code> se utiliza para declarar que un enlace es parte de la interfaz del m√≥dulo. Eso permite que <code>main.mjs</code> importe y utilice la funci√≥n.</p>

<p><a class="p_ident" id="p-kFzP7q7ejQ" href="#p-kFzP7q7ejQ" tabindex="-1" role="presentation"></a>Ahora podemos llamar a nuestra herramienta de esta manera:</p>

<pre class="snippet" data-language="null" ><a class="c_ident" id="c-LYQo5Arp8G" href="#c-LYQo5Arp8G" tabindex="-1" role="presentation"></a>$ node main.mjs JavaScript
tpircSavaJ</pre>

<h2><a class="h_ident" id="h-MoxrdWcLlT" href="#h-MoxrdWcLlT" tabindex="-1" role="presentation"></a>Instalando con NPM</h2>

<p><a class="p_ident" id="p-EdwkPKYJjz" href="#p-EdwkPKYJjz" tabindex="-1" role="presentation"></a>NPM, que fue introducido en el <a href="10_modules.html#modules_npm">Cap√≠tulo 10</a>, es un repositorio en l√≠nea de m√≥dulos de JavaScript, muchos de los cuales est√°n escritos espec√≠ficamente para Node. Cuando instalas Node en tu computadora, tambi√©n obtienes el comando <code>npm</code>, que puedes usar para interactuar con este repositorio.</p>

<p><a class="p_ident" id="p-eiIjy/CDcA" href="#p-eiIjy/CDcA" tabindex="-1" role="presentation"></a>El uso principal de NPM es descargar paquetes. Vimos el paquete <code>ini</code> en el <a href="10_modules.html#modules_ini">Cap√≠tulo 10</a>. Podemos usar NPM para buscar e instalar ese paquete en nuestra computadora.</p>

<pre class="snippet" data-language="null" ><a class="c_ident" id="c-/RND8raC5h" href="#c-/RND8raC5h" tabindex="-1" role="presentation"></a>$ npm install ini
agregado 1 paquete en 723ms

$ node
&gt; const {parse} = require(&quot;ini&quot;);
&gt; parse(&quot;x = 1\ny = 2&quot;);
{ x: '1', y: '2' }</pre>

<p><a class="p_ident" id="p-IxsjoHG1Lb" href="#p-IxsjoHG1Lb" tabindex="-1" role="presentation"></a>Despu√©s de ejecutar <code>npm install</code>, NPM habr√° creado un directorio llamado <code>node_modules</code>. Dentro de ese directorio estar√° un directorio <code>ini</code> que contiene la biblioteca. Puedes abrirlo y ver el c√≥digo. Cuando importamos <code>&quot;ini&quot;</code>, esta biblioteca se carga, y podemos llamar a su propiedad <code>parse</code> para analizar un archivo de configuraci√≥n.Por defecto, NPM instala paquetes en el directorio actual, en lugar de en un lugar centralizado. Si est√°s acostumbrado a otros gestores de paquetes, esto puede parecer inusual, pero tiene ventajas: pone a cada aplicaci√≥n en control total de los paquetes que instala y facilita la gesti√≥n de versiones y limpieza al eliminar una aplicaci√≥n.</p>

<h3><a class="i_ident" id="i-cQf3FV14Fd" href="#i-cQf3FV14Fd" tabindex="-1" role="presentation"></a>Archivos de paquete</h3>

<p><a class="p_ident" id="p-FfYB7hx8VS" href="#p-FfYB7hx8VS" tabindex="-1" role="presentation"></a>Despu√©s de ejecutar <code>npm install</code> para instalar alg√∫n paquete, encontrar√°s no solo un directorio <code>node_modules</code>, sino tambi√©n un archivo llamado <code>package.json</code> en tu directorio actual. Se recomienda tener tal archivo para cada proyecto. Puedes crearlo manualmente o ejecutar <code>npm init</code>. Este archivo contiene informaci√≥n sobre el proyecto, como su nombre y versi√≥n, y enumera sus dependencias.</p>

<p><a class="p_ident" id="p-wjvaCZSoLl" href="#p-wjvaCZSoLl" tabindex="-1" role="presentation"></a>La simulaci√≥n del robot de <a href="07_robot.html">Cap√≠tulo 7</a>, modularizada en el ejercicio en el <a href="10_modules.html#modular_robot">Cap√≠tulo 10</a>, podr√≠a tener un archivo <code>package.json</code> como este:</p>

<pre class="snippet" data-language="json" ><a class="c_ident" id="c-w5ItHEwYvj" href="#c-w5ItHEwYvj" tabindex="-1" role="presentation"></a>{
  <span class="tok-string">&quot;author&quot;</span>: <span class="tok-string">&quot;Marijn Haverbeke&quot;</span>,
  <span class="tok-string">&quot;name&quot;</span>: <span class="tok-string">&quot;eloquent-javascript-robot&quot;</span>,
  <span class="tok-string">&quot;description&quot;</span>: <span class="tok-string">&quot;Simulaci√≥n de un robot de entrega de paquetes&quot;</span>,
  <span class="tok-string">&quot;version&quot;</span>: <span class="tok-string">&quot;1.0.0&quot;</span>,
  <span class="tok-string">&quot;main&quot;</span>: <span class="tok-string">&quot;run.mjs&quot;</span>,
  <span class="tok-string">&quot;dependencies&quot;</span>: {
    <span class="tok-string">&quot;dijkstrajs&quot;</span>: <span class="tok-string">&quot;^1.0.1&quot;</span>,
    <span class="tok-string">&quot;random-item&quot;</span>: <span class="tok-string">&quot;^1.0.0&quot;</span>
  },
  <span class="tok-string">&quot;license&quot;</span>: <span class="tok-string">&quot;ISC&quot;</span>
}</pre>

<p><a class="p_ident" id="p-a5gRcLiGid" href="#p-a5gRcLiGid" tabindex="-1" role="presentation"></a>Cuando ejecutas <code>npm install</code> sin especificar un paquete para instalar, NPM instalar√° las dependencias enumeradas en <code>package.json</code>. Cuando instalas un paquete espec√≠fico que no est√° listado como una dependencia, NPM lo a√±adir√° a <code>package.json</code>.</p>

<h3><a class="i_ident" id="i-dPYCknJANY" href="#i-dPYCknJANY" tabindex="-1" role="presentation"></a>Versiones</h3>

<p><a class="p_ident" id="p-ppapKEIy7c" href="#p-ppapKEIy7c" tabindex="-1" role="presentation"></a>Un archivo <code>package.json</code> lista tanto la versi√≥n del propio programa como las versiones de sus dependencias. Las versiones son una forma de manejar el hecho de que los paquetes evolucionan por separado, y el c√≥digo escrito para funcionar con un paquete tal como exist√≠a en un momento dado puede no funcionar con una versi√≥n posterior y modificada del paquete.</p>

<p><a class="p_ident" id="p-hXBNL5Yk0x" href="#p-hXBNL5Yk0x" tabindex="-1" role="presentation"></a>NPM exige que sus paquetes sigan un esquema llamado <em>semantic versioning</em>, que codifica informaci√≥n sobre qu√© versiones son <em>compatibles</em> (no rompen la antigua interfaz) en el n√∫mero de versi√≥n. Una versi√≥n sem√°ntica consiste en tres n√∫meros, separados por puntos, como <code>2.3.0</code>. Cada vez que se a√±ade nueva funcionalidad, el n√∫mero del medio debe incrementarse. Cada vez que se rompe la compatibilidad, de modo que el c√≥digo existente que utiliza el paquete puede que no funcione con la nueva versi√≥n, el primer n√∫mero debe incrementarse.</p>

<p><a class="p_ident" id="p-ne8+ivAT7p" href="#p-ne8+ivAT7p" tabindex="-1" role="presentation"></a>Un car√°cter de intercalaci√≥n (<code>^</code>) delante del n√∫mero de versi√≥n para una dependencia en <code>package.json</code> indica que se puede instalar cualquier versi√≥n compatible con el n√∫mero dado. Por ejemplo, <code>&quot;^2.<wbr>3.<wbr>0&quot;</code> significar√≠a que se permite cualquier versi√≥n mayor o igual a 2.3.0 y menor que 3.0.0.</p>

<p><a class="p_ident" id="p-glFarO71NK" href="#p-glFarO71NK" tabindex="-1" role="presentation"></a>El comando <code>npm</code> tambi√©n se utiliza para publicar nuevos paquetes o nuevas versiones de paquetes. Si ejecutas <code>npm publish</code> en un directorio que tiene un archivo <code>package.json</code>, se publicar√° un paquete con el nombre y versi√≥n listados en el archivo JSON en el registro. Cualquiera puede publicar paquetes en NPM, aunque solo bajo un nombre de paquete que a√∫n no est√© en uso, ya que no ser√≠a bueno que personas aleatorias pudieran actualizar paquetes existentes.Este libro no profundizar√° m√°s en los detalles del uso de NPM. Consulta <a href="https://npmjs.org"><em>https://npmjs.org</em></a> para obtener m√°s documentaci√≥n y una forma de buscar paquetes.</p>

<h2><a class="h_ident" id="h-4FFpIoHRzB" href="#h-4FFpIoHRzB" tabindex="-1" role="presentation"></a>El m√≥dulo del sistema de archivos</h2>

<p><a class="p_ident" id="p-C+k/JVrGOf" href="#p-C+k/JVrGOf" tabindex="-1" role="presentation"></a>Uno de los m√≥dulos integrados m√°s utilizados en Node es el m√≥dulo <code>node:fs</code>, que significa <em>sistema de archivos</em>. Exporta funciones para trabajar con archivos y directorios.</p>

<p><a class="p_ident" id="p-0fez9kQsMK" href="#p-0fez9kQsMK" tabindex="-1" role="presentation"></a>Por ejemplo, la funci√≥n llamada <code>readFile</code> lee un archivo y luego llama a una funci√≥n de devoluci√≥n de llamada con el contenido del archivo.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-VsqkE3ANgm" href="#c-VsqkE3ANgm" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">readFile</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:fs&quot;</span>;
readFile(<span class="tok-string">&quot;archivo.txt&quot;</span>, <span class="tok-string">&quot;utf8&quot;</span>, (<span class="tok-definition">error</span>, <span class="tok-definition">texto</span>) =&gt; {
  <span class="tok-keyword">if</span> (error) <span class="tok-keyword">throw</span> error;
  console.log(<span class="tok-string">&quot;El archivo contiene:&quot;</span>, texto);
});</pre>

<p><a class="p_ident" id="p-Tr9Tr55xIA" href="#p-Tr9Tr55xIA" tabindex="-1" role="presentation"></a>El segundo argumento de <code>readFile</code> indica la <em>codificaci√≥n de caracteres</em> utilizada para decodificar el archivo en una cadena. Existen varias formas en las que el texto puede ser codificado en datos binarios, pero la mayor√≠a de los sistemas modernos utilizan UTF-8. Entonces, a menos que tengas razones para creer que se utiliza otra codificaci√≥n, pasa <code>&quot;utf8&quot;</code> al leer un archivo de texto. Si no pasas una codificaci√≥n, Node asumir√° que est√°s interesado en los datos binarios y te dar√° un objeto <code>Buffer</code> en lugar de una cadena. Este es un objeto similar a un array que contiene n√∫meros que representan los bytes (trozos de datos de 8 bits) en los archivos.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-nnbBYaleDu" href="#c-nnbBYaleDu" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">readFile</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:fs&quot;</span>;
readFile(<span class="tok-string">&quot;archivo.txt&quot;</span>, (<span class="tok-definition">error</span>, <span class="tok-definition">buffer</span>) =&gt; {
  <span class="tok-keyword">if</span> (error) <span class="tok-keyword">throw</span> error;
  console.log(<span class="tok-string">&quot;El archivo conten√≠a&quot;</span>, buffer.length, <span class="tok-string">&quot;bytes.&quot;</span>,
              <span class="tok-string">&quot;El primer byte es:&quot;</span>, buffer[<span class="tok-number">0</span>]);
});</pre>

<p><a class="p_ident" id="p-om2+u0JXVt" href="#p-om2+u0JXVt" tabindex="-1" role="presentation"></a>Una funci√≥n similar, <code>writeFile</code>, se utiliza para escribir un archivo en el disco.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-eMus/6Pliv" href="#c-eMus/6Pliv" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">writeFile</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:fs&quot;</span>;
writeFile(<span class="tok-string">&quot;graffiti.txt&quot;</span>, <span class="tok-string">&quot;Node estuvo aqu√≠&quot;</span>, <span class="tok-definition">err</span> =&gt; {
  <span class="tok-keyword">if</span> (err) console.log(<span class="tok-string2">`Error al escribir el archivo: </span>${err}<span class="tok-string2">`</span>);
  <span class="tok-keyword">else</span> console.log(<span class="tok-string">&quot;Archivo escrito.&quot;</span>);
});</pre>

<p><a class="p_ident" id="p-gUnVPgRs1A" href="#p-gUnVPgRs1A" tabindex="-1" role="presentation"></a>Aqu√≠ no fue necesario especificar la codificaci√≥n: <code>writeFile</code> asumir√° que cuando se le da una cadena para escribir, en lugar de un objeto <code>Buffer</code>, debe escribirla como texto utilizando su codificaci√≥n de caracteres predeterminada, que es UTF-8.</p>

<p><a class="p_ident" id="p-2Dle5H5be+" href="#p-2Dle5H5be+" tabindex="-1" role="presentation"></a>El m√≥dulo <code>node:fs</code> contiene muchas otras funciones √∫tiles: <code>readdir</code> te dar√° los archivos en un directorio como un array de cadenas, <code>stat</code> recuperar√° informaci√≥n sobre un archivo, <code>rename</code> cambiar√° el nombre de un archivo, <code>unlink</code> lo eliminar√°, entre otros. Consulta la documentaci√≥n en <a href="https://nodejs.org"><em>https://nodejs.org</em></a> para obtener detalles espec√≠ficos.</p>

<p><a class="p_ident" id="p-kpvwRcuKUy" href="#p-kpvwRcuKUy" tabindex="-1" role="presentation"></a>La mayor√≠a de estas funciones toman una funci√≥n de devoluci√≥n de llamada como √∫ltimo par√°metro, a la que llaman ya sea con un error (el primer argumento) o con un resultado exitoso (el segundo). Como vimos en el <a href="11_async.html">Cap√≠tulo 11</a>, hay desventajas en este estilo de programaci√≥n, siendo la mayor que el manejo de errores se vuelve verboso y propenso a errores.</p>

<p><a class="p_ident" id="p-5PK4VupJIX" href="#p-5PK4VupJIX" tabindex="-1" role="presentation"></a>El m√≥dulo <code>node:fs/promises</code> exporta la mayor√≠a de las mismas funciones que el antiguo m√≥dulo <code>node:fs</code>, pero utiliza promesas en lugar de funciones de devoluci√≥n de llamada.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-Zh54f68FoC" href="#c-Zh54f68FoC" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">readFile</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:fs/promises&quot;</span>;
readFile(<span class="tok-string">&quot;file.txt&quot;</span>, <span class="tok-string">&quot;utf8&quot;</span>)
  .then(<span class="tok-definition">text</span> =&gt; console.log(<span class="tok-string">&quot;El archivo contiene:&quot;</span>, text));</pre>

<p><a class="p_ident" id="p-eHp/9t5Scg" href="#p-eHp/9t5Scg" tabindex="-1" role="presentation"></a>A veces no necesitas asincron√≠a y simplemente te estorba. Muchas de las funciones en <code>node:fs</code> tambi√©n tienen una variante s√≠ncrona, que tiene el mismo nombre con <code>Sync</code> agregado al final. Por ejemplo, la versi√≥n s√≠ncrona de <code>readFile</code> se llama <code>readFileSync</code>.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-F1N+amKpIz" href="#c-F1N+amKpIz" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">readFileSync</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:fs&quot;</span>;
console.log(<span class="tok-string">&quot;El archivo contiene:&quot;</span>,
            readFileSync(<span class="tok-string">&quot;file.txt&quot;</span>, <span class="tok-string">&quot;utf8&quot;</span>));</pre>

<p><a class="p_ident" id="p-UBT8FAnlTu" href="#p-UBT8FAnlTu" tabindex="-1" role="presentation"></a>Cabe destacar que mientras se realiza una operaci√≥n s√≠ncrona de este tipo, tu programa se detiene por completo. Si deber√≠a estar respondiendo al usuario o a otras m√°quinas en la red, quedarse atrapado en una acci√≥n s√≠ncrona podr√≠a producir retrasos molestos.</p>

<h2><a class="h_ident" id="h-dabppseVCT" href="#h-dabppseVCT" tabindex="-1" role="presentation"></a>El m√≥dulo HTTP</h2>

<p><a class="p_ident" id="p-af0Pfzl8K0" href="#p-af0Pfzl8K0" tabindex="-1" role="presentation"></a>Otro m√≥dulo central se llama <code>node:http</code>. Proporciona funcionalidad para ejecutar un servidor HTTP.</p>

<p><a class="p_ident" id="p-k3MuCWd5Dq" href="#p-k3MuCWd5Dq" tabindex="-1" role="presentation"></a>Esto es todo lo que se necesita para iniciar un servidor HTTP:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-RHcbBDR1N/" href="#c-RHcbBDR1N/" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">createServer</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:http&quot;</span>;
<span class="tok-keyword">let</span> <span class="tok-definition">server</span> = createServer((<span class="tok-definition">solicitud</span>, <span class="tok-definition">respuesta</span>) =&gt; {
  respuesta.writeHead(<span class="tok-number">200</span>, {<span class="tok-string">&quot;Content-Type&quot;</span>: <span class="tok-string">&quot;text/html&quot;</span>});
  respuesta.write(<span class="tok-string2">`</span>
<span class="tok-string2">    &lt;h1&gt;¬°Hola!&lt;/h1&gt;</span>
<span class="tok-string2">    &lt;p&gt;Pediste &lt;code&gt;</span>${solicitud.url}<span class="tok-string2">&lt;/code&gt;&lt;/p&gt;`</span>);
  respuesta.end();
});
server.listen(<span class="tok-number">8000</span>);
console.log(<span class="tok-string">&quot;¬°Escuchando! (puerto 8000)&quot;</span>);</pre>

<p><a class="p_ident" id="p-nrNhyBCrAg" href="#p-nrNhyBCrAg" tabindex="-1" role="presentation"></a>Si ejecutas este script en tu propia m√°quina, puedes apuntar tu navegador web a <a href="http://localhost:8000/hola"><em>http://localhost:8000/hola</em></a> para hacer una solicitud a tu servidor. Responder√° con una peque√±a p√°gina HTML.</p>

<p><a class="p_ident" id="p-INGY/PNK5X" href="#p-INGY/PNK5X" tabindex="-1" role="presentation"></a>La funci√≥n pasada como argumento a <code>createServer</code> se llama cada vez que un cliente se conecta al servidor. Los enlaces <code>solicitud</code> y <code>respuesta</code> son objetos que representan los datos de entrada y salida. El primero contiene informaci√≥n sobre la solicitud, como su propiedad <code>url</code>, que nos dice a qu√© URL se hizo la solicitud.</p>

<p><a class="p_ident" id="p-9kr8owkFll" href="#p-9kr8owkFll" tabindex="-1" role="presentation"></a>As√≠ que, cuando abres esa p√°gina en tu navegador, env√≠a una solicitud a tu propia computadora. Esto hace que la funci√≥n del servidor se ejecute y env√≠e una respuesta, que luego puedes ver en el navegador.</p>

<p><a class="p_ident" id="p-pM6WTnWBJW" href="#p-pM6WTnWBJW" tabindex="-1" role="presentation"></a>Para enviar algo al cliente, llamas a m√©todos en el objeto <code>respuesta</code>. El primero, <code>writeHead</code>, escribir√° los encabezados de respuesta (ver <a href="18_http.html#encabezados">Cap√≠tulo 18</a>). Le das el c√≥digo de estado (200 para ‚ÄúOK‚Äù en este caso) y un objeto que contiene valores de encabezado. El ejemplo establece el encabezado <code>Content-Type</code> para informar al cliente que estaremos enviando de vuelta un documento HTML.</p>

<p><a class="p_ident" id="p-8ynV8UjqtW" href="#p-8ynV8UjqtW" tabindex="-1" role="presentation"></a>A continuaci√≥n, el cuerpo real de la respuesta (el documento en s√≠) se env√≠a con <code>response.write</code>. Se permite llamar a este m√©todo varias veces si deseas enviar la respuesta pieza por pieza, por ejemplo para transmitir datos al cliente a medida que est√©n disponibles. Por √∫ltimo, <code>response.end</code> se√±ala el fin de la respuesta.</p>

<p><a class="p_ident" id="p-QpKSlbY/vo" href="#p-QpKSlbY/vo" tabindex="-1" role="presentation"></a>La llamada a <code>server.listen</code> hace que el servidor comience a esperar conexiones en el puerto 8000. Por eso debes conectarte a <em>localhost:8000</em> para comunicarte con este servidor, en lugar de simplemente a <em>localhost</em>, que usar√≠a el puerto predeterminado 80.</p>

<p><a class="p_ident" id="p-939YnPvrTt" href="#p-939YnPvrTt" tabindex="-1" role="presentation"></a>Cuando ejecutas este script, el proceso se queda esperando. Cuando un script est√° escuchando eventos ‚Äîen este caso, conexiones de red‚Äî, <code>node</code> no se cerrar√° autom√°ticamente al llegar al final del script. Para cerrarlo, presiona <span class="keyname">control</span>-C.</p>

<p><a class="p_ident" id="p-WmCudMYcSj" href="#p-WmCudMYcSj" tabindex="-1" role="presentation"></a>Un verdadero servidor web server usualmente hace m√°s cosas que el ejemplo; examina el m√©todo de la solicitud (la propiedad <code>method</code>) para ver qu√© acci√≥n est√° intentando realizar el cliente y mira el URL de la solicitud para descubrir sobre qu√© recurso se est√° realizando esta acci√≥n. Veremos un servidor m√°s avanzado <a href="20_node.html#file_server">m√°s adelante en este cap√≠tulo</a>.</p>

<p><a class="p_ident" id="p-btbFVE7L41" href="#p-btbFVE7L41" tabindex="-1" role="presentation"></a>El m√≥dulo <code>node:http</code> tambi√©n provee una funci√≥n <code>request</code>, que se puede usar para hacer solicitudes HTTP. Sin embargo, es mucho m√°s engorroso de usar que <code>fetch</code>, que vimos en el <a href="18_http.html">Cap√≠tulo 18</a>. Afortunadamente, <code>fetch</code> tambi√©n est√° disponible en Node, como un enlace global. A menos que desees hacer algo muy espec√≠fico, como procesar el documento de respuesta pieza por pieza a medida que llegan los datos a trav√©s de la red, recomiendo usar <code>fetch</code>.</p>

<h2><a class="h_ident" id="h-/tdw6BShQX" href="#h-/tdw6BShQX" tabindex="-1" role="presentation"></a>Flujos</h2>

<p><a class="p_ident" id="p-8QZY0sXowQ" href="#p-8QZY0sXowQ" tabindex="-1" role="presentation"></a>El objeto de respuesta al que el servidor HTTP podr√≠a escribir es un ejemplo de un objeto de <em>flujo de escritura</em>, que es un concepto ampliamente usado en Node. Estos objetos tienen un m√©todo <code>write</code> al que se puede pasar una cadena o un objeto <code>Buffer</code> para escribir algo en el flujo. Su m√©todo <code>end</code> cierra el flujo y opcionalmente toma un valor para escribir en el flujo antes de cerrarlo. Ambos m√©todos tambi√©n pueden recibir una devoluci√≥n de llamada como argumento adicional, que se llamar√° cuando la escritura o el cierre hayan finalizado.</p>

<p><a class="p_ident" id="p-3tXq6zb5kH" href="#p-3tXq6zb5kH" tabindex="-1" role="presentation"></a>Es posible crear un flujo de escritura que apunte a un archivo con la funci√≥n <code>createWriteStream</code> del m√≥dulo <code>node:fs</code>. Luego puedes usar el m√©todo <code>write</code> en el objeto resultante para escribir el archivo pieza por pieza, en lugar de hacerlo de una sola vez como con <code>writeFile</code>.</p>

<p><a class="p_ident" id="p-agbkP1opi0" href="#p-agbkP1opi0" tabindex="-1" role="presentation"></a>Los <em>flujos legibles</em> son un poco m√°s complejos. El argumento <code>request</code> para la devoluci√≥n de llamada del servidor HTTP es un flujo legible. Leer de un flujo se hace utilizando manejadores de eventos, en lugar de m√©todos.</p>

<p><a class="p_ident" id="p-o2U33sZhdp" href="#p-o2U33sZhdp" tabindex="-1" role="presentation"></a>Los objetos que emiten eventos en Node tienen un m√©todo llamado <code>on</code> que es similar al m√©todo <code>addEventListener</code> en el navegador. Le das un nombre de evento y luego una funci√≥n, y registrar√° esa funci√≥n para que se llame cada vez que ocurra el evento dado.</p>

<p><a class="p_ident" id="p-bu65djE2o6" href="#p-bu65djE2o6" tabindex="-1" role="presentation"></a>Los streams legibles tienen eventos <code>&quot;data&quot;</code> y <code>&quot;end&quot;</code>. El primero se dispara cada vez que llegan datos, y el segundo se llama cuando el flujo llega a su fin. Este modelo es m√°s adecuado para datos de <em>streaming</em> que pueden procesarse de inmediato, incluso cuando todo el documento a√∫n no est√° disponible. Un archivo se puede leer como un flujo legible utilizando la funci√≥n <code>createReadStream</code> de <code>node:fs</code>.</p>

<p><a class="p_ident" id="p-KSoYRgbMl2" href="#p-KSoYRgbMl2" tabindex="-1" role="presentation"></a>Este c√≥digo crea un servidor que lee los cuerpos de las solicitudes y los reenv√≠a al cliente como texto en may√∫sculas:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-dncpo30aqE" href="#c-dncpo30aqE" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">createServer</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:http&quot;</span>;
createServer((<span class="tok-definition">solicitud</span>, <span class="tok-definition">respuesta</span>) =&gt; {
  respuesta.writeHead(<span class="tok-number">200</span>, {<span class="tok-string">&quot;Content-Type&quot;</span>: <span class="tok-string">&quot;text/plain&quot;</span>});
  solicitud.on(<span class="tok-string">&quot;data&quot;</span>, <span class="tok-definition">fragmento</span> =&gt;
    respuesta.write(fragmento.toString().toUpperCase()));
  solicitud.on(<span class="tok-string">&quot;end&quot;</span>, () =&gt; respuesta.end());
}).listen(<span class="tok-number">8000</span>);</pre>

<p><a class="p_ident" id="p-uGKPxOs3On" href="#p-uGKPxOs3On" tabindex="-1" role="presentation"></a>El valor <code>chunk</code> pasado al manejador de datos ser√° un <code>Buffer</code> binario. Podemos convertir esto a una cadena decodific√°ndolo como caracteres codificados en UTF-8 con su m√©todo <code>toString</code>.</p>

<p><a class="p_ident" id="p-raOCi6Y4Ip" href="#p-raOCi6Y4Ip" tabindex="-1" role="presentation"></a>El siguiente fragmento de c√≥digo, cuando se ejecuta con el servidor de may√∫sculas activo, enviar√° una solicitud a ese servidor y escribir√° la respuesta que recibe:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-oHkRAhUdbQ" href="#c-oHkRAhUdbQ" tabindex="-1" role="presentation"></a>fetch(<span class="tok-string">&quot;http://localhost:8000/&quot;</span>, {
  <span class="tok-definition">method</span>: <span class="tok-string">&quot;POST&quot;</span>,
  <span class="tok-definition">body</span>: <span class="tok-string">&quot;Hola servidor&quot;</span>
}).then(<span class="tok-definition">resp</span> =&gt; resp.text()).then(console.log);
<span class="tok-comment">// ‚Üí HOLA SERVIDOR</span></pre>

<h2 id="file_server"><a class="h_ident" id="h-uA++Rty3OD" href="#h-uA++Rty3OD" tabindex="-1" role="presentation"></a>Un servidor de archivos</h2>

<p><a class="p_ident" id="p-jU7doWE9wG" href="#p-jU7doWE9wG" tabindex="-1" role="presentation"></a>Combina nuestro nuevo conocimiento sobre los servidores HTTP y el trabajo con el sistema de archivos para crear un puente entre ambos: un servidor HTTP que permite el acceso remoto a un sistema de archivos. Este tipo de servidor tiene todo tipo de usos, como permitir que las aplicaciones web almacenen y compartan datos, o dar acceso compartido a un grupo de personas a un mont√≥n de archivos.</p>

<p><a class="p_ident" id="p-Zhrg6JSTjX" href="#p-Zhrg6JSTjX" tabindex="-1" role="presentation"></a>Cuando tratamos los archivos como recursos de HTTP, los m√©todos HTTP <code>GET</code>, <code>PUT</code> y <code>DELETE</code> se pueden usar para leer, escribir y eliminar los archivos, respectivamente. Interpretaremos la ruta en la solicitud como la ruta del archivo al que se refiere la solicitud.</p>

<p><a class="p_ident" id="p-x6JgKfdaZz" href="#p-x6JgKfdaZz" tabindex="-1" role="presentation"></a>Probablemente no queramos compartir todo nuestro sistema de archivos, por lo que interpretaremos estas rutas como comenzando en el directorio de trabajo del servidor, que es el directorio en el que se inici√≥. Si ejecut√© el servidor desde <code>/tmp/public/</code> (o <code>C:\tmp\public\</code> en Windows), entonces una solicitud para <code>/file.txt</code> deber√≠a referirse a <code>/<wbr>tmp/<wbr>public/<wbr>file.<wbr>txt</code> (o <code>C:\tmp\public\file.<wbr>txt</code>).</p>

<p><a class="p_ident" id="p-oUNTEGADKj" href="#p-oUNTEGADKj" tabindex="-1" role="presentation"></a>Construiremos el programa paso a paso, utilizando un objeto llamado <code>methods</code> para almacenar las funciones que manejan los diferentes m√©todos HTTP. Los manejadores de m√©todos son funciones <code>async</code> que reciben el objeto de solicitud como argumento y devuelven una promesa que se resuelve a un objeto que describe la respuesta.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-t1jsLbJd7n" href="#c-t1jsLbJd7n" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">createServer</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:http&quot;</span>;

<span class="tok-keyword">const</span> <span class="tok-definition">methods</span> = Object.create(<span class="tok-keyword">null</span>);

createServer((<span class="tok-definition">request</span>, <span class="tok-definition">response</span>) =&gt; {
  <span class="tok-keyword">let</span> <span class="tok-definition">handler</span> = methods[request.method] || notAllowed;
  handler(request).catch(<span class="tok-definition">error</span> =&gt; {
    <span class="tok-keyword">if</span> (error.status != <span class="tok-keyword">null</span>) <span class="tok-keyword">return</span> error;
    <span class="tok-keyword">return</span> {<span class="tok-definition">body</span>: String(error), <span class="tok-definition">status</span>: <span class="tok-number">500</span>};
  }).then(({body, status = <span class="tok-number">200</span>, type = <span class="tok-string">&quot;text/plain&quot;</span>}) =&gt; {
    response.writeHead(status, {<span class="tok-string">&quot;Content-Type&quot;</span>: type});
    <span class="tok-keyword">if</span> (body &amp;&amp; body.pipe) body.pipe(response);
    <span class="tok-keyword">else</span> response.end(body);
  });
}).listen(<span class="tok-number">8000</span>);

<span class="tok-keyword">async</span> <span class="tok-keyword">function</span> <span class="tok-definition">notAllowed</span>(<span class="tok-definition">request</span>) {
  <span class="tok-keyword">return</span> {
    <span class="tok-definition">status</span>: <span class="tok-number">405</span>,
    <span class="tok-definition">body</span>: <span class="tok-string2">`M√©todo </span>${request.method}<span class="tok-string2"> no permitido.`</span>
  };
}</pre>

<p><a class="p_ident" id="p-+zXJyjiv+x" href="#p-+zXJyjiv+x" tabindex="-1" role="presentation"></a>Esto inicia un servidor que simplemente devuelve respuestas de error 405, que es el c√≥digo utilizado para indicar que el servidor se niega a manejar un m√©todo determinado.</p>

<p><a class="p_ident" id="p-LQFPuDuYA9" href="#p-LQFPuDuYA9" tabindex="-1" role="presentation"></a>Cuando la promesa de un manejador de solicitud es rechazada, la llamada a <code>catch</code> traduce el error en un objeto de respuesta, si a√∫n no lo es, para que el servidor pueda enviar una respuesta de error para informar al cliente que no pudo manejar la solicitud.</p>

<p><a class="p_ident" id="p-1mh3Zz7i88" href="#p-1mh3Zz7i88" tabindex="-1" role="presentation"></a>El campo <code>status</code> de la descripci√≥n de la respuesta puede omitirse, en cuyo caso se establece en 200 (OK) por defecto. El tipo de contenido, en la propiedad <code>type</code>, tambi√©n puede omitirse, en cuyo caso se asume que la respuesta es texto plano.</p>

<p><a class="p_ident" id="p-Lrm7n6XIp1" href="#p-Lrm7n6XIp1" tabindex="-1" role="presentation"></a>Cuando el valor de <code>body</code> es un readable stream, este tendr√° un m√©todo <code>pipe</code> que se utiliza para reenviar todo el contenido de un flujo de lectura a un writable stream. Si no es as√≠, se asume que es <code>null</code> (sin cuerpo), una cadena o un b√∫fer, y se pasa directamente al m√©todo <code>end</code> del response.</p>

<p><a class="p_ident" id="p-dslBfnWhvL" href="#p-dslBfnWhvL" tabindex="-1" role="presentation"></a>Para determinar qu√© ruta de archivo corresponde a una URL de solicitud, la funci√≥n <code>urlPath</code> utiliza la clase integrada <code>URL</code> (que tambi√©n existe en el navegador) para analizar la URL. Este constructor espera una URL completa, no solo la parte que comienza con la barra diagonal que obtenemos de <code>request.url</code>, por lo que le proporcionamos un nombre de dominio falso para completar. Extrae su ruta, que ser√° algo como <code>&quot;/<wbr>archivo.<wbr>txt&quot;</code>, la decodifica para eliminar los c√≥digos de escape estilo <code>%20</code>, y la resuelve en relaci√≥n con el directorio de trabajo del programa.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-qUo0ijb1sS" href="#c-qUo0ijb1sS" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">parse</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:url&quot;</span>;
<span class="tok-keyword">import</span> {<span class="tok-definition">resolve</span>, <span class="tok-definition">sep</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:path&quot;</span>;

<span class="tok-keyword">const</span> <span class="tok-definition">baseDirectory</span> = process.cwd();

<span class="tok-keyword">function</span> <span class="tok-definition">urlPath</span>(<span class="tok-definition">url</span>) {
  <span class="tok-keyword">let</span> {pathname} = <span class="tok-keyword">new</span> URL(url, <span class="tok-string">&quot;http://d&quot;</span>);
  <span class="tok-keyword">let</span> <span class="tok-definition">path</span> = resolve(decodeURIComponent(pathname).slice(<span class="tok-number">1</span>));
  <span class="tok-keyword">if</span> (path != baseDirectory &amp;&amp;
      !path.startsWith(baseDirectory + sep)) {
    <span class="tok-keyword">throw</span> {<span class="tok-definition">status</span>: <span class="tok-number">403</span>, <span class="tok-definition">body</span>: <span class="tok-string">&quot;Prohibido&quot;</span>};
  }
  <span class="tok-keyword">return</span> path;
}</pre>

<p><a class="p_ident" id="p-dFcFdVohrh" href="#p-dFcFdVohrh" tabindex="-1" role="presentation"></a>Tan pronto como configuras un programa para aceptar solicitudes de red, debes empezar a preocuparte por la seguridad. En este caso, si no tenemos cuidado, es probable que terminemos exponiendo accidentalmente todo nuestro sistema de archivos a la red.</p>

<p><a class="p_ident" id="p-xDAA5DC9ZB" href="#p-xDAA5DC9ZB" tabindex="-1" role="presentation"></a>Las rutas de archivos son cadenas en Node. Para mapear dicha cadena a un archivo real, hay una cantidad no trivial de interpretaci√≥n en juego. Las rutas pueden, por ejemplo, incluir <code>../</code> para hacer referencia a un directorio padre. As√≠ que una fuente obvia de problemas ser√≠an las solicitudes de rutas como <code>/<wbr>.<wbr>./<wbr>archivo_secreto</code>.</p>

<p><a class="p_ident" id="p-0MnFEqoNvg" href="#p-0MnFEqoNvg" tabindex="-1" role="presentation"></a>Para evitar tales problemas, <code>urlPath</code> utiliza la funci√≥n <code>resolve</code> del m√≥dulo <code>node:path</code>, que resuelve rutas relativas. Luego verifica que el resultado est√© <em>debajo</em> del directorio de trabajo. La funci√≥n <code>process.cwd</code> (donde <code>cwd</code> significa ‚Äúdirectorio de trabajo actual‚Äù) se puede usar para encontrar este directorio de trabajo. El v√≠nculo <code>sep</code> del paquete <code>node:path</code> es el separador de ruta del sistema: una barra invertida en Windows y una barra diagonal en la mayor√≠a de otros sistemas. Cuando la ruta no comienza con el directorio base, la funci√≥n arroja un objeto de respuesta de error, usando el c√≥digo de estado HTTP que indica que el acceso al recurso est√° prohibido.</p>

<p><a class="p_ident" id="p-MkXoA4493U" href="#p-MkXoA4493U" tabindex="-1" role="presentation"></a>Configuraremos el m√©todo <code>GET</code> para devolver una lista de archivos al leer un directorio y para devolver el contenido del archivo al leer un archivo regular.</p>

<p><a class="p_ident" id="p-bXBiG1wVg7" href="#p-bXBiG1wVg7" tabindex="-1" role="presentation"></a>Una pregunta complicada es qu√© tipo de encabezado <code>Content-Type</code> debemos establecer al devolver el contenido de un archivo. Dado que estos archivos podr√≠an ser cualquier cosa, nuestro servidor no puede simplemente devolver el mismo tipo de contenido para todos ellos. npm puede ayudarnos nuevamente aqu√≠. El paquete <code>mime-types</code> (los indicadores de tipo de contenido como <code>text/plain</code> tambi√©n se llaman <em>tipos MIME</em>) conoce el tipo correcto para una gran cantidad de extensiones de archivo.</p>

<p><a class="p_ident" id="p-MSwHYukw8J" href="#p-MSwHYukw8J" tabindex="-1" role="presentation"></a>El siguiente comando de <code>npm</code>, en el directorio donde reside el script del servidor, instala una versi√≥n espec√≠fica de <code>mime</code>:</p>

<pre class="snippet" data-language="null" ><a class="c_ident" id="c-EObiWUZetK" href="#c-EObiWUZetK" tabindex="-1" role="presentation"></a>$ npm install mime-types@2.1.0</pre>

<p><a class="p_ident" id="p-oX7svPGvOz" href="#p-oX7svPGvOz" tabindex="-1" role="presentation"></a>Cuando un archivo solicitado no existe, el c√≥digo de estado HTTP correcto a devolver es 404. Utilizaremos la funci√≥n <code>stat</code>, que busca informaci√≥n sobre un archivo, para averiguar tanto si el archivo existe como si es un directorio.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-HNsvbqDhZq" href="#c-HNsvbqDhZq" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">createReadStream</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:fs&quot;</span>;
<span class="tok-keyword">import</span> {<span class="tok-definition">stat</span>, <span class="tok-definition">readdir</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:fs/promises&quot;</span>;
<span class="tok-keyword">import</span> {<span class="tok-definition">lookup</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;mime-types&quot;</span>;

methods.GET = <span class="tok-keyword">async</span> <span class="tok-keyword">function</span>(<span class="tok-definition">request</span>) {
  <span class="tok-keyword">let</span> <span class="tok-definition">path</span> = urlPath(request.url);
  <span class="tok-keyword">let</span> <span class="tok-definition">stats</span>;
  <span class="tok-keyword">try</span> {
    stats = <span class="tok-keyword">await</span> stat(path);
  } <span class="tok-keyword">catch</span> (<span class="tok-definition">error</span>) {
    <span class="tok-keyword">if</span> (error.code != <span class="tok-string">&quot;ENOENT&quot;</span>) <span class="tok-keyword">throw</span> error;
    <span class="tok-keyword">else</span> <span class="tok-keyword">return</span> {<span class="tok-definition">status</span>: <span class="tok-number">404</span>, <span class="tok-definition">body</span>: <span class="tok-string">&quot;Archivo no encontrado&quot;</span>};
  }
  <span class="tok-keyword">if</span> (stats.isDirectory()) {
    <span class="tok-keyword">return</span> {<span class="tok-definition">body</span>: (<span class="tok-keyword">await</span> readdir(path)).join(<span class="tok-string">&quot;</span><span class="tok-string2">\n</span><span class="tok-string">&quot;</span>)};
  } <span class="tok-keyword">else</span> {
    <span class="tok-keyword">return</span> {<span class="tok-definition">body</span>: createReadStream(path),
            <span class="tok-definition">type</span>: lookup(path)};
  }
};</pre>

<p><a class="p_ident" id="p-b0jz/pRFJE" href="#p-b0jz/pRFJE" tabindex="-1" role="presentation"></a>Debido a que debe acceder al disco y por lo tanto podr√≠a llevar alg√∫n tiempo, <code>stat</code> es as√≠ncrono. Dado que estamos utilizando promesas en lugar del estilo de devoluci√≥n de llamada, debe ser importado desde <code>node:fs/promises</code> en lugar de directamente desde <code>node:fs</code>.</p>

<p><a class="p_ident" id="p-JZjlGZPnMe" href="#p-JZjlGZPnMe" tabindex="-1" role="presentation"></a>Cuando el archivo no existe, <code>stat</code> lanzar√° un objeto de error con una propiedad <code>code</code> de <code>&quot;ENOENT&quot;</code>. Estos c√≥digos algo oscuros, inspirados en Unix, son la forma en que se reconocen los tipos de error en Node.</p>

<p><a class="p_ident" id="p-3QdcZTE5z7" href="#p-3QdcZTE5z7" tabindex="-1" role="presentation"></a>El objeto <code>stats</code> devuelto por <code>stat</code> nos indica varias cosas sobre un archivo, como su tama√±o (propiedad <code>size</code>) y su fecha de modificaci√≥n (<code>mtime</code>). Aqu√≠ nos interesa saber si es un directorio o un archivo regular, lo cual nos dice el m√©todo <code>isDirectory</code>.</p>

<p><a class="p_ident" id="p-h0xB1EOSYW" href="#p-h0xB1EOSYW" tabindex="-1" role="presentation"></a>Usamos <code>readdir</code> para leer la matriz de archivos en un directorio y devolverla al cliente. Para archivos normales, creamos un flujo de lectura con <code>createReadStream</code> y lo devolvemos como cuerpo, junto con el tipo de contenido que nos proporciona el paquete <code>mime</code> para el nombre del archivo.</p>

<p><a class="p_ident" id="p-y4nquA3rgd" href="#p-y4nquA3rgd" tabindex="-1" role="presentation"></a>El c√≥digo para manejar las solicitudes <code>DELETE</code> es ligeramente m√°s sencillo.</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-JlCZDm9eg3" href="#c-JlCZDm9eg3" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">rmdir</span>, <span class="tok-definition">unlink</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:fs/promises&quot;</span>;

methods.DELETE = <span class="tok-keyword">async</span> <span class="tok-keyword">function</span>(<span class="tok-definition">request</span>) {
  <span class="tok-keyword">let</span> <span class="tok-definition">path</span> = urlPath(request.url);
  <span class="tok-keyword">let</span> <span class="tok-definition">stats</span>;
  <span class="tok-keyword">try</span> {
    stats = <span class="tok-keyword">await</span> stat(path);
  } <span class="tok-keyword">catch</span> (<span class="tok-definition">error</span>) {
    <span class="tok-keyword">if</span> (error.code != <span class="tok-string">&quot;ENOENT&quot;</span>) <span class="tok-keyword">throw</span> error;
    <span class="tok-keyword">else</span> <span class="tok-keyword">return</span> {<span class="tok-definition">status</span>: <span class="tok-number">204</span>};
  }
  <span class="tok-keyword">if</span> (stats.isDirectory()) <span class="tok-keyword">await</span> rmdir(path);
  <span class="tok-keyword">else</span> <span class="tok-keyword">await</span> unlink(path);
  <span class="tok-keyword">return</span> {<span class="tok-definition">status</span>: <span class="tok-number">204</span>};
};</pre>

<p><a class="p_ident" id="p-H+7ybQUwOt" href="#p-H+7ybQUwOt" tabindex="-1" role="presentation"></a>Cuando una respuesta HTTP no contiene datos, se puede usar el c√≥digo de estado 204 (‚Äúsin contenido‚Äù) para indicarlo. Dado que la respuesta a la eliminaci√≥n no necesita transmitir ninguna informaci√≥n m√°s all√° de si la operaci√≥n tuvo √©xito, es sensato devolver eso aqu√≠.</p>

<p><a class="p_ident" id="p-SU+s9xoEsL" href="#p-SU+s9xoEsL" tabindex="-1" role="presentation"></a>Es posible que te preguntes por qu√© intentar eliminar un archivo inexistente devuelve un c√≥digo de estado de √©xito en lugar de un error. Cuando el archivo que se est√° eliminando no est√° presente, se podr√≠a decir que el objetivo de la solicitud ya se ha cumplido. El est√°ndar HTTP nos anima a hacer solicitudes <em>idempotentes</em>, lo que significa que hacer la misma solicitud varias veces produce el mismo resultado que hacerla una vez. De cierta manera, si intentas eliminar algo que ya no est√°, el efecto que intentabas lograr se ha alcanzado: la cosa ya no est√° all√≠.</p>

<p><a class="p_ident" id="p-ARSP8HNYDA" href="#p-ARSP8HNYDA" tabindex="-1" role="presentation"></a>Este es el manejador para las solicitudes <code>PUT</code>:</p>

<pre tabindex="0" class="snippet" data-language="javascript" ><a class="c_ident" id="c-V+n6chgMKs" href="#c-V+n6chgMKs" tabindex="-1" role="presentation"></a><span class="tok-keyword">import</span> {<span class="tok-definition">createWriteStream</span>} <span class="tok-keyword">from</span> <span class="tok-string">&quot;node:fs&quot;</span>;

<span class="tok-keyword">function</span> <span class="tok-definition">pipeStream</span>(<span class="tok-definition">from</span>, <span class="tok-definition">to</span>) {
  <span class="tok-keyword">return</span> <span class="tok-keyword">new</span> Promise((<span class="tok-definition">resolve</span>, <span class="tok-definition">reject</span>) =&gt; {
    from.on(<span class="tok-string">&quot;error&quot;</span>, reject);
    to.on(<span class="tok-string">&quot;error&quot;</span>, reject);
    to.on(<span class="tok-string">&quot;finish&quot;</span>, resolve);
    from.pipe(to);
  });
}<span class="tok-string2">``</span><span class="tok-string2">`methods.PUT = async function(request) {</span>
<span class="tok-string2">  let path = urlPath(request.url);</span>
<span class="tok-string2">  await pipeStream(request, createWriteStream(path));</span>
<span class="tok-string2">  return {status: 204};</span>
<span class="tok-string2">};</span></pre>

<p><a class="p_ident" id="p-rQWta+cFGd" href="#p-rQWta+cFGd" tabindex="-1" role="presentation"></a>Esta vez no necesitamos verificar si el archivo existe; si lo hace, simplemente lo sobrescribiremos. Nuevamente usamos <code>pipe</code> para mover datos de un flujo legible a uno escribible, en este caso del request al archivo. Pero como <code>pipe</code> no est√° dise√±ado para devolver una promesa, debemos escribir un contenedor, <code>pipeStream</code>, que cree una promesa alrededor del resultado de llamar a <code>pipe</code>.</p>

<p><a class="p_ident" id="p-JjAdEY1T6W" href="#p-JjAdEY1T6W" tabindex="-1" role="presentation"></a>Cuando algo sale mal al abrir el archivo, <code>createWriteStream</code> seguir√° devolviendo un flujo, pero ese flujo lanzar√° un evento de <code>&quot;error&quot;</code>. El flujo del request tambi√©n puede fallar, por ejemplo si la red falla. Por lo tanto, conectamos los eventos de <code>&quot;error&quot;</code> de ambos flujos para rechazar la promesa. Cuando <code>pipe</code> haya terminado, cerrar√° el flujo de salida, lo que har√° que lance un evento de <code>&quot;finalizaci√≥n&quot;</code>. En ese momento podemos resolver la promesa con √©xito (devolviendo nada).</p>

<p><a class="p_ident" id="p-8kKGPbzzF1" href="#p-8kKGPbzzF1" tabindex="-1" role="presentation"></a>El script completo del servidor est√° disponible en <a href="https://eloquentjavascript.net/code/file_server.mjs"><em>https://eloquentjavascript.net/code/file_server.mjs</em></a>. Puedes descargarlo y, despu√©s de instalar sus dependencias, ejecutarlo con Node para iniciar tu propio servidor de archivos. Y, por supuesto, puedes modificarlo y ampliarlo para resolver los ejercicios de este cap√≠tulo o para experimentar.</p>

<p><a class="p_ident" id="p-hd8NXvgo0U" href="#p-hd8NXvgo0U" tabindex="-1" role="presentation"></a>La herramienta de l√≠nea de comandos <code>curl</code>, ampliamente disponible en sistemas Unix (como macOS y Linux), se puede utilizar para hacer solicitudes HTTP. La siguiente sesi√≥n prueba brevemente nuestro servidor. La opci√≥n <code>-X</code> se usa para establecer el m√©todo de la solicitud, y <code>-d</code> se utiliza para incluir un cuerpo de solicitud.</p>

<pre class="snippet" data-language="null" ><a class="c_ident" id="c-9YZyNAzvD4" href="#c-9YZyNAzvD4" tabindex="-1" role="presentation"></a>$ curl http://localhost:8000/file.txt
Archivo no encontrado
$ curl -X PUT -d CONTENIDO http://localhost:8000/file.txt
$ curl http://localhost:8000/file.txt
CONTENIDO
$ curl -X DELETE http://localhost:8000/file.txt
$ curl http://localhost:8000/file.txt
Archivo no encontrado</pre>

<p><a class="p_ident" id="p-SdSZhaJ21+" href="#p-SdSZhaJ21+" tabindex="-1" role="presentation"></a>La primera solicitud para <code>file.txt</code> falla ya que el archivo a√∫n no existe. La solicitud <code>PUT</code> crea el archivo y, voil√†, la siguiente solicitud lo recupera con √©xito. Despu√©s de eliminarlo con una solicitud <code>DELETE</code>, el archivo vuelve a estar ausente.</p>

<h2><a class="h_ident" id="h-NUFOUyK+lw" href="#h-NUFOUyK+lw" tabindex="-1" role="presentation"></a>Resumen</h2>

<p><a class="p_ident" id="p-ZkCAhCPqn3" href="#p-ZkCAhCPqn3" tabindex="-1" role="presentation"></a>Node es un sistema peque√±o interesante que nos permite ejecutar JavaScript en un contexto no de navegador. Originalmente fue dise√±ado para tareas de red para desempe√±ar el papel de un <em>nodo</em> en una red. Sin embargo, se presta para todo tipo de tareas de script, y si disfrutas escribir JavaScript, automatizar tareas con Node funciona bien.</p>

<p><a class="p_ident" id="p-mvU/5eNAQi" href="#p-mvU/5eNAQi" tabindex="-1" role="presentation"></a>NPM proporciona paquetes para todo lo que puedas imaginar (y varias cosas que probablemente nunca se te ocurrir√≠an), y te permite descargar e instalar esos paquetes con el programa <code>npm</code>. Node viene con varios m√≥dulos integrados, incluido el m√≥dulo <code>node:fs</code> para trabajar con el sistema de archivos y el m√≥dulo <code>node:http</code> para ejecutar servidores HTTP.Todo el input y output en Node se hace de forma as√≠ncrona, a menos que uses expl√≠citamente una variante s√≠ncrona de una funci√≥n, como <code>readFileSync</code>. Originalmente, Node usaba devoluciones de llamada para funcionalidades as√≠ncronas, pero el paquete <code>node:fs/promises</code> proporciona una interfaz basada en promesas para el sistema de archivos.</p>

<h2><a class="h_ident" id="h-tkm7ntLto1" href="#h-tkm7ntLto1" tabindex="-1" role="presentation"></a>Ejercicios</h2>

<h3><a class="i_ident" id="i-F/Hf/Ag4yl" href="#i-F/Hf/Ag4yl" tabindex="-1" role="presentation"></a>Herramienta de b√∫squeda</h3>

<p><a class="p_ident" id="p-IXlWk51Q1o" href="#p-IXlWk51Q1o" tabindex="-1" role="presentation"></a>En los sistemas Unix, existe una herramienta de l√≠nea de comandos llamada <code>grep</code> que se puede utilizar para buscar r√°pidamente archivos seg√∫n una expresi√≥n regular.</p>

<p><a class="p_ident" id="p-nw3FaVfQZY" href="#p-nw3FaVfQZY" tabindex="-1" role="presentation"></a>Escribe un script de Node que se pueda ejecutar desde la l√≠nea de comandos y funcione de manera similar a <code>grep</code>. Trata el primer argumento de la l√≠nea de comandos como una expresi√≥n regular y trata cualquier argumento adicional como archivos a buscar. Deber√≠a mostrar los nombres de los archivos cuyo contenido coincide con la expresi√≥n regular.</p>

<p><a class="p_ident" id="p-pdXy9ZIXbz" href="#p-pdXy9ZIXbz" tabindex="-1" role="presentation"></a>Una vez que eso funcione, exti√©ndelo para que cuando uno de los argumentos sea un directorio, busque en todos los archivos de ese directorio y sus subdirectorios.</p>

<p><a class="p_ident" id="p-qnRKogZMPC" href="#p-qnRKogZMPC" tabindex="-1" role="presentation"></a>Utiliza funciones as√≠ncronas o s√≠ncronas del sistema de archivos seg√∫n consideres adecuado. Configurar las cosas para que se soliciten m√∫ltiples acciones as√≠ncronas al mismo tiempo podr√≠a acelerar un poco las cosas, pero no demasiado, ya que la mayor√≠a de los sistemas de archivos solo pueden leer una cosa a la vez.</p>

<details class="solution"><summary>Mostrar pistas...</summary><div class="solution-text">

<p><a class="p_ident" id="p-HJCQsGtLBH" href="#p-HJCQsGtLBH" tabindex="-1" role="presentation"></a>Tu primer argumento de l√≠nea de comandos, la expresi√≥n regular, se puede encontrar en <code>process.argv[2]</code>. Los archivos de entrada vienen despu√©s de eso. Puedes usar el constructor <code>RegExp</code> para convertir una cadena en un objeto de expresi√≥n regular.</p>

<p><a class="p_ident" id="p-xE/qoskUBZ" href="#p-xE/qoskUBZ" tabindex="-1" role="presentation"></a>Hacer esto de forma s√≠ncrona, con <code>readFileSync</code>, es m√°s sencillo, pero si usas <code>node:fs/promises</code> para obtener funciones que devuelven promesas y escribes una funci√≥n <code>async</code>, el c√≥digo se ve similar.</p>

<p><a class="p_ident" id="p-xmMSoqqpPB" href="#p-xmMSoqqpPB" tabindex="-1" role="presentation"></a>Para averiguar si algo es un directorio, nuevamente puedes usar <code>stat</code> (o <code>statSync</code>) y el m√©todo <code>isDirectory</code> del objeto de estad√≠sticas.</p>

<p><a class="p_ident" id="p-m2hsDndjdY" href="#p-m2hsDndjdY" tabindex="-1" role="presentation"></a>Explorar un directorio es un proceso ramificado. Puedes hacerlo usando una funci√≥n recursiva o manteniendo un array de tareas pendientes (archivos que a√∫n deben ser explorados). Para encontrar los archivos en un directorio, puedes llamar a <code>readdir</code> o <code>readdirSync</code>. Observa la extra√±a capitalizaci√≥n: el nombrado de funciones del sistema de archivos de Node se basa vagamente en las funciones est√°ndar de Unix, como <code>readdir</code>, que son todas en min√∫sculas, pero luego agrega <code>Sync</code> con una letra may√∫scula.</p>

<p><a class="p_ident" id="p-nak1lIuwWy" href="#p-nak1lIuwWy" tabindex="-1" role="presentation"></a>Para obtener el nombre completo de un archivo le√≠do con <code>readdir</code>, debes combinarlo con el nombre del directorio, ya sea a√±adiendo <code>sep</code> de <code>node:path</code> entre ellos, o utilizando la funci√≥n <code>join</code> de ese mismo paquete.</p>

</div></details>

<h3><a class="i_ident" id="i-o/SovGzlc3" href="#i-o/SovGzlc3" tabindex="-1" role="presentation"></a>Creaci√≥n de directorios</h3>

<p><a class="p_ident" id="p-noPcKPskXH" href="#p-noPcKPskXH" tabindex="-1" role="presentation"></a>Aunque el m√©todo <code>DELETE</code> en nuestro servidor de archivos es capaz de eliminar directorios (usando <code>rmdir</code>), actualmente el servidor no proporciona ninguna forma de <em>crear</em> un directorio.</p>

<p><a class="p_ident" id="p-t0vs3VLgD4" href="#p-t0vs3VLgD4" tabindex="-1" role="presentation"></a>A√±ade soporte para el m√©todo <code>MKCOL</code> (‚Äúmake collection‚Äù), que deber√≠a crear un directorio llamando a <code>mkdir</code> desde el m√≥dulo <code>node:fs</code>. <code>MKCOL</code> no es un m√©todo HTTP ampliamente utilizado, pero s√≠ existe con este mismo prop√≥sito en el est√°ndar <em>WebDAV</em>, el cual especifica un conjunto de convenciones sobre HTTP que lo hacen adecuado para crear documentos.</p>

<details class="solution"><summary>Mostrar pistas...</summary><div class="solution-text">

<p><a class="p_ident" id="p-AVf93pz/4b" href="#p-AVf93pz/4b" tabindex="-1" role="presentation"></a>Puedes usar la funci√≥n que implementa el m√©todo <code>DELETE</code> como base para el m√©todo <code>MKCOL</code>. Cuando no se encuentra ning√∫n archivo, intenta crear un directorio con <code>mkdir</code>. Cuando existe un directorio en esa ruta, puedes devolver una respuesta 204 para que las solicitudes de creaci√≥n de directorios sean idempotentes. Si existe un archivo que no es un directorio en esta ruta, devuelve un c√≥digo de error. El c√≥digo 400 (‚Äúsolicitud incorrecta‚Äù) ser√≠a apropiado.</p>

</div></details>

<h3><a class="i_ident" id="i-Txw3NflFh8" href="#i-Txw3NflFh8" tabindex="-1" role="presentation"></a>Un espacio p√∫blico en la web</h3>

<p><a class="p_ident" id="p-cVdLVfzQ+z" href="#p-cVdLVfzQ+z" tabindex="-1" role="presentation"></a>Dado que el servidor de archivos sirve cualquier tipo de archivo e incluso incluye la cabecera <code>Content-Type</code> correcta, puedes usarlo para servir un sitio web. Dado que permite a todos eliminar y reemplazar archivos, ser√≠a un tipo interesante de sitio web: uno que puede ser modificado, mejorado y vandalizado por todos aquellos que se tomen el tiempo de hacer la solicitud HTTP adecuada.</p>

<p><a class="p_ident" id="p-w5d/xudUZ/" href="#p-w5d/xudUZ/" tabindex="-1" role="presentation"></a>Escribe una p√°gina HTML b√°sica que incluya un archivo JavaScript sencillo. Coloca los archivos en un directorio servido por el servidor de archivos y √°brelos en tu navegador.</p>

<p><a class="p_ident" id="p-dGMy9Ug18P" href="#p-dGMy9Ug18P" tabindex="-1" role="presentation"></a>Luego, como ejercicio avanzado o incluso como un proyecto de fin de semana, combina todo el conocimiento que has adquirido de este libro para construir una interfaz m√°s amigable para modificar el sitio web‚Äîdesde <em>dentro</em> del sitio web.</p>

<p><a class="p_ident" id="p-ZKY31OAsrV" href="#p-ZKY31OAsrV" tabindex="-1" role="presentation"></a>Utiliza un formulario HTML para editar el contenido de los archivos que conforman el sitio web, permitiendo al usuario actualizarlos en el servidor mediante solicitudes HTTP, como se describe en el <a href="18_http.html">Cap√≠tulo 18</a>.</p>

<p><a class="p_ident" id="p-Ogr7GZ3+wK" href="#p-Ogr7GZ3+wK" tabindex="-1" role="presentation"></a>Comienza permitiendo que solo un archivo sea editable. Luego haz que el usuario pueda seleccionar qu√© archivo editar. Aprovecha el hecho de que nuestro servidor de archivos devuelve listas de archivos al leer un directorio.</p>

<p><a class="p_ident" id="p-PII294GUqX" href="#p-PII294GUqX" tabindex="-1" role="presentation"></a>No trabajes directamente en el c√≥digo expuesto por el servidor de archivos ya que si cometes un error, es probable que da√±es los archivos all√≠. En su lugar, mant√©n tu trabajo fuera del directorio accesible al p√∫blico y c√≥pialo all√≠ al hacer pruebas.</p>

<details class="solution"><summary>Mostrar pistas...</summary><div class="solution-text">

<p><a class="p_ident" id="p-cMkx7R4x8e" href="#p-cMkx7R4x8e" tabindex="-1" role="presentation"></a>Puedes crear un elemento <code>&lt;textarea&gt;</code> para contener el contenido del archivo que se est√° editando. Una solicitud <code>GET</code>, utilizando <code>fetch</code>, puede recuperar el contenido actual del archivo. Puedes usar URLs relativas como <em>index.html</em>, en lugar de <a href="http://localhost:8000/index.html"><em>http://localhost:8000/index.html</em></a>, para hacer referencia a archivos en el mismo servidor que el script en ejecuci√≥n.</p>

<p><a class="p_ident" id="p-ORpeth54Uz" href="#p-ORpeth54Uz" tabindex="-1" role="presentation"></a>Luego, cuando el usuario haga clic en un bot√≥n (puedes usar un elemento <code>&lt;form&gt;</code> y el evento <code>&quot;submit&quot;</code>), realiza una solicitud <code>PUT</code> a la misma URL, con el contenido del <code>&lt;textarea&gt;</code> como cuerpo de la solicitud, para guardar el archivo.</p>

<p><a class="p_ident" id="p-3BlItWwtjj" href="#p-3BlItWwtjj" tabindex="-1" role="presentation"></a>Puedes luego agregar un elemento <code>&lt;select&gt;</code> que contenga todos los archivos en el directorio principal del servidor mediante la adici√≥n de elementos <code>&lt;option&gt;</code> que contengan las l√≠neas devueltas por una solicitud <code>GET</code> a la URL <code>/</code>. Cuando el usuario seleccione otro archivo (un evento <code>&quot;change&quot;</code> en el campo), el script debe recuperar y mostrar ese archivo. Al guardar un archivo, utiliza el nombre de archivo actualmente seleccionado.</p>

</div></details><nav><a href="19_paint.html" title="previous chapter" aria-label="previous chapter">‚óÇ</a>¬†<a href="index.html" title="cover" aria-label="cover">‚óè</a>¬†<a href="21_skillsharing.html" title="next chapter" aria-label="next chapter">‚ñ∏</a>&nbsp;<button class=help title="help" aria-label="help"><strong>?</strong></button>&nbsp;<button class="dark-mode-toggle">üåô</button>
</nav>
</article>

<script src="ejs.js"></script>
